<!DOCTYPE html>
<html lang="zh-CN">
    <!-- title -->
<!-- keywords -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="author" content="f10@t">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="f10@t">
        <meta name="keywords" content="lzwgiter,f10@t's blog">
    <meta name="description" content="blogs by f10@t">
    <meta property="og:type" content="article">
<meta property="og:title" content="Spring基础学习 - IOC机制">
<meta property="og:url" content="https://lzwgiter.github.io/posts/44088610/index.html">
<meta property="og:site_name" content="f10@t&#39;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lzwgiter.github.io/img/Spring%E5%AD%A6%E4%B9%A0-IOC%E6%9C%BA%E5%88%B6/hehe.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/Spring%E5%AD%A6%E4%B9%A0-IOC%E6%9C%BA%E5%88%B6/image-20200506171641022.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/Spring%E5%AD%A6%E4%B9%A0-IOC%E6%9C%BA%E5%88%B6/image-20200506171705128.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/Spring%E5%AD%A6%E4%B9%A0-IOC%E6%9C%BA%E5%88%B6/image-20200508205050264.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/Spring%E5%AD%A6%E4%B9%A0-IOC%E6%9C%BA%E5%88%B6/image-20200508211307583.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/Spring%E5%AD%A6%E4%B9%A0-IOC%E6%9C%BA%E5%88%B6/image-20200509125728454.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/Spring%E5%AD%A6%E4%B9%A0-IOC%E6%9C%BA%E5%88%B6/image-20200509170049547.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/Spring%E5%AD%A6%E4%B9%A0-IOC%E6%9C%BA%E5%88%B6/image-20230123114859779.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/Spring%E5%AD%A6%E4%B9%A0-IOC%E6%9C%BA%E5%88%B6/image-20200509180518473.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/Spring%E5%AD%A6%E4%B9%A0-IOC%E6%9C%BA%E5%88%B6/image-20200509180625658.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/Spring%E5%AD%A6%E4%B9%A0-IOC%E6%9C%BA%E5%88%B6/image-20200509181742790.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/Spring%E5%AD%A6%E4%B9%A0-IOC%E6%9C%BA%E5%88%B6/image-20200509181833057.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/Spring%E5%AD%A6%E4%B9%A0-IOC%E6%9C%BA%E5%88%B6/image-20200509183833586.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/Spring%E5%AD%A6%E4%B9%A0-IOC%E6%9C%BA%E5%88%B6/image-20200509184002047.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/Spring%E5%AD%A6%E4%B9%A0-IOC%E6%9C%BA%E5%88%B6/image-20200509184120424.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/Spring%E5%AD%A6%E4%B9%A0-IOC%E6%9C%BA%E5%88%B6/image-20200509184315789.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/Spring%E5%AD%A6%E4%B9%A0-IOC%E6%9C%BA%E5%88%B6/image-20200509191215696.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/Spring%E5%AD%A6%E4%B9%A0-IOC%E6%9C%BA%E5%88%B6/image-20200509191329292.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/Spring%E5%AD%A6%E4%B9%A0-IOC%E6%9C%BA%E5%88%B6/image-20200509201219913.png">
<meta property="article:published_time" content="2020-05-06T06:13:40.000Z">
<meta property="article:modified_time" content="2024-07-24T02:44:32.507Z">
<meta property="article:author" content="f10@t">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lzwgiter.github.io/img/Spring%E5%AD%A6%E4%B9%A0-IOC%E6%9C%BA%E5%88%B6/hehe.png">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="icon" href="/assets/hello.svg">
    <title>Spring基础学习 - IOC机制 · f10@t&#39;s blog</title>
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
    (function (w) {
        'use strict'
        // rel=preload support test
        if (!w.loadCSS) {
            w.loadCSS = function () {}
        }
        // define on the loadCSS obj
        var rp = (loadCSS.relpreload = {})
        // rel=preload feature support test
        // runs once and returns a function for compat purposes
        rp.support = (function () {
            var ret
            try {
                ret = w.document.createElement('link').relList.supports('preload')
            } catch (e) {
                ret = false
            }
            return function () {
                return ret
            }
        })()

        // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
        // then change that media back to its intended value on load
        rp.bindMediaToggle = function (link) {
            // remember existing media attr for ultimate state, or default to 'all'
            var finalMedia = link.media || 'all'

            function enableStylesheet() {
                link.media = finalMedia
            }

            // bind load handlers to enable media
            if (link.addEventListener) {
                link.addEventListener('load', enableStylesheet)
            } else if (link.attachEvent) {
                link.attachEvent('onload', enableStylesheet)
            }

            // Set rel and non-applicable media type to start an async request
            // note: timeout allows this to happen async to let rendering continue in IE
            setTimeout(function () {
                link.rel = 'stylesheet'
                link.media = 'only x'
            })
            // also enable media after 3 seconds,
            // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
            setTimeout(enableStylesheet, 3000)
        }

        // loop through link elements in DOM
        rp.poly = function () {
            // double check this to prevent external calls from running
            if (rp.support()) {
                return
            }
            var links = w.document.getElementsByTagName('link')
            for (var i = 0; i < links.length; i++) {
                var link = links[i]
                // qualify links to those with rel=preload and as=style attrs
                if (
                    link.rel === 'preload' &&
                    link.getAttribute('as') === 'style' &&
                    !link.getAttribute('data-loadcss')
                ) {
                    // prevent rerunning on link
                    link.setAttribute('data-loadcss', true)
                    // bind listeners to toggle media back
                    rp.bindMediaToggle(link)
                }
            }
        }

        // if unsupported, run the polyfill
        if (!rp.support()) {
            // run once at least
            rp.poly()

            // rerun poly on an interval until onload
            var run = w.setInterval(rp.poly, 500)
            if (w.addEventListener) {
                w.addEventListener('load', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            } else if (w.attachEvent) {
                w.attachEvent('onload', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            }
        }

        // commonjs
        if (typeof exports !== 'undefined') {
            exports.loadCSS = loadCSS
        } else {
            w.loadCSS = loadCSS
        }
    })(typeof global !== 'undefined' ? global : this)
</script>

    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .footer-fixed-btn,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(
            -45deg,
            #444 0,
            #444 80px,
            #333 80px,
            #333 160px
        );
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }
</style>

    <link id="stylesheet-fancybox" rel="preload" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link id="stylesheet-base" rel="preload" href="/css/style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link id="stylesheet-mobile" rel="preload" href="/css/mobile.css" as="style" onload="this.onload=null;this.rel='stylesheet';this.media='screen and (max-width: 960px)'">
    <link id="stylesheet-theme-dark" rel="preload" href="/css/dark.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" as="script">
    <link rel="preload" href="/scripts/main.js" as="script">
    <link rel="preload" href="/font/Oswald-Regular.ttf" as="font" crossorigin>
    <link rel="preload" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" as="font" crossorigin>
    <!-- algolia -->
        <script>
            var hits = JSON.parse('{"per_page":10}')
            var labels = JSON.parse('{"input_placeholder":"搜索文章相关内容","hits_empty":"${query}搜索结果为空: ","hits_stats":"找到结果${hits}条，用时${time} ms"}')

            var algolia = {
                applicationID: 'M469ZFXTNU',
                apiKey: '32b991ddc2b9f92be99f0e241d0f12d4',
                indexName: 'blog_indices',
                hits: hits,
                labels: labels
            }
        </script>
    <!-- 百度统计  -->
        <script>
            var _hmt = _hmt || [];
            (function () {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?9ef67111f9ae4eefa278780655f0c1e3";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();
        </script>
    <!-- 谷歌统计  -->
    <!-- Google tag (gtag.js) -->
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="f10@t's blog" type="application/atom+xml">
</head>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ == undefined) {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js" />')
        }
    </script>
        <body class="post-body">
        <!-- header -->
        <header class="header header-mobile">
    <!-- top read progress line -->
    <div class="header-element">
        <div class="read-progress read-progress-feature"></div>
    </div>
    <!-- sidebar menu button -->
    <div class="header-element">
        <div class="header-sidebar-menu header-sidebar-menu-rounded">
            <i class="fas fa-bars"></i>
        </div>
    </div>
    <!-- header actions -->
    <div class="header-actions">
        <!-- theme mode switch button -->
        <span class="header-theme-btn header-element">
            <i class="fas fa-adjust"></i>
        </span>
        <!-- back to home page text -->
        <span class="home-link header-element">
            <a href="/">f10@t's blog</a>
        </span>
    </div>
    <!-- toggle banner -->
    <div class="banner">
        <div class="blog-title header-element">
            <a href="/">f10@t&#39;s blog</a>
        </div>
        <div class="post-title header-element">
            <a href="#" class="post-name">Spring基础学习 - IOC机制</a>
        </div>
    </div>
</header>

        <!-- fixed footer -->
        <footer class="footer-fixed">
    <!-- donate button -->
    <div class="donate-popup donate-popup--hidden">
    <div class="donate-popup__title">Buy Me A Coffee</div>
    <div class="donate-popup__content">
        <div class="donate-popup__content-description">如果这篇文章帮到了你，请赏一杯咖啡给我喝吧嘿嘿☕️</div>
        <img
            class="donate-popup__content-qrCode"
            title="Wechat"
            alt="Wechat"
            src="/assets/donate-wechat.jpg"
        ></img>
        <img
            class="donate-popup__content-qrCode"
            title="Alipay"
            alt="Alipay"
            src="/assets/donate-alipay.jpg"
        ></img>
    </div>
</div>

    <div
        title="Donate to the author"
        class="footer-fixed-btn footer-fixed-btn--hidden footer-fixed-btn--rounded donate-btn"
    >
        <i class="fas fa-donate"></i>
    </div>

    <!-- back to top button -->
    <div class="footer-fixed-btn footer-fixed-btn--hidden footer-fixed-btn--rounded back-top">
        <i class="fas fa-chevron-up"></i>
    </div>
</footer>

        <!-- wrapper -->
        <div class="wrapper">
            <div class="site-intro" style="    height:50vh;
">
    <!-- 主页  -->
    <!-- 404页  -->
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/B.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
                Spring基础学习 - IOC机制
            <!-- 404 -->
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            <!-- 404 -->
        </p>
        <!-- 文章页 meta -->
            <div class="post-intros">
                <!-- 文章页标签  -->
                    <div class="post-intro-tags" >
        <span class="post-category" data-categories="开发技术">
            <i class="fas fa-folder post-category-icon"></i>
            <span class="post-category-text">
                开发技术
            </span>
        </span>
        <a class="post-tag" href="javascript:void(0);" data-tags="Java">Java</a>
        <a class="post-tag" href="javascript:void(0);" data-tags="Spring">Spring</a>
</div>

                <!-- 文章字数统计 -->
                    <div class="post-intro-read">
                        <span>字数统计: <span class="post-count word-count">9.3k</span>阅读时长: <span class="post-count reading-time">40 min</span></span>
                    </div>
                <div class="post-intro-meta">
                    <!-- 撰写日期 -->
                    <span class="iconfont-archer post-intro-calander">&#xe676;</span>
                    <span class="post-intro-time">2020/05/06</span>
                    <!-- busuanzi -->
                        <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                            <span class="iconfont-archer post-intro-busuanzi">&#xe602;</span>
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    <!-- 文章分享 -->
                    <span class="share-wrapper">
                        <span class="iconfont-archer share-icon">&#xe71d;</span>
                        <span class="share-text">Share</span>
                        <ul class="share-list">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
    </div>
</div>

            <script>
  // get user agent
  function getBrowserVersions() {
    var u = window.navigator.userAgent
    return {
      userAgent: u,
      trident: u.indexOf('Trident') > -1, //IE内核
      presto: u.indexOf('Presto') > -1, //opera内核
      webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
      gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
      mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
      ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
      android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
      iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
      iPad: u.indexOf('iPad') > -1, //是否为iPad
      webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
      weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
      uc: u.indexOf('UCBrowser') > -1, //是否为android下的UC浏览器
    }
  }
  var browser = {
    versions: getBrowserVersions(),
  }
  console.log('userAgent: ' + browser.versions.userAgent)

  // callback
  function fontLoaded() {
    console.log('font loaded')
    if (document.getElementsByClassName('site-intro-meta')) {
      document
        .getElementsByClassName('intro-title')[0]
        .classList.add('intro-fade-in')
      document
        .getElementsByClassName('intro-subtitle')[0]
        .classList.add('intro-fade-in')
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in')
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb() {
    if (browser.versions.uc) {
      console.log('UCBrowser')
      fontLoaded()
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular'],
        },
        loading: function () {
          // 所有字体开始加载
          // console.log('font loading');
        },
        active: function () {
          // 所有字体已渲染
          fontLoaded()
        },
        inactive: function () {
          // 字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout')
          fontLoaded()
        },
        timeout: 5000, // Set the timeout to two seconds
      })
    }
  }

  function asyncErr() {
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0]
    o.src = u
    if (cb) {
      o.addEventListener(
        'load',
        function (e) {
          cb(null, e)
        },
        false
      )
    }
    if (err) {
      o.addEventListener(
        'error',
        function (e) {
          err(null, e)
        },
        false
      )
    }
    s.parentNode.insertBefore(o, s)
  }

  var asyncLoadWithFallBack = function (arr, success, reject) {
    var currReject = function () {
      reject()
      arr.shift()
      if (arr.length) async(arr[0], success, currReject)
    }

    async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack(
    [
      'https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js',
      'https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js',
      "/lib/webfontloader.min.js",
    ],
    asyncCb,
    asyncErr
  )
</script>

            <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" alt="loading">
            <div class="container container-unloaded">
                <main class="main post-page">
    <article class="article-entry">
        <blockquote>
<p><img src="/img/Spring学习-IOC机制/hehe.png" /></p>
</blockquote>
<span id="more"></span>
<h1 id="spring-全家桶">Spring 全家桶</h1>
<p>先来搞清楚Spring全家桶的关系吧，见过了Spring Boot、Spring
Cloud等，还有什么SpringMVC，Spring
Data啥的，一直没有搞清楚它们的关系。MVC设计模式的原理不再赘述，可以移步到参考链接中学习。</p>
<p>Spring框架自2002年开始发展，包括SpringMVC、SpringBoot、Spring
Cloud、Spring Cloud Dataflow等解决方案，俗称Spring 全家桶。</p>
<p>准确来说的话SpringMVC是SpringFramework的一个组件，其他什么Spring
Data、Spring Cloud都是建立在SpringFramework的基础上的：</p>
<p><img src="/img/Spring学习-IOC机制/image-20200506171641022.png" /></p>
<p>其中对于Spring Framework本身：</p>
<p><img src="/img/Spring学习-IOC机制/image-20200506171705128.png" /></p>
<p>底层中核心有AOP(Aspect-Oriented Programming,
面向切面编程)和IOC(Inverse of
Control，控制反转)，这两者是Spring的两大特性，知乎前辈指导先把这俩学清楚。</p>
<h1 id="spring的所有包模块">Spring的所有包模块</h1>
<p>Spring模块本质就是多个jar文件，其中打包了该模块所需的代码，从Spring5版本开始Spring提供了21个模块，使用的时候如Maven，只需要引入依赖即可。下面的总结表格来自《Spring5高级编程(第五版)》。</p>
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="header">
<th>模块</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>aop</td>
<td>该模块包含在应用程序中使用 Spring的AOP
功能时所需的所有类。如果打算在 Spring 中使用其他使用了 AOP 的功能，
例如声明式事务管理， 则需要在应用程序中包含此JAR 文件。 此外，支持与
AspectJ 集成的类也封装在此模块中</td>
</tr>
<tr class="even">
<td>aspects</td>
<td>该模块包含与 AspecU AOP 库进行高级集成的所有类。 例如， 如果为完成
Spring 配置而使用 Java 类，并且需要 Asp创
风格的注解驱动的事务管理，则需要使用此模块</td>
</tr>
<tr class="odd">
<td>beans</td>
<td>该模块包含所有支持 Spring 对 Spring bean进行操作的类。
该模块中的大多数类都支持 Spring 的阳bean工厂实现。例如， 处理 Spring XML
配置文件和 Java 注解所需的类被封装到此模块中</td>
</tr>
<tr class="even">
<td>beans-groovy</td>
<td>此模块包含用于支持 Spring 对 Spring bean 进行操作的 Groovy 类</td>
</tr>
<tr class="odd">
<td>context</td>
<td>该模块包含为 Spring Core 提供许多扩展的类。所有类都需要使用 Spring
的 ApplicationContext功能以及 Enterprise JavaBeans(EJB)、Java Naming and
Directory lnterface(JNDI)和 Java Management Extensions(JMX)
集成的类。此模块中还包含 Spring 远程处理类，与动态脚本语言（例如 JRuby
、Groovy 和 BeanShe ll）、 JSR-303(Bean
Validation）、调度和任务执行等集成的类</td>
</tr>
<tr class="even">
<td>context-indexer</td>
<td>该模块包含一个索引器实现，它提供对META-INF/spring.components
中定义的候选项的访问功能。但核心类
CandidateComponentslndex并不能在外部使用</td>
</tr>
<tr class="odd">
<td>context-support</td>
<td>该模块包含对 spring-context模块的进一步扩展。
在用户界面方面，有一些用于支持邮件并与模板引擎（例如Velocity、FreeMarker和JasperReports）集成的类。
此外，还包括与各种任务执行和调度库（包括 CommonJ和Quatz的集成</td>
</tr>
<tr class="even">
<td>core</td>
<td>这是每个 Spring 应用程序都需要的主要模块。在该 JAR
文件中，可以找到所有其他 Spring
模块｛例如，用于访问配置文件的类）所共享的所有类。另外，在该 JAR
文件中，会发现在整个 Spring 代码库中都使用的非常有用的实用程
序类，可以在自己的应用程序中使用它们</td>
</tr>
<tr class="odd">
<td>expression</td>
<td>该模块包含 Spring Expression Language(SpEL)的所有支持类</td>
</tr>
<tr class="even">
<td>instrument</td>
<td>该模块包含用于JVM启动的Spring工具代理。 如果在 Spring 应用程序中使用
AspectJ 实现加载时植入，那么该模块是必需的</td>
</tr>
<tr class="odd">
<td>jdbc</td>
<td>该模块包含所有的 JDBC
支持类。对于需要数据库访问的所有应用程序，都需要此模块。支持数据源、
JDBC 数据 类型、 JDBC 模板、本地 JDBC 连接等的类都被打包在此模块中</td>
</tr>
<tr class="even">
<td>jms</td>
<td>该模块包含川S 支持的所有类</td>
</tr>
<tr class="odd">
<td>orm</td>
<td>该模块扩展了 Spring 的标准 JDBC 功能集，支持流行的 ORM 工具，包括
Hibemate、JDO、JPA 和数据映射器 iBATIS。该 JAR 文件中的许多类都依赖于
spring-jdbc JAR 文件中所包含的类， 因此也需要把它包含在应用程序中。</td>
</tr>
<tr class="even">
<td>oxm</td>
<td>该模块为Object/XML映射（OXM）提供支持。 用于抽象 XML
编组和解组以及支持Castor、JAXB、XMLBeans和XStream等常用工具的类都包含在此模块中</td>
</tr>
<tr class="odd">
<td>test</td>
<td>Spring 提供一组模拟类来帮助测试应用程序，并且许多模拟类都在 Spring
测试套件中使用，所以它们都经过了很好
的测试，从而使测试应用程序变得更简单。 在对 Web
应用程序进行单元测试时会发现模拟HttpServletRequest和
HttpServletResponse类所带来的好处。 另一方面，Spring提供了与 JUnit
单元测试框架的紧密集成， 并且在该模块中 提供了许多支持 JUnit
测试用例开发的类：例如：SpringJUnit4ClassRunner提供了一种在单元测试环境中引导Spring
ApplicationContext的简单方法</td>
</tr>
<tr class="even">
<td>tx</td>
<td>该模块提供支持Spring事务基础架构的所有类。
可以从事务抽象层找到相应的类来支持Java Transaction APl(JT A)
以及与主要供应商的应用程序服务器的集成</td>
</tr>
<tr class="odd">
<td>web</td>
<td>此模块包含在 Web 应用程序中使用Spring所需的核心类，包括用于自动加载
ApplicationContext
功能的类、文件上传支持类以及一些用于执行重复任务（比如从查询字符中解忻整数值）的有用类</td>
</tr>
<tr class="even">
<td>web-reactive</td>
<td>该模块包含SpringWeb Reactive模型的核心接口和类</td>
</tr>
<tr class="odd">
<td>wev-mvc</td>
<td>该模块包含Spring自己的 MVC 框架的所有类。 如果想要为应用程使用单独的
MVC框架，则不需要此 JAR 文件中的任何类。</td>
</tr>
<tr class="even">
<td>webfsocket</td>
<td>该模块提供对 J SR-356仰ebSocket 的 Java API）的支持</td>
</tr>
</tbody>
</table>
<h1 id="ioc">IOC</h1>
<p>控制反转，<strong>本质就是将创建对象的控制权交给SpringFramework</strong>。简单来说我们一般新建一个对象：<code>Person person = new Person()</code>使用了new关键字来进行操作，现在将这个工作交给SpringFramework的意思。</p>
<blockquote>
<p>IoC Implementation Strategies</p>
<p>IoC is a broad concept that can be implemented in different ways.
There are two main types:</p>
<p>Dependency Lookup: The container provides callbacks to components,
and a lookup context.This is the EJB and Apache Avalon approach. It
leaves the onus on each component to use container APIs to look up
resources and collaborators. The Inversion of Control is limited to the
container invoking callback methods that application code can use to
obtain resources.</p>
<p>Dependency Injection: Components do no look up; they provide plain
Java methods enabling the container to resolve dependencies. The
container is wholly responsible for wiring up components, passing
resolved objects in to JavaBean properties or constructors. Use of
JavaBean properties is called Setter Injection; use of constructor
arguments is called Constructor Injection.</p>
<p>The second IoC strategy-Dependency Injection-is usually preferable.
——<em>《expert ONE-ON-ONE J2EE Development without EJB》</em></p>
</blockquote>
<p>​ 即在广义上，IOC机制有两种实现机制：</p>
<ul>
<li>依赖查找。即容器提供了组件调用组件时的路径以及查询组件的上下文，将资源等的查找责任交给了组件本身，使用容器的API即可实现。EJB(Enterprise
Java Beans)和Apache Avalon使用了这种方法。</li>
<li>依赖注入(DI)。组件不需要取查找依赖，而是将java方法提供给容器来解决依赖。容器完全负责连接组件，将解析的对象传递给JavaBean属性或构造函数。其中使用JavaBean属性称为Setter注入，使用构造函数参数称为构造器注入。</li>
</ul>
<p>这里的<code>容器 - container</code>指的是IOC容器。</p>
<p>下面是更具体的对于IOC机制的解释：</p>
<blockquote>
<p>Spring框架的核心是基于控制反转（Inversion of Control, IoC)的原理。
IoC 是一种将组件依赖项的创建和管理外部化的技术。请参考一个示例，比如类
Foo 依赖于 Bar 类的一个实例来执行某种处理。 传统上， Foo 通过使用 new
操作符来创建 Bar 实例或从某个工厂类中获取 Bar 实例。 而如果使用 IoC
方法， Bar 的一个实例（或一个子类）在运行时由某个外部进程提供给
Foo。这种在运行时注入依赖项的行为促使 Martin Fowler将 IoC
重命名为更具描述性的依赖注入ρependency Injection, DI) 。</p>
<p>——<em>《Spring5高级编程(第五版)》</em></p>
</blockquote>
<p>DI其实是Martin
Fowler对IOC的另一种更具体的解释。<strong>即Spring通过DI来实现在程序运行的时候，动态的向某个对象提供他所需要的其他对象。</strong></p>
<p>Spring的DI实现基于两个核心的Java概念：JavaBeans和接口，JavaBean也叫做Plain
Ordinary Java
Object(POJO，简单普通Java对象)，它概念这里不做解释，下面的代码会说到它的特点。当使用Spring作为DI提供程序时，可以通过不同的方式来在应用程序中灵活定义依赖项配置，如：</p>
<ul>
<li>XML文件</li>
<li>Java配置类</li>
<li>Java注解</li>
</ul>
<p>而<strong>JavaBean提供了一种创建Java资源的标准机制</strong>，这些资源可以通过多种方式进行配置，这个配置的过程叫做<strong>注入</strong>，这也就是依赖注入名字的意思了，下面我们把<code>配置</code>这个动词换为<code>注入</code>。那么使用DI的好处是什么呢？</p>
<ul>
<li>减少粘合代码，这是DI的最大优点之一。</li>
<li>简化应用程序配置</li>
<li>能够在单个存储库中管理常见依赖项</li>
<li>可测试性</li>
<li>良好的程序设计</li>
</ul>
<p>Spring依赖注入的方式有四种：setter注入、构造器注入、基于注解、静态工厂注入。下面一个个的进行进行解释。首先我们先来了解什么是JavaBean，并通过一个例子来理解为啥需要这种IOC机制。</p>
<h2 id="javabean">JavaBean</h2>
<p>其实但是我看到这个名字就很好奇，javabean，bean？豆子？啥意思？想比喻啥？专门查了以下才知道...好吧javabean是咖啡豆哈哈哈，煮咖啡不得搞咖啡豆（滑稽。</p>
<p>这里我不想抛出太多的专业解释，只放出我的理解。JavaBean又叫POJO（<em>Plain
Ordinary Java
Object</em>），是简单Java对象的意思，命名原因据说是为了和EJB做区分。</p>
<p>简单对象嘛，那就是很简单的对象喽....</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">getName</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">setName</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面这个类就是javabean，好了我说完了。</p>
<p>哈哈哈你是不有点懵，其实<strong>JavaBean就是一个提供了getter、setter方法的对象</strong>，可以就如同一个黑盒子，你甭管我咋写的，你就知道可以get和set就完事了。对于Spring，这就是DI的一个<strong>最小管理单元</strong>，用来由Spring在合适的时候动态的向其中提供类或取出类，那我们下面一个例子就知道JavaBean的作用了。</p>
<h3 id="一个实例">一个实例</h3>
<p>我们现在考虑这样的经典场景，消费者和生产者，生产者生产消息、消费者输出消息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> demo1;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 消息提供者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MessageProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">getMessage</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> demo1;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 消息渲染者(消费者)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MessageRender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    输出消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">render</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    设置生产者</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setMessageProvider</span><span class="params">(MessageProvider messageProvider)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    获取生产者</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    MessageProvider <span class="title function_">getMessageProvider</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldMessageProvider</span> <span class="keyword">implements</span> <span class="title class_">MessageProvider</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, World&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StandardOutMessageRender</span> <span class="keyword">implements</span> <span class="title class_">MessageRender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MessageProvider messageProvider;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">render</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (messageProvider == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(</span><br><span class="line">                    <span class="string">&quot;your must set the property messageProvider of class:&quot;</span></span><br><span class="line">                            + StandardOutMessageRender.class.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.messageProvider.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessageProvider</span><span class="params">(MessageProvider messageProvider)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.messageProvider = messageProvider;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MessageProvider <span class="title function_">getMessageProvider</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.messageProvider;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在想一想，如果我们要使用的话，main函数是不是这么写？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldcoupled</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MessageProvider</span> <span class="variable">msgP</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HelloWorldMessageProvider</span>();</span><br><span class="line">        <span class="type">MessageRender</span> <span class="variable">msgR</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardOutMessageRender</span>();</span><br><span class="line">        msgR.setMessageProvider(msgP);</span><br><span class="line">        msgR.render();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>即我们需要手动new对象，再进行对应的操作。</p>
<p><img src="/img/Spring学习-IOC机制/image-20200508205050264.png" /></p>
<p>这是因为我们的应用程序比较简单，你这么搞没人说你错，但是想一想，如果我要增加一个生产者呢？我是不是还得修改对应的类？修改main方法？假如你这是个编写好的程序，你不还得重新打包、重新发布？</p>
<p>换句话说：<strong>代码的耦合性很高，难于维护。</strong></p>
<p>那好了有人说用工厂类，再加个配置文件，用反射机制动态获取类，可以：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageSupportedFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MessageSupportedFactory instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Properties props;</span><br><span class="line">    <span class="keyword">private</span> MessageRender renderer;</span><br><span class="line">    <span class="keyword">private</span> MessageProvider provider;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        instance = <span class="keyword">new</span> <span class="title class_">MessageSupportedFactory</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">MessageSupportedFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        props = <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            props.load(<span class="built_in">this</span>.getClass().getResourceAsStream(<span class="string">&quot;/msf.properties&quot;</span>));</span><br><span class="line">            <span class="type">String</span> <span class="variable">rendererClassName</span> <span class="operator">=</span> props.getProperty(<span class="string">&quot;renderer.class&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">providerClassName</span> <span class="operator">=</span> props.getProperty(<span class="string">&quot;provider.class&quot;</span>);</span><br><span class="line"></span><br><span class="line">            renderer = (MessageRender)Class.forName(rendererClassName).newInstance();</span><br><span class="line">            provider = (MessageProvider)Class.forName(providerClassName).newInstance();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> MessageSupportedFactory <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MessageRender <span class="title function_">getRenderer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> renderer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MessageProvider <span class="title function_">getProvider</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> provider;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置文件：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">renderer.class</span> = <span class="string">demo1.StandardOutMessageRender</span></span><br><span class="line"><span class="attr">provider.class</span> = <span class="string">demo1.HelloWorldMessageProvider</span></span><br></pre></td></tr></table></figure>
<p>再修改以下main函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldDecoupled</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MessageProvider</span> <span class="variable">msgP</span> <span class="operator">=</span> MessageSupportedFactory.getInstance().getProvider();</span><br><span class="line">        <span class="type">MessageRender</span> <span class="variable">msgR</span> <span class="operator">=</span> MessageSupportedFactory.getInstance().getRenderer();</span><br><span class="line">        msgR.setMessageProvider(msgP);</span><br><span class="line">        msgR.render();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>OK，不需要new对象了，直接在工厂类里用反射机制动态获取配置文件中的类，再操作就行了。那其实你还是需要用set方法来进行配置，如果你这个类有一堆setter呢？还是需要修改main函数的。那么下来我们使用Spring进行重构。</p>
<h3 id="使用spring重构实例">使用Spring重构实例</h3>
<p>明确问题：解决手动调用set方法进行对象的依赖管理。</p>
<p>我们首先写一个spring.xml，名字无所谓</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;demo1.HelloWorldMessageProvider&quot;</span> <span class="attr">id</span>=<span class="string">&quot;provider&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;demo1.StandardOutMessageRender&quot;</span> <span class="attr">id</span>=<span class="string">&quot;render&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;messageProvider&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;provider&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我来解释以下这个文件的内容，那几行xmlns是自动生成的，作用是充当命名空间，你下面使用的标签都是上面这些命名空间里定义的，也有其他的如<code>http://www.springframework.org/schema/p</code>等可以实现如简写的功能，这里不用管他，后面我会说到常用命名空间的使用，下面的<code>&lt;bean&gt;</code>标签是我们的重点。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;demo1.HelloWorldMessageProvider&quot;</span> <span class="attr">id</span>=<span class="string">&quot;provider&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>对于这一个bean对象，它对应的是刚才HelloWorldMessageProvider这个类，id属性是我们对这个bean的标识。这就是一个bean了，其实就如同一个单元，交给了spring的上下文。另一个是一样的，但是多了个property属性，什么意思呢？</p>
<p>在StandardOutMessageRender这个类中我们有一个Setter方法以及一个私有属性messageProvider：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> MessageProvider messageProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessageProvider</span><span class="params">(MessageProvider messageProvider)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.messageProvider = messageProvider;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ok，messageprovider是属性吧？行，那这个标签叫property你就理解了，ref是什么鬼？ref对应的就是这个setter方法，它的属性值就是这个setter方法的参数类型(MessageProvider)。</p>
<p>即这个bean指向HelloWorldMessageProvider对象，这个对象有一个messageProvider属性，他的setter方法里参数填充为<code>provider</code>，<code>provider</code>是谁？--
&gt; <code>HelloWorldMessageProvider</code>，这就是id的作用了。</p>
<p>我们再重新写一下main函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldSpringDI</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;spring.xml&quot;</span>);</span><br><span class="line">        <span class="type">MessageRender</span> <span class="variable">mr</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;render&quot;</span>, MessageRender.class);</span><br><span class="line">        mr.render();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ApplicationContext</code>是一个上下文接口类，<code>ClassPathXmlApplicationContext</code>类可以用来读取xml文档，这里读取的就是我们的bean定义文档。通过这个函数我们可以获取到Spring的上下文，这个上下文里就包含了我们定义的beans(那两个类)，再通过getBean方法来获取指定的对象，这里我们获取id为<code>render</code>的类，即StandardOutMessageRender类对象，最后调用render()方法进行输出。</p>
<p>没有new吧？(上下文那个不算...)，我没调用setter方法吧？那运行一下。</p>
<p><img src="/img/Spring学习-IOC机制/image-20200508211307583.png" /></p>
<p>可以这就是IOC的魅力，Spring通过IOC机制在合适的时候创建需要的对象(StandardOutMessageRender和HelloWorldMessageProvider)，并自动调用其中的setter方法，将HelloWorldMessageProvider对象自动注入到了StandardOutMessageRender类对象中，这个过程过程我们叫<strong>依赖注入</strong>。</p>
<h3 id="基于注解的依赖注入">基于注解的依赖注入</h3>
<p>从Spring3.0开始开发Spring应用程序已经不需要XML配置文件了，可以把这些配置都换为如下两类：</p>
<ul>
<li>注解：使用@Bean进行注解，标识这是一个bean。</li>
<li>配置类：使用@Configuration注解的java类，可以在内部使用@Bean来定义bean，也可以通过@Component注解来扫描指定包下的bean定义</li>
</ul>
<p>我们再看一眼上面的那个XML配置文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;demo1.HelloWorldMessageProvider&quot;</span> <span class="attr">id</span>=<span class="string">&quot;provider&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;demo1.StandardOutMessageRender&quot;</span> <span class="attr">id</span>=<span class="string">&quot;render&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;messageProvider&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;provider&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们定义了两个bean交由Spring上下文进行管理，现在我们使用注解来完成这一功能，xml文档就可以扔了，取而代之的是一个<strong>配置类</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotated;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MessageProvider <span class="title function_">provider</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HelloWorldMessageProvider</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MessageRender <span class="title function_">renderer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MessageRender</span> <span class="variable">messageRender</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">StandardOutMessageRender</span>();</span><br><span class="line">        messageRender.setMessageProvider(provider());</span><br><span class="line">        <span class="keyword">return</span> messageRender;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先用<code>@Configuration</code>标注这是一个配置类，我们要从这个配置类中获取上下文。定义两个函数分别获取生产者和消费者，并使用<code>@Bean</code>进行注解，使用该注解就相当于再XML里定义了两个bean。接口和实现无需修改，我们重新写下main函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotated;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldSpringAnnotated</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(HelloWorldConfig.class);</span><br><span class="line">        <span class="type">MessageRender</span> <span class="variable">msgR</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;renderer&quot;</span>, MessageRender.class);</span><br><span class="line">        msgR.render();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用<code>AnnotationConfigApplicationContext</code>函数从我们的配置类中获取上下文即可，该类作用如下：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Create a new AnnotationConfigApplicationContext, deriving bean definitions from the given annotated classes and automatically refreshing the context.</span><br><span class="line">  @param annotatedClasses one or more annotated classes,</span><br></pre></td></tr></table></figure>
<p>那么运行结果也是一样的：</p>
<p><img src="/img/Spring学习-IOC机制/image-20200509125728454.png" /></p>
<p>为什么在getBean方法中指定id为renderer呢？<strong>因为对应的bean的函数名叫renderer。</strong></p>
<h2 id="di的类型">DI的类型</h2>
<p>这里再澄清一下IoC和DI的关系和含义，<strong>IoC(控制反转)的核心是DI(依赖注入)</strong>，旨在提供一种更简单的机制来设置组件依赖项，前面我们也提到IoC有两种类型：<strong>依赖查找和依赖注入</strong>，所以DI是IoC的一种实现而已。</p>
<p>对于依赖查找这篇不做解释，常用于配合JNDI API来进行依赖管理，包含
依赖拉取(DL, dependency pull)和上下文依赖查找(CDL, contextualized
dependency lookup)。</p>
<p>对于依赖注入DI，共四种方法：常用风格有两种：构造函数注入和setter依赖注入，另外不太常用的有方法注入和字段注入(field
injection)。</p>
<h3 id="构造函数注入">构造函数注入</h3>
<p>使用构造函数注入常见的方法是使用XML配置文件，另外也有更简洁的注解配置方法。</p>
<h4 id="xml配置方法">XML配置方法</h4>
<p>HelloWorldMessageProvider的返回消息是硬编码的"Hello,
Word"，我们重新写一个可以通过配置改变的MessageProvider。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotated;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigurableMessageProvider</span> <span class="keyword">implements</span> <span class="title class_">MessageProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConfigurableMessageProvider</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (msg == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(</span><br><span class="line">                    <span class="string">&quot;You need to provide the message.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过构造方法来定义消息，并拥有get方法返回消息。我们继续配置xml文件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;annotated.ConfigurableMessageProvider&quot;</span> <span class="attr">id</span>=<span class="string">&quot;configurableMessageProvider&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;msg from xml&quot;</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.String&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过<code>construtor-arg</code>的标签就可以实现，<code>value</code>指定它的值，<code>type</code>指定类型。main函数如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotated;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldSpringAnnotated</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//ApplicationContext context = new AnnotationConfigApplicationContext(HelloWorldConfig.class);</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;spring/construct-DI.xml&quot;</span>);</span><br><span class="line">        <span class="type">MessageProvider</span> <span class="variable">msgP</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;configurableMessageProvider&quot;</span>, MessageProvider.class);</span><br><span class="line">        System.out.println(msgP.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="/img/Spring学习-IOC机制/image-20200509170049547.png" /></p>
<p>此外你也可以通过其他命名空间来实现简写，效果相同：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:c</span>=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;annotated.ConfigurableMessageProvider&quot;</span> <span class="attr">id</span>=<span class="string">&quot;configurableMessageProvider&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">c:msg</span>=<span class="string">&quot;msg from xml&quot;</span> /&gt;</span>	# 使用c标签</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果构造方法有多个参数怎么办？使用下标就可以了，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;annotated.ConfigurableMessageProvider&quot;</span> <span class="attr">id</span>=<span class="string">&quot;configurableMessageProvider&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">c:_0</span>=<span class="string">&quot;msg from xml&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>第一个形参就是<code>_0</code>，第二个是<code>_1</code>，以此类推。</p>
<h4 id="注解配置方法">注解配置方法</h4>
<p>用注解配置的方法则更为简洁，我们修改一下<code>StandardOutMessageRender</code>，使用构造器注入的方式注入依赖：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotated;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service(&quot;renderer&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StandardOutMessageRender</span> <span class="keyword">implements</span> <span class="title class_">MessageRender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MessageProvider messageProvider;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注意此处使用了@Autowired注解</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StandardOutMessageRender</span><span class="params">(MessageProvider messageProvider)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.messageProvider = messageProvider;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">render</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (messageProvider == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(</span><br><span class="line">                    <span class="string">&quot;your must set the property messageProvider of class:&quot;</span></span><br><span class="line">                            + StandardOutMessageRender.class.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.messageProvider.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessageProvider</span><span class="params">(MessageProvider messageProvider)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.messageProvider = messageProvider;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MessageProvider <span class="title function_">getMessageProvider</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.messageProvider;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>方法很简单，我们只需要在<strong>构造方法</strong>上标注@Autowired注解即可。我们重新写一个xml文件以扫描包下所有组件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;annotated&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/img/Spring学习-IOC机制/image-20230123114859779.png" /></p>
<p><strong>需要注意的是，注入时bean的查找必须是唯一的。</strong>我们前面还写了一个<code>ConfigurableMessageProvider</code>，同样实现了<code>MessageProvider</code>，且带有@Service注解。这里需要暂时去掉该注解，并注释掉<code>HelloWorldConfig</code>中提供的bean即可。不然就会出现注入时，可用的bean超过一个，spring不知道注入哪一个的问题。</p>
<h3 id="setter注入">setter注入</h3>
<p>构造器注入有一个缺点，即构造参数过多的话，那XML文件和构造方法的代码就会很冗长。这样的情况下，使用setter注入是一个比较好的选择。依旧是两种方式。</p>
<h4 id="xml配置方法-1">XML配置方法</h4>
<p>其实之前我们已经用过这个方法了，即：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;decoupled.HelloWorldMessageProvider&quot;</span> <span class="attr">id</span>=<span class="string">&quot;provider&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;decoupled.StandardOutMessageRender&quot;</span> <span class="attr">id</span>=<span class="string">&quot;render&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;messageProvider&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;provider&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这就是XML中配置setter注入的办法，其中StandardOutMessageRender类依赖于HelloWorldMessageProvider类对象，并提供了setMessageProvider方法来设置，通过这样设置XML文档，初始化StandardOutMessageRender对象时就会自动实例化一个HelloWorldMessageProvider对象填充到setter方法中。</p>
<p>前面也说过了，使用其他命名空间也可以实现简写：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span> # <span class="attr">这里</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;decoupled.HelloWorldMessageProvider&quot;</span> <span class="attr">id</span>=<span class="string">&quot;provider&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;decoupled.StandardOutMessageRender&quot;</span> <span class="attr">id</span>=<span class="string">&quot;render&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">p:messageProvider-ref</span>=<span class="string">&quot;provider&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>即property的缩写p，并设置它的属性的依赖bean。这样可以简化配置</p>
<h4 id="注解配置方法-1">注解配置方法</h4>
<p>使用XML的方式我们就需要使用ref标签来定义依赖，如果使用注解的方式会更加简单，我们只需要<code>@Autowired</code>就可以了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessageProvider</span><span class="params">(MessageProvider messageProvider)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.messageProvider = messageProvider;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>另外在StandardOutMessageRender类上加<code>@Service</code>注解即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;renderer&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StandardOutMessageRender</span> <span class="keyword">implements</span> <span class="title class_">MessageRender</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>这时，<code>@Autowired</code>注解就会自动取寻找类型为MessageProvider的bean，最终会在配置类中查找到这个bean如下，并自动返回这个对象到形参中，完成setter方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MessageProvider <span class="title function_">provider</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HelloWorldMessageProvider</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用注解的方式是要明显简单于XML文档配置的。</p>
<h3 id="字段注入">字段注入</h3>
<p>其实个人觉得field翻译为变量更准确，即变量注入，但是书里是这么写的哈哈。顾名思义就是将bean直接注入到变量里，举一个栗子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotated2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service(&quot;Singer&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Person person; <span class="comment">// 字段注入</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sing</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;I am a &quot;</span> + person.getName() + <span class="string">&quot;~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里我们没有针对这个变量的setter方法，或者构造器方法，即我们不使用上述两种方法了，直接标记<code>@Autowired</code>。而Person类定义如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotated2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;Singer&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>main函数:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotated2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;spring/field-DI.xml&quot;</span>);</span><br><span class="line">        <span class="type">Singer</span> <span class="variable">singer</span> <span class="operator">=</span> context.getBean(Singer.class);</span><br><span class="line">        singer.sing();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>XML文件使用compnent-scan来扫描base-package包下的所有组件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;annotated2&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<p><img src="/img/Spring学习-IOC机制/image-20200509180518473.png" /></p>
<p>可以看到也是可以实现的，但是并不建议使用字段注入的方法，包括从2019年的Idea开始也将这个方法标记为"不建议":</p>
<p><img src="/img/Spring学习-IOC机制/image-20200509180625658.png" /></p>
<p>它的问题主要有三个：</p>
<ul>
<li>使用该注解方式后，我们就没办法单独使用这个类了。比如我就不能直接<code>new Singer()</code>，原因在于spring的注解是运行时注入的，我们直接new会导致空指针的问题。<strong>即该类脱离了容器环境无法使用</strong>，因此在编写测试时，字段注入会带来困难。</li>
<li>可能会导致循环依赖的问题，即A类中需要自动注入B，而B类中需要自动注入A。</li>
<li>字段注入不能用于final字段。这种类型的字段只能使用构造函数注入来初始化。</li>
</ul>
<h3 id="方法注入">方法注入</h3>
<p>最后一个不常用的是DI手段是方法注入，他又有两种子方法：查找注入(Lookup
Method Injection)和方法替换(Method
Replacement)。前者可以获取一个依赖项，而后者可以实现在不修改代码的情况下任意替换bean上任何方法的实现。</p>
<h4 id="查找注入">查找注入</h4>
<p>该方法于spring1.1时加入，用来解决当前bean依赖于另一个具有<strong>不同作用范围</strong>的bean的问题。注意，我所说的<strong>作用范围</strong>指的是单例模式or多例模式，或者就是书中说的<strong>不同生命周期</strong>，理解就可以。为了讲清楚这个东西存在的意义，我们思考如下场景。</p>
<p>提前说一下，在XML文档配置中，默认的当前bean就是单例模式，通过关键字<code>scope</code>来定义，有两种值：</p>
<p><img src="/img/Spring学习-IOC机制/image-20200509181742790.png" /></p>
<p>即单例模式和多例模式。<strong>默认的就是单例模式</strong>：</p>
<p><img src="/img/Spring学习-IOC机制/image-20200509181833057.png" /></p>
<p>单例模式和多例模式这里不做解释。代码也就不写了，这里简单说明一下<code>scope</code>即可。</p>
<p>学下出题的口气，咳咳...</p>
<p>假设现有两个bean：Singer和Person，其中bean：Singer依赖于Person，问：Singer中获取两次Person，这两个Person指向的对象一样吗？已知依赖配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;annotated2.Person&quot;</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;annotated2.Singer&quot;</span> <span class="attr">id</span>=<span class="string">&quot;singer&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;person&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;person&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Singer.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotated2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Person person;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Person <span class="title function_">getPerson</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> person;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPerson</span><span class="params">(Person person)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.person = person;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Singer&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;person=&quot;</span> + person +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Person.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotated2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>main函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotated2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;spring/field-DI.xml&quot;</span>);</span><br><span class="line">        <span class="type">Singer</span> <span class="variable">singer_1</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;singer&quot;</span>, Singer.class);</span><br><span class="line">        <span class="type">Singer</span> <span class="variable">singer_2</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;singer&quot;</span>, Singer.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;singer_1=&quot;</span> + singer_1);</span><br><span class="line">        System.out.println(<span class="string">&quot;singer_2=&quot;</span> + singer_2);</span><br><span class="line">        System.out.println(<span class="string">&quot;singer_1.Person == singer_2.Person = &quot;</span> + (singer_1 == singer_2));</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果是一样的：</p>
<p><img src="/img/Spring学习-IOC机制/image-20200509183833586.png" /></p>
<p>理由很简单，在全局都只存在一个Singer和一个Person，所以你这两个对象包括属性都是一样的。</p>
<p>问2：现将Singer换为多例，结果？</p>
<p><img src="/img/Spring学习-IOC机制/image-20200509184002047.png" /></p>
<p>那你都多例了，肯定两个Singer对象是不一样的，但是由于Person是单例的，所以你可以看到Person属性是同一个对象。</p>
<p>问3：现在将二者都换为多例子，结果？</p>
<p><img src="/img/Spring学习-IOC机制/image-20200509184120424.png" /></p>
<p>那更简单了，两两都是不一样的，不做解释。</p>
<p>问4(压轴题哈哈)：现将Singer换为单例，Person换为多例，结果？</p>
<p>这个是由迷惑性的，我第一次就以为两个Person属性是不一样的，实际上：</p>
<p><img src="/img/Spring学习-IOC机制/image-20200509184315789.png" /></p>
<p><strong>结果和二者都为单例是一样的结果。</strong></p>
<blockquote>
<p>抛出问题为啥呢？</p>
</blockquote>
<p>要理解也很简单，因为Singer是单例的，所以他只被初始化了一次，即Person也只被初始化了一次，所以两个Singer的Person属性是一样的。</p>
<blockquote>
<p>那么回归主题，需求是什么？</p>
</blockquote>
<p>在问题4中我们看到，单例搭配多例的依赖会导致单例的每一个对象都是同一个，问题是<strong>我想要单例模式下的每一个对象它的依赖都不一样呢</strong>？好了，我们有了查找注入。我们对Singer的代码进行修改：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotated2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Singer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Person <span class="title function_">getPerson</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pringPerson</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(getPerson());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将getPerson改为抽象方法，返回Person对象，并使用getPerson来输出这个对象的信息，去掉setter，即不使用setter注入，当然Singer也就成了抽象类。配置文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;annotated2.Person&quot;</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;annotated2.Singer&quot;</span> <span class="attr">id</span>=<span class="string">&quot;singer&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">lookup-method</span> <span class="attr">name</span>=<span class="string">&quot;getPerson&quot;</span> <span class="attr">bean</span>=<span class="string">&quot;person&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用<code>lookup-method</code>标签指定方法，Spring会对这个抽象方法进行<strong>覆写</strong>，并指定name
- 方法名称；bean返回的bean类型：</p>
<p><img src="/img/Spring学习-IOC机制/image-20200509191215696.png" /></p>
<p>我们再次运行：</p>
<p><img src="/img/Spring学习-IOC机制/image-20200509191329292.png" /></p>
<p>至此我们就是用了方法注入的手段实现了单例模式下的对象多次获取后可以拥有不同的依赖。那么注意事项就来了：</p>
<ul>
<li>当想要使用两个具有不同生命周期的bean时，可以使用查找方法注入。当bean
共享相同的生命周期时， 应该避免使用查找方法注入，尤其是当这些 bean
都是单例时。原因很好理解，都是单例时使用方法注入会导致运行时间增长，书中的例子中达到了1：400以上的差异。</li>
<li>只有在必要的时候才使用查找方法注
入，即使当拥有不同生命周期的bean时。</li>
<li>这只适用于 XML
配置，基于注解的配置强制方法的空白实现，否则，就不会创建bean。</li>
</ul>
<h4 id="方法替换">方法替换</h4>
<p>该手段的场景如下：例如， 有一个在 Spring 应用程序中使用了第三方库，
并且需要更改某个方法的逻辑。
此时，无法更改源代码，因为它是由第三方提供的，所以一种解决方案是使用方法替换，使用自己的实现来替换该方法的逻辑。</p>
<p>我们还是用代码来说明，假设这里有一个库函数，我们不能修改：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotated3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReplacementTarget</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">formatMessage</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;h1&gt;&quot;</span> + msg + <span class="string">&quot;&lt;/h1&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">formatMessage</span><span class="params">(Object msg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;h1&gt;&quot;</span> + msg + <span class="string">&quot;&lt;/h1&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该库函数有两个方法，即重载，且渲染标签为<code>&lt;h1&gt;</code>，那我不想要了，我想要<code>&lt;h2&gt;</code>怎么在不能修改库函数的代码来实现？</p>
<p>首先我们定义业务逻辑，需要实现MethodReplacer接口，并覆写reimplement方法参数说明见下方：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotated3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.MethodReplacer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FormatMessageReplacer</span> <span class="keyword">implements</span> <span class="title class_">MethodReplacer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args0 被调用的原始方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method 被重写的方法的Method实例</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args 该方法的参数数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 重写方法后执行的结果</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable IllegalArgumentException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">reimplement</span><span class="params">(Object args0, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFormatMessageMethod(method)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> (String) args[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&lt;h2&gt;&quot;</span> + msg + <span class="string">&quot;&lt;/h2&gt;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Unable to reimplement method &quot;</span></span><br><span class="line">                    + method.getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFormatMessageMethod</span><span class="params">(Method method)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (method.getParameterTypes().length != <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!(<span class="string">&quot;formatMessage&quot;</span>.equals(method.getName()))) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (method.getReturnType() != String.class) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (method.getParameterTypes()[<span class="number">0</span>] != String.class) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们使用了一个过滤器来使传入的方法一定是这样的：<code>Sring formatMessage(String args)</code>。即我们要重新实现库函数的第一个方法。</p>
<p>定义XML:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;methodReplacer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;annotated3.FormatMessageReplacer&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;replacementTarget&quot;</span> <span class="attr">class</span>=<span class="string">&quot;annotated3.ReplacementTarget&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">replaced-method</span> <span class="attr">name</span>=<span class="string">&quot;formatMessage&quot;</span> <span class="attr">replacer</span>=<span class="string">&quot;methodReplacer&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg-type</span>&gt;</span>String<span class="tag">&lt;/<span class="name">arg-type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">replaced-method</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;standardTarget&quot;</span> <span class="attr">class</span>=<span class="string">&quot;annotated3.ReplacementTarget&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们定义了两种bean，<code>methodReplacer</code>就是我们的重实现器，另外有两个<code>ReplacementTarget</code>的bean，并把其中一个使用<code>replaced-method</code>标签指定重实现方法名为<code>formatMessage</code>、重实现器为<code>methodReplacer</code>、有两个重载你要换哪一个？使用arg-type指定我们要换的是参数类型为String的哪一个，这里的值Spring会自己器正则匹配，所以不用写成<code>java.lang.String</code>。另一个就是原库函数bean，不做修改。下来是主函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotated3;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StopWatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodReplacementDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;spring/method-DI.xml&quot;</span>);</span><br><span class="line">        <span class="type">ReplacementTarget</span> <span class="variable">replacementTarget</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;replacementTarget&quot;</span>, ReplacementTarget.class);</span><br><span class="line">        <span class="type">ReplacementTarget</span> <span class="variable">standardTarget</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;standardTarget&quot;</span>, ReplacementTarget.class);</span><br><span class="line"></span><br><span class="line">        displayInfo(replacementTarget);</span><br><span class="line">        displayInfo(standardTarget);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">displayInfo</span><span class="params">(ReplacementTarget target)</span> &#123;</span><br><span class="line">        System.out.println(target.formatMessage(<span class="string">&quot;Thanks for reading&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">StopWatch</span> <span class="variable">stopWatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>();</span><br><span class="line">        stopWatch.start(<span class="string">&quot;perTest&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0</span>; x &lt; <span class="number">1000000</span>; x++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">out</span> <span class="operator">=</span> target.formatMessage(<span class="string">&quot;No filter in my head.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stopWatch.stop();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;100000 invocations took: &quot;</span> + stopWatch.getTotalTimeMillis() + <span class="string">&quot; ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们让他们输出消息<code>Thanks for reading</code>，看看标签有没有被换好。下面<code>displayInfo</code>函数是用来计算原函数和重新实现后的函数的效率，注意，包括上面的查找注入，它们都是Spring使用了CGLIB类的结果。那看一下运行结果：</p>
<p><img src="/img/Spring学习-IOC机制/image-20200509201219913.png" /></p>
<p>OK，我们看到<code>&lt;h1&gt;</code>标签被换为了<code>&lt;h2&gt;</code>标签，说明重新实现成功，且被换了后的函数的性能是未换的性能的1/5，啧啧，真垃圾。</p>
<p>那么依然是注意事项：</p>
<ul>
<li>如果想要使用方法替换作为应用程序的一部分，建议为每个方法或一组重载的方法使用一个
MethodReplacer。</li>
<li>很多人也仍然倾向于使用标准的Java机制来重写方法，而不是依赖于运行时字节码的增强。</li>
</ul>
<h3 id="小结">小结</h3>
<p>上述常见的注入方式实际上就三个，即：构造器注入、Setter注入、字段注入。分别常见用处如下：</p>
<ul>
<li>构造器注入常见于强制对象注入</li>
<li>Setter注入常见于可选对象注入</li>
<li>字段注入<strong>应当避免</strong></li>
</ul>
<h2 id="总结">总结</h2>
<p>上面写的这些东西其实是蛮多的，一两天可能才能消化吸收，也有一些我是没有写出来的，比较费时间(其实是我懒了)，如如何在依赖注入中注入特定的数据类型？如简单类型？Map、Set、List、Properties类型？这些都是通过bean标签来控制的；除了单例和多例还有哪些作用域？(请求作用域、会话作用域)；怎么在XML里或java配置里给bean起别名？这些我后面会补充，你也可以参考这个视频进行学习：https://www.imooc.com/learn/1108。</p>
<p>到此IoC机制就基本学完了，依赖注入的概念、四种手段方法、配置方法、注解方法都了解了。下一篇进行AoP的学习，完后开始SpringMVC及SpringBoot、SpringCloud的正式学习，另会写写华为servicecomb的使用。冲冲冲。</p>
<h2 id="参考">参考</h2>
<ul>
<li><a
target="_blank" rel="noopener" href="https://blog.csdn.net/ricky73999/article/details/56683920/">浅谈MVC</a></li>
<li>https://www.cnblogs.com/best/p/5653916.html</li>
<li>https://zhuanlan.zhihu.com/p/64001753</li>
<li>https://blog.csdn.net/dkbnull/article/details/87219562</li>
<li><em>《Spring5高级编程(第五版)》</em></li>
<li>https://www.imooc.com/learn/1108</li>
</ul>

    </article>
    <!-- license -->
        <div class="license-wrapper">
            <p>原文作者：<a href="https://lzwgiter.github.io">f10@t</a>
            <p>原文链接：<a href="https://lzwgiter.github.io/posts/44088610/">https://lzwgiter.github.io/posts/44088610/</a>
            <p>发表日期：<a href="https://lzwgiter.github.io/posts/44088610/">五月 6日 2020, 2:13:40 下午</a>
            <p>更新日期：<a href="https://lzwgiter.github.io/posts/44088610/">July 24th 2024, 10:44:32 am</a>
            <p>版权声明：本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    <!-- paginator -->
    <ul class="post-paginator">
        <li class="next">
                <div class="nextSlogan">Next Post</div>
                <a href="/posts/a9e6a25b/" title="Spring基础学习 - AOP机制">
                    <div class="nextTitle">Spring基础学习 - AOP机制</div>
                </a>
        </li>
        <li class="previous">
                <div class="prevSlogan">Previous Post</div>
                <a href="/posts/b92dbb83/" title="JavaEE基础 - Servlet">
                    <div class="prevTitle">JavaEE基础 - Servlet</div>
                </a>
        </li>
    </ul>
    <!-- comment -->
        <div class="post-comment">
            <!-- 来必力 City 版安装代码 -->

            
            
            
            <!-- utteranc评论 -->

            <!-- partial('_partial/comment/changyan') -->
            <!--PC版-->

            
                <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <div id="comment"></div>
    <script>
        new Valine({
            el: '#comment',
            notify:false,
            verify:false,
            appId: "KADRlHg5xXyhKL0d6USDWfIB-gzGzoHsz",
            appKey: "Ppj8kIdro2yDqXOvqWkTRxuW",
            placeholder: "递咖啡就坐(　o=^•ェ•)o　┏━┓（填写邮箱地址可以收到邮件回复捏）",
            path:window.location.pathname,
            avatar:'mm'
        });
    </script>

            
        </div>
    <!-- timeliness note -->
    <!-- idea from: https://hexo.fluid-dev.com/posts/hexo-injector/#%E6%96%87%E7%AB%A0%E6%97%B6%E6%95%88%E6%80%A7%E6%8F%90%E7%A4%BA -->
    <!-- Mathjax -->
</main>

                <!-- profile -->
            </div>
            <footer class="footer footer-unloaded">
    <!-- social  -->
        <div class="social">
                            <a href="//github.com/lzwgiter" class="iconfont-archer github" target="_blank" title="github"></a>

        </div>
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- website approve for Chinese user -->
    <!-- 不蒜子  -->
        <div class="busuanzi-container">
                <span id="busuanzi_container_site_uv">做客的小伙伴数: <span id="busuanzi_value_site_uv"></span></span>
        </div>
</footer>

        </div>
        <!-- toc -->
            <div class="toc-wrapper toc-wrapper-loding" style=    top:50vh;
>
                <div class="toc-catalog">
                    <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
                </div>
                <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#spring-%E5%85%A8%E5%AE%B6%E6%A1%B6"><span class="toc-number">1.</span> <span class="toc-text">Spring 全家桶</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#spring%E7%9A%84%E6%89%80%E6%9C%89%E5%8C%85%E6%A8%A1%E5%9D%97"><span class="toc-number">2.</span> <span class="toc-text">Spring的所有包模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ioc"><span class="toc-number">3.</span> <span class="toc-text">IOC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#javabean"><span class="toc-number">3.1.</span> <span class="toc-text">JavaBean</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E5%AE%9E%E4%BE%8B"><span class="toc-number">3.1.1.</span> <span class="toc-text">一个实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8spring%E9%87%8D%E6%9E%84%E5%AE%9E%E4%BE%8B"><span class="toc-number">3.1.2.</span> <span class="toc-text">使用Spring重构实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="toc-number">3.1.3.</span> <span class="toc-text">基于注解的依赖注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#di%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.2.</span> <span class="toc-text">DI的类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E6%B3%A8%E5%85%A5"><span class="toc-number">3.2.1.</span> <span class="toc-text">构造函数注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#xml%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">XML配置方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">注解配置方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setter%E6%B3%A8%E5%85%A5"><span class="toc-number">3.2.2.</span> <span class="toc-text">setter注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#xml%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95-1"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">XML配置方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95-1"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">注解配置方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E6%AE%B5%E6%B3%A8%E5%85%A5"><span class="toc-number">3.2.3.</span> <span class="toc-text">字段注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E6%B3%A8%E5%85%A5"><span class="toc-number">3.2.4.</span> <span class="toc-text">方法注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E6%B3%A8%E5%85%A5"><span class="toc-number">3.2.4.1.</span> <span class="toc-text">查找注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E6%9B%BF%E6%8D%A2"><span class="toc-number">3.2.4.2.</span> <span class="toc-text">方法替换</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">3.2.5.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">3.3.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">3.4.</span> <span class="toc-text">参考</span></a></li></ol></li></ol>
            </div>
        <!-- sidebar -->
        <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
        <div class="sidebar-panel-archives">
    <!-- 在 ejs 中将 archive 按照时间排序 -->
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    <div class="total-and-search">
        <div class="total-archive">
        Total : 99
        </div>
        <!-- search  -->
            <div class="site-search site-search-loading popup-trigger">
                <span class="iconfont-archer search-icon">&#xe627;</span>
            </div>
    </div>
    <div class="post-archive">
            <div class="archive-year"> 2024 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">08/05</span>
            <a class="archive-post-title" href="/posts/54e979b4/">RabbitMQ学习</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/23</span>
            <a class="archive-post-title" href="/posts/963fb8d3/">领域驱动设计学习（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/06</span>
            <a class="archive-post-title" href="/posts/21f893eb/">学鲁菜之酱焖鲈鱼</a>
        </li>
                </ul>
            <div class="archive-year"> 2023 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">10/22</span>
            <a class="archive-post-title" href="/posts/33ea2108/">Spring AOP再探</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/09</span>
            <a class="archive-post-title" href="/posts/c41813ec/">重新审视微服务</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/04</span>
            <a class="archive-post-title" href="/posts/85bf5302/">K8s攻防之OWASP-K8S-TOP10（下）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/16</span>
            <a class="archive-post-title" href="/posts/8aa36aba/">K8s攻防之OWASP-K8S-TOP10（上）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/08</span>
            <a class="archive-post-title" href="/posts/c16d1cd9/">Java内存马原理（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/08</span>
            <a class="archive-post-title" href="/posts/e2947908/">Java Instrument机制及管窥IAST</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/03</span>
            <a class="archive-post-title" href="/posts/479daa6d/">gRPC简介与使用</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/30</span>
            <a class="archive-post-title" href="/posts/b74b8800/">fastjson反序列化漏洞学习（二）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/07</span>
            <a class="archive-post-title" href="/posts/73d00ee7/">Netty框架学习</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/04</span>
            <a class="archive-post-title" href="/posts/d6b305b7/">Java网络编程模型复习</a>
        </li>
                </ul>
            <div class="archive-year"> 2022 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">04/26</span>
            <a class="archive-post-title" href="/posts/203767b8/">python-Numpy库使用</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/20</span>
            <a class="archive-post-title" href="/posts/f06096b/">MATLAB - Wireless Communication Onramp</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/19</span>
            <a class="archive-post-title" href="/posts/3041f265/">Matlab编程基础</a>
        </li>
                </ul>
            <div class="archive-year"> 2021 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">10/04</span>
            <a class="archive-post-title" href="/posts/169c63d0/">Bloom Filter概念原理</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/25</span>
            <a class="archive-post-title" href="/posts/85e98ef0/">zk-SNARKs简洁的非交互式零知识证明学习(一)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/22</span>
            <a class="archive-post-title" href="/posts/a8e0eb2d/">Quarkus学习（一）概述以及编写REST服务</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/19</span>
            <a class="archive-post-title" href="/posts/e88577c0/">Cloud Programming Simplified:A Berkeley View on Serverless Computing</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/18</span>
            <a class="archive-post-title" href="/posts/99665dc1/">闲聊一下Java中的DI和CDI</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/12</span>
            <a class="archive-post-title" href="/posts/ed901271/">Kubernetes-集群环境搭建使用及问题记录（三）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/09</span>
            <a class="archive-post-title" href="/posts/a08eb123/">Kubernetes-集群环境搭建使用及问题记录（二）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/03</span>
            <a class="archive-post-title" href="/posts/eed4a979/">Kubernetes 集群环境搭建使用及问题记录（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/24</span>
            <a class="archive-post-title" href="/posts/2f0b60dd/">闲聊一下Go语言的函数方法和多态机制特点</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/14</span>
            <a class="archive-post-title" href="/posts/5893facf/">express学习（一）-基于NodeJS的Web框架</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/10</span>
            <a class="archive-post-title" href="/posts/8a9b0b34/">Beego学习-ORM</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/06</span>
            <a class="archive-post-title" href="/posts/84db08d3/">Beego学习-路由设置</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/06</span>
            <a class="archive-post-title" href="/posts/a9031312/">docker-compose及dockerfile总结</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/09</span>
            <a class="archive-post-title" href="/posts/77d22b2a/">Spring安全技术-Spring Security使用及总结（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/28</span>
            <a class="archive-post-title" href="/posts/5e9eec21/">DevOps技术-简单了解与入门</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/23</span>
            <a class="archive-post-title" href="/posts/27875254/">Spring持久层技术-Sping Data JPA使用及总结（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/14</span>
            <a class="archive-post-title" href="/posts/bec529bf/">以太坊智能合约开发环境搭建及智能合约的编写、部署、测试</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/11</span>
            <a class="archive-post-title" href="/posts/2ff8a9fd/">以太坊基本概念与实验环境搭建</a>
        </li>
                </ul>
            <div class="archive-year"> 2020 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">06/17</span>
            <a class="archive-post-title" href="/posts/bcd864e2/">DC-1靶机渗透</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/31</span>
            <a class="archive-post-title" href="/posts/c99165fd/">fastjson反序列化漏洞学习（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/09</span>
            <a class="archive-post-title" href="/posts/a9e6a25b/">Spring基础学习 - AOP机制</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/06</span>
            <a class="archive-post-title" href="/posts/b92dbb83/">JavaEE基础 - Servlet</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/06</span>
            <a class="archive-post-title" href="/posts/44088610/">Spring基础学习 - IOC机制</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/01</span>
            <a class="archive-post-title" href="/posts/662e1cfe/">微服务入门-5W和微服务思想</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/22</span>
            <a class="archive-post-title" href="/posts/c75c5fc7/">Java 反序列化漏洞与JNDI注入(下)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/14</span>
            <a class="archive-post-title" href="/posts/5dcfa8b5/">Kerberos认证过程原理及攻击手段</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/26</span>
            <a class="archive-post-title" href="/posts/1ccc94ff/">内存布局与栈溢出&堆溢出原理</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/21</span>
            <a class="archive-post-title" href="/posts/bc7cb7a1/">入坑Pwn之刷题补坑</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/29</span>
            <a class="archive-post-title" href="/posts/760e25d9/">内存取证原理学习及Volatility - 篇二</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/22</span>
            <a class="archive-post-title" href="/posts/b0024cb7/">Struts框架管窥以及几个漏洞的分析</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/09</span>
            <a class="archive-post-title" href="/posts/8ce0a80d/">Redis未授权访问漏洞及修补方法</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/08</span>
            <a class="archive-post-title" href="/posts/13fe3d9f/">本地提权与漏洞提权</a>
        </li>
                </ul>
            <div class="archive-year"> 2019 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">12/21</span>
            <a class="archive-post-title" href="/posts/f8b67901/">逆向工程课程小结</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/08</span>
            <a class="archive-post-title" href="/posts/4d8e0b70/">内存取证原理学习及Volatility - 篇一</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/20</span>
            <a class="archive-post-title" href="/posts/82490df7/">并发模型之单线程多路I/O复用---select</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/29</span>
            <a class="archive-post-title" href="/posts/a715340f/">入坑Pwn之基本知识</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/10</span>
            <a class="archive-post-title" href="/posts/47dcecb9/">Apache-Commons-Collections反序列化漏洞</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/03</span>
            <a class="archive-post-title" href="/posts/de476e86/">Java 反序列化漏洞与JNDI注入(上)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/20</span>
            <a class="archive-post-title" href="/posts/7a9a17f3/">记录一次对win2k3 Enterprise Edition的永恒之蓝利用</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/11</span>
            <a class="archive-post-title" href="/posts/6f24bb1d/">kali-渗透测试-信息收集3</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/10</span>
            <a class="archive-post-title" href="/posts/18238b8b/">kali-渗透测试-信息收集2</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">03/18</span>
            <a class="archive-post-title" href="/posts/812ada31/">kali-渗透测试-信息收集1</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/11</span>
            <a class="archive-post-title" href="/posts/fffcd997/">Metasploit渗透测试魔鬼训练营-客户端渗透攻击</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/10</span>
            <a class="archive-post-title" href="/posts/30b79e7d/">Metasploit渗透测试魔鬼训练营-Windows服务漏洞MS08-067实战与分析总结</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/07</span>
            <a class="archive-post-title" href="/posts/79017d0/">Metasploit渗透测试魔鬼训练营-web应用渗透</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/06</span>
            <a class="archive-post-title" href="/posts/6c9a4aca/">Metasploit渗透测试魔鬼训练营-服务扫描与查点</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/04</span>
            <a class="archive-post-title" href="/posts/ed61533c/">Metasploit渗透测试魔鬼训练营-信息收集</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/22</span>
            <a class="archive-post-title" href="/posts/ba8e1564/">Metasploit渗透测试魔鬼训练营 第一天</a>
        </li>
                </ul>
            <div class="archive-year"> 2018 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">12/28</span>
            <a class="archive-post-title" href="/posts/dd591816/">小明的博客--Typecho 反序列化漏洞</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/10</span>
            <a class="archive-post-title" href="/posts/41159e88/">Bugku的一道注入---多次</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/06</span>
            <a class="archive-post-title" href="/posts/26bacf07/">Bugku的一道注入--INSERT INTO注入</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/26</span>
            <a class="archive-post-title" href="/posts/e1cf93ae/">ThinkPHP框架学习---路由</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/25</span>
            <a class="archive-post-title" href="/posts/dec252e7/">ThinkPHP框架学习---config类和config助手函数</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/25</span>
            <a class="archive-post-title" href="/posts/8405173/">ThinkPHP框架学习---框架目录及框架配置</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/19</span>
            <a class="archive-post-title" href="/posts/5d13a793/">Nmap使用指南</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/12</span>
            <a class="archive-post-title" href="/posts/e6caa5f0/">SQL注入小记(二)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/09</span>
            <a class="archive-post-title" href="/posts/78f948a4/">PHP学习--超级全局变量</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/08</span>
            <a class="archive-post-title" href="/posts/777d53bb/">PHP学习--变量</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/03</span>
            <a class="archive-post-title" href="/posts/f0bc436c/">PHP框架MVC学习</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/30</span>
            <a class="archive-post-title" href="/posts/117580c0/">CTF中的python脚本题小结（二）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/30</span>
            <a class="archive-post-title" href="/posts/21636c18/">CTF中的python脚本题小结（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/20</span>
            <a class="archive-post-title" href="/posts/fc74b0ce/">Hackergame 2018 wp</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/25</span>
            <a class="archive-post-title" href="/posts/8c800523/">安恒九月题的misc和一道web</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/10</span>
            <a class="archive-post-title" href="/posts/49fb3e92/">SQL注入小记(一)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/27</span>
            <a class="archive-post-title" href="/posts/21c35507/">隐写术-LSB隐写</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/26</span>
            <a class="archive-post-title" href="/posts/59bc0c0/">隐写术--NTFS流隐写</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/25</span>
            <a class="archive-post-title" href="/posts/c7cffe19/">CTF常见隐写手段小结</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/22</span>
            <a class="archive-post-title" href="/posts/69896e9f/">DOM 文档对象模型</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/21</span>
            <a class="archive-post-title" href="/posts/20cf0786/">BOM-浏览器操作对象模型之history和screen对象</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/20</span>
            <a class="archive-post-title" href="/posts/f92f304f/">BOM 浏览器操作对象模型之navigator、location对象</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/18</span>
            <a class="archive-post-title" href="/posts/79f16c6a/">BOM-浏览器操作对象模型之window对象</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/16</span>
            <a class="archive-post-title" href="/posts/aa0a7b0a/">Javascript基础之数据类型2</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/15</span>
            <a class="archive-post-title" href="/posts/33032ab0/">Javascript基础之数据类型1</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/12</span>
            <a class="archive-post-title" href="/posts/b5fac929/">CTF隐写术--关于ZIP</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/09</span>
            <a class="archive-post-title" href="/posts/98736a90/">CSS样式基础4.4--选择器之伪类选择器</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/08</span>
            <a class="archive-post-title" href="/posts/17442633/">Bugku的一道misc-----猫片</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/08</span>
            <a class="archive-post-title" href="/posts/d4db3e56/">CSS基础4.3--选择器之属性选择器</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/05</span>
            <a class="archive-post-title" href="/posts/7b6c38ce/">CSS基础4.2--选择器之组合选择器</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/03</span>
            <a class="archive-post-title" href="/posts/6027632/">CSS基础4.1--选择器之CSS基础4.1-选择器之基本选择器</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/02</span>
            <a class="archive-post-title" href="/posts/370eaad5/">CSS基础3.2--特性之CSS基础3.2--特性之继承性</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/01</span>
            <a class="archive-post-title" href="/posts/4655c16f/">CSS基础3.1--特性之CSS基础3.1-特性之层叠性</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/01</span>
            <a class="archive-post-title" href="/posts/ae68c748/">CSS基础2--CSS基础2-应用</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/01</span>
            <a class="archive-post-title" href="/posts/6b427aa1/">CSS基础1--样式</a>
        </li>
            </ul>
    </div>
</div>

        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
            <span class="sidebar-tag-name" data-tags="Java">
                <span class="iconfont-archer">&#xe606;</span>
                Java
            </span>
            <span class="sidebar-tag-name" data-tags="开发技术">
                <span class="iconfont-archer">&#xe606;</span>
                开发技术
            </span>
            <span class="sidebar-tag-name" data-tags="区块链技术">
                <span class="iconfont-archer">&#xe606;</span>
                区块链技术
            </span>
            <span class="sidebar-tag-name" data-tags="渗透测试">
                <span class="iconfont-archer">&#xe606;</span>
                渗透测试
            </span>
            <span class="sidebar-tag-name" data-tags="漏洞分析">
                <span class="iconfont-archer">&#xe606;</span>
                漏洞分析
            </span>
            <span class="sidebar-tag-name" data-tags="web安全">
                <span class="iconfont-archer">&#xe606;</span>
                web安全
            </span>
            <span class="sidebar-tag-name" data-tags="前端">
                <span class="iconfont-archer">&#xe606;</span>
                前端
            </span>
            <span class="sidebar-tag-name" data-tags="Go语言">
                <span class="iconfont-archer">&#xe606;</span>
                Go语言
            </span>
            <span class="sidebar-tag-name" data-tags="Go Web">
                <span class="iconfont-archer">&#xe606;</span>
                Go Web
            </span>
            <span class="sidebar-tag-name" data-tags="论文阅读">
                <span class="iconfont-archer">&#xe606;</span>
                论文阅读
            </span>
            <span class="sidebar-tag-name" data-tags="CTF">
                <span class="iconfont-archer">&#xe606;</span>
                CTF
            </span>
            <span class="sidebar-tag-name" data-tags="SQL注入">
                <span class="iconfont-archer">&#xe606;</span>
                SQL注入
            </span>
            <span class="sidebar-tag-name" data-tags="CSS">
                <span class="iconfont-archer">&#xe606;</span>
                CSS
            </span>
            <span class="sidebar-tag-name" data-tags="python">
                <span class="iconfont-archer">&#xe606;</span>
                python
            </span>
            <span class="sidebar-tag-name" data-tags="隐写术">
                <span class="iconfont-archer">&#xe606;</span>
                隐写术
            </span>
            <span class="sidebar-tag-name" data-tags="云技术">
                <span class="iconfont-archer">&#xe606;</span>
                云技术
            </span>
            <span class="sidebar-tag-name" data-tags="DevOps">
                <span class="iconfont-archer">&#xe606;</span>
                DevOps
            </span>
            <span class="sidebar-tag-name" data-tags="开发与运维">
                <span class="iconfont-archer">&#xe606;</span>
                开发与运维
            </span>
            <span class="sidebar-tag-name" data-tags="DevSecOps">
                <span class="iconfont-archer">&#xe606;</span>
                DevSecOps
            </span>
            <span class="sidebar-tag-name" data-tags="网络编程">
                <span class="iconfont-archer">&#xe606;</span>
                网络编程
            </span>
            <span class="sidebar-tag-name" data-tags="Kubernete">
                <span class="iconfont-archer">&#xe606;</span>
                Kubernete
            </span>
            <span class="sidebar-tag-name" data-tags="云安全">
                <span class="iconfont-archer">&#xe606;</span>
                云安全
            </span>
            <span class="sidebar-tag-name" data-tags="分布式技术">
                <span class="iconfont-archer">&#xe606;</span>
                分布式技术
            </span>
            <span class="sidebar-tag-name" data-tags="MatLab">
                <span class="iconfont-archer">&#xe606;</span>
                MatLab
            </span>
            <span class="sidebar-tag-name" data-tags="PHP">
                <span class="iconfont-archer">&#xe606;</span>
                PHP
            </span>
            <span class="sidebar-tag-name" data-tags="微服务技术">
                <span class="iconfont-archer">&#xe606;</span>
                微服务技术
            </span>
            <span class="sidebar-tag-name" data-tags="Quarkus">
                <span class="iconfont-archer">&#xe606;</span>
                Quarkus
            </span>
            <span class="sidebar-tag-name" data-tags="Spring">
                <span class="iconfont-archer">&#xe606;</span>
                Spring
            </span>
            <span class="sidebar-tag-name" data-tags="docker">
                <span class="iconfont-archer">&#xe606;</span>
                docker
            </span>
            <span class="sidebar-tag-name" data-tags="NodeJS">
                <span class="iconfont-archer">&#xe606;</span>
                NodeJS
            </span>
            <span class="sidebar-tag-name" data-tags="express">
                <span class="iconfont-archer">&#xe606;</span>
                express
            </span>
            <span class="sidebar-tag-name" data-tags="密码学">
                <span class="iconfont-archer">&#xe606;</span>
                密码学
            </span>
            <span class="sidebar-tag-name" data-tags="以太坊">
                <span class="iconfont-archer">&#xe606;</span>
                以太坊
            </span>
            <span class="sidebar-tag-name" data-tags="智能合约">
                <span class="iconfont-archer">&#xe606;</span>
                智能合约
            </span>
            <span class="sidebar-tag-name" data-tags="pwn">
                <span class="iconfont-archer">&#xe606;</span>
                pwn
            </span>
            <span class="sidebar-tag-name" data-tags="电子取证">
                <span class="iconfont-archer">&#xe606;</span>
                电子取证
            </span>
            <span class="sidebar-tag-name" data-tags="日常">
                <span class="iconfont-archer">&#xe606;</span>
                日常
            </span>
            <span class="sidebar-tag-name" data-tags="C编程">
                <span class="iconfont-archer">&#xe606;</span>
                C编程
            </span>
            <span class="sidebar-tag-name" data-tags="课程总结">
                <span class="iconfont-archer">&#xe606;</span>
                课程总结
            </span>
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
        缺失模块，请参考主题文档进行安装配置：https://github.com/fi3ework/hexo-theme-archer#%E5%AE%89%E8%A3%85%E4%B8%BB%E9%A2%98
    </div> 
    <div class="sidebar-tags-list"></div>
</div>

        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
        <span class="sidebar-category-name" data-categories="开发技术">
            <span class="iconfont-archer">&#xe60a;</span>
            开发技术
        </span>
        <span class="sidebar-category-name" data-categories="区块链技术">
            <span class="iconfont-archer">&#xe60a;</span>
            区块链技术
        </span>
        <span class="sidebar-category-name" data-categories="漏洞分析">
            <span class="iconfont-archer">&#xe60a;</span>
            漏洞分析
        </span>
        <span class="sidebar-category-name" data-categories="论文阅读">
            <span class="iconfont-archer">&#xe60a;</span>
            论文阅读
        </span>
        <span class="sidebar-category-name" data-categories="CTF">
            <span class="iconfont-archer">&#xe60a;</span>
            CTF
        </span>
        <span class="sidebar-category-name" data-categories="渗透测试">
            <span class="iconfont-archer">&#xe60a;</span>
            渗透测试
        </span>
        <span class="sidebar-category-name" data-categories="DevSecOps">
            <span class="iconfont-archer">&#xe60a;</span>
            DevSecOps
        </span>
        <span class="sidebar-category-name" data-categories="云安全">
            <span class="iconfont-archer">&#xe60a;</span>
            云安全
        </span>
        <span class="sidebar-category-name" data-categories="MATLAB">
            <span class="iconfont-archer">&#xe60a;</span>
            MATLAB
        </span>
        <span class="sidebar-category-name" data-categories="密码学">
            <span class="iconfont-archer">&#xe60a;</span>
            密码学
        </span>
        <span class="sidebar-category-name" data-categories="电子取证">
            <span class="iconfont-archer">&#xe60a;</span>
            电子取证
        </span>
        <span class="sidebar-category-name" data-categories="课程总结">
            <span class="iconfont-archer">&#xe60a;</span>
            课程总结
        </span>
        <span class="sidebar-category-name" data-categories="杂谈">
            <span class="iconfont-archer">&#xe60a;</span>
            杂谈
        </span>
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>

    </div>
</div>

        <!-- site-meta -->
        <script>
    var siteMetaRoot = "/"
    if (siteMetaRoot === "undefined") {
        siteMetaRoot = '/'
    }
    var siteMeta = {
        url: "https://lzwgiter.github.io",
        root: siteMetaRoot,
        author: "f10@t"
    }
</script>

        <!-- import experimental options here -->
        <!-- Custom Font -->

        <!-- main func -->
        <script src="/scripts/main.js"></script>
        <!-- fancybox -->
        <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.umd.js" onload="window.Fancybox.bind('[data-fancybox]')" defer></script>
        <!-- algolia -->
            <div class="site-search site-search-loading">
    <div class="algolia-popup popup">
        <div class="algolia-search">
            <div class="algolia-search-input-icon">
                <i class="fa fa-search"></i>
            </div>
            <div class="algolia-search-input" id="algolia-search-input"></div>
            <div class="popup-btn-close">
                <i class="iconfont-archer">&#xe609;</i>
            </div>
        </div>

        <div class="algolia-results">
            <div id="algolia-stats" class="algolia-stats"></div>
            <div id="algolia-hits"></div>
            <div id="algolia-pagination" class="algolia-pagination"></div>
        </div>
    </div>
</div>

            <script src="/scripts/search.js" async></script>
        <!-- busuanzi -->
            <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
        <!-- async load share.js -->
            <script src="/scripts/share.js" async></script>
        <!-- mermaid -->
    </body>
</html>
