<!DOCTYPE html>
<html lang="zh-CN">
    <!-- title -->
<!-- keywords -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="author" content="f10@t">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="f10@t">
        <meta name="keywords" content="lzwgiter,f10@t's blog">
    <meta name="description" content="blogs by f10@t">
    <meta name="description" content="上一篇中我搭建了一个单master+三个从节点的Kubernetes集群，并直接使用nginx镜像进行了简单部署。这一篇来主要学习一下Kubernetes最主要的功能--容器编排。本篇将记录容器编排的重要概念、配置文件如何辨写开始，最后展示一个很简单的Hello-world。下一篇将深入实战，部署一个SpringCloud项目。   image-20210810183438958">
<meta property="og:type" content="article">
<meta property="og:title" content="Kubernetes-集群环境搭建使用及问题记录（二）">
<meta property="og:url" content="https://lzwgiter.github.io/posts/a08eb123.html">
<meta property="og:site_name" content="f10@t&#39;s blog">
<meta property="og:description" content="上一篇中我搭建了一个单master+三个从节点的Kubernetes集群，并直接使用nginx镜像进行了简单部署。这一篇来主要学习一下Kubernetes最主要的功能--容器编排。本篇将记录容器编排的重要概念、配置文件如何辨写开始，最后展示一个很简单的Hello-world。下一篇将深入实战，部署一个SpringCloud项目。   image-20210810183438958">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-08-09T02:29:31.000Z">
<meta property="article:modified_time" content="2021-10-29T07:55:50.000Z">
<meta property="article:author" content="f10@t">
<meta property="article:tag" content="Kubernete">
<meta property="article:tag" content="分布式技术">
<meta name="twitter:card" content="summary">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="icon" href="/assets/hello.svg">
    <title>Kubernetes-集群环境搭建使用及问题记录（二） · f10@t&#39;s blog</title>
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
    (function (w) {
        'use strict'
        // rel=preload support test
        if (!w.loadCSS) {
            w.loadCSS = function () {}
        }
        // define on the loadCSS obj
        var rp = (loadCSS.relpreload = {})
        // rel=preload feature support test
        // runs once and returns a function for compat purposes
        rp.support = (function () {
            var ret
            try {
                ret = w.document.createElement('link').relList.supports('preload')
            } catch (e) {
                ret = false
            }
            return function () {
                return ret
            }
        })()

        // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
        // then change that media back to its intended value on load
        rp.bindMediaToggle = function (link) {
            // remember existing media attr for ultimate state, or default to 'all'
            var finalMedia = link.media || 'all'

            function enableStylesheet() {
                link.media = finalMedia
            }

            // bind load handlers to enable media
            if (link.addEventListener) {
                link.addEventListener('load', enableStylesheet)
            } else if (link.attachEvent) {
                link.attachEvent('onload', enableStylesheet)
            }

            // Set rel and non-applicable media type to start an async request
            // note: timeout allows this to happen async to let rendering continue in IE
            setTimeout(function () {
                link.rel = 'stylesheet'
                link.media = 'only x'
            })
            // also enable media after 3 seconds,
            // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
            setTimeout(enableStylesheet, 3000)
        }

        // loop through link elements in DOM
        rp.poly = function () {
            // double check this to prevent external calls from running
            if (rp.support()) {
                return
            }
            var links = w.document.getElementsByTagName('link')
            for (var i = 0; i < links.length; i++) {
                var link = links[i]
                // qualify links to those with rel=preload and as=style attrs
                if (
                    link.rel === 'preload' &&
                    link.getAttribute('as') === 'style' &&
                    !link.getAttribute('data-loadcss')
                ) {
                    // prevent rerunning on link
                    link.setAttribute('data-loadcss', true)
                    // bind listeners to toggle media back
                    rp.bindMediaToggle(link)
                }
            }
        }

        // if unsupported, run the polyfill
        if (!rp.support()) {
            // run once at least
            rp.poly()

            // rerun poly on an interval until onload
            var run = w.setInterval(rp.poly, 500)
            if (w.addEventListener) {
                w.addEventListener('load', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            } else if (w.attachEvent) {
                w.attachEvent('onload', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            }
        }

        // commonjs
        if (typeof exports !== 'undefined') {
            exports.loadCSS = loadCSS
        } else {
            w.loadCSS = loadCSS
        }
    })(typeof global !== 'undefined' ? global : this)
</script>

    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .footer-fixed-btn,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(
            -45deg,
            #444 0,
            #444 80px,
            #333 80px,
            #333 160px
        );
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }
</style>

    <link id="stylesheet-fancybox" rel="preload" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link id="stylesheet-base" rel="preload" href="/css/style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link id="stylesheet-mobile" rel="preload" href="/css/mobile.css" as="style" onload="this.onload=null;this.rel='stylesheet';this.media='screen and (max-width: 960px)'">
    <link id="stylesheet-theme-dark" rel="preload" href="/css/dark.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" as="script">
    <link rel="preload" href="/scripts/main.js" as="script">
    <link rel="preload" href="/font/Oswald-Regular.ttf" as="font" crossorigin>
    <link rel="preload" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" as="font" crossorigin>
    <!-- algolia -->
        <script>
            var hits = JSON.parse('{"per_page":10}')
            var labels = JSON.parse('{"input_placeholder":"搜索文章相关内容","hits_empty":"${query}搜索结果为空: ","hits_stats":"找到结果${hits}条，用时${time} ms"}')

            var algolia = {
                applicationID: 'M469ZFXTNU',
                apiKey: '32b991ddc2b9f92be99f0e241d0f12d4',
                indexName: 'blog_indices',
                hits: hits,
                labels: labels
            }
        </script>
    <!-- 百度统计  -->
        <script>
            var _hmt = _hmt || [];
            (function () {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?9ef67111f9ae4eefa278780655f0c1e3";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();
        </script>
    <!-- 谷歌统计  -->
    <!-- Google tag (gtag.js) -->
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="f10@t's blog" type="application/atom+xml">
</head>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ == undefined) {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js" />')
        }
    </script>
        <body class="post-body">
        <!-- header -->
        <header class="header header-mobile">
    <!-- top read progress line -->
    <div class="header-element">
        <div class="read-progress read-progress-feature"></div>
    </div>
    <!-- sidebar menu button -->
    <div class="header-element">
        <div class="header-sidebar-menu header-sidebar-menu-rounded">
            <i class="fas fa-bars"></i>
        </div>
    </div>
    <!-- header actions -->
    <div class="header-actions">
        <!-- theme mode switch button -->
        <span class="header-theme-btn header-element">
            <i class="fas fa-adjust"></i>
        </span>
        <!-- back to home page text -->
        <span class="home-link header-element">
            <a href="/">f10@t's blog</a>
        </span>
    </div>
    <!-- toggle banner -->
    <div class="banner">
        <div class="blog-title header-element">
            <a href="/">f10@t&#39;s blog</a>
        </div>
        <div class="post-title header-element">
            <a href="#" class="post-name">Kubernetes-集群环境搭建使用及问题记录（二）</a>
        </div>
    </div>
</header>

        <!-- fixed footer -->
        <footer class="footer-fixed">
    <!-- donate button -->
    <div class="donate-popup donate-popup--hidden">
    <div class="donate-popup__title">Buy Me A Coffee</div>
    <div class="donate-popup__content">
        <div class="donate-popup__content-description">如果这篇文章帮到了你，请赏一杯咖啡给我喝吧嘿嘿☕️</div>
        <img
            class="donate-popup__content-qrCode"
            title="Wechat"
            alt="Wechat"
            src="/assets/donate-wechat.jpg"
        ></img>
        <img
            class="donate-popup__content-qrCode"
            title="Alipay"
            alt="Alipay"
            src="/assets/donate-alipay.jpg"
        ></img>
    </div>
</div>

    <div
        title="Donate to the author"
        class="footer-fixed-btn footer-fixed-btn--hidden footer-fixed-btn--rounded donate-btn"
    >
        <i class="fas fa-donate"></i>
    </div>

    <!-- back to top button -->
    <div class="footer-fixed-btn footer-fixed-btn--hidden footer-fixed-btn--rounded back-top">
        <i class="fas fa-chevron-up"></i>
    </div>
</footer>

        <!-- wrapper -->
        <div class="wrapper">
            <div class="site-intro" style="    height:50vh;
">
    <!-- 主页  -->
    <!-- 404页  -->
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/B.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
                Kubernetes-集群环境搭建使用及问题记录（二）
            <!-- 404 -->
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            <!-- 404 -->
        </p>
        <!-- 文章页 meta -->
            <div class="post-intros">
                <!-- 文章页标签  -->
                    <div class="post-intro-tags" >
        <span class="post-category" data-categories="开发技术">
            <i class="fas fa-folder post-category-icon"></i>
            <span class="post-category-text">
                开发技术
            </span>
        </span>
        <a class="post-tag" href="javascript:void(0);" data-tags="Kubernete">Kubernete</a>
        <a class="post-tag" href="javascript:void(0);" data-tags="分布式技术">分布式技术</a>
</div>

                <!-- 文章字数统计 -->
                    <div class="post-intro-read">
                        <span>字数统计: <span class="post-count word-count">5.8k</span>阅读时长: <span class="post-count reading-time">23 min</span></span>
                    </div>
                <div class="post-intro-meta">
                    <!-- 撰写日期 -->
                    <span class="iconfont-archer post-intro-calander">&#xe676;</span>
                    <span class="post-intro-time">2021/08/09</span>
                    <!-- busuanzi -->
                        <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                            <span class="iconfont-archer post-intro-busuanzi">&#xe602;</span>
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    <!-- 文章分享 -->
                    <span class="share-wrapper">
                        <span class="iconfont-archer share-icon">&#xe71d;</span>
                        <span class="share-text">Share</span>
                        <ul class="share-list">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
    </div>
</div>

            <script>
  // get user agent
  function getBrowserVersions() {
    var u = window.navigator.userAgent
    return {
      userAgent: u,
      trident: u.indexOf('Trident') > -1, //IE内核
      presto: u.indexOf('Presto') > -1, //opera内核
      webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
      gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
      mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
      ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
      android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
      iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
      iPad: u.indexOf('iPad') > -1, //是否为iPad
      webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
      weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
      uc: u.indexOf('UCBrowser') > -1, //是否为android下的UC浏览器
    }
  }
  var browser = {
    versions: getBrowserVersions(),
  }
  console.log('userAgent: ' + browser.versions.userAgent)

  // callback
  function fontLoaded() {
    console.log('font loaded')
    if (document.getElementsByClassName('site-intro-meta')) {
      document
        .getElementsByClassName('intro-title')[0]
        .classList.add('intro-fade-in')
      document
        .getElementsByClassName('intro-subtitle')[0]
        .classList.add('intro-fade-in')
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in')
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb() {
    if (browser.versions.uc) {
      console.log('UCBrowser')
      fontLoaded()
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular'],
        },
        loading: function () {
          // 所有字体开始加载
          // console.log('font loading');
        },
        active: function () {
          // 所有字体已渲染
          fontLoaded()
        },
        inactive: function () {
          // 字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout')
          fontLoaded()
        },
        timeout: 5000, // Set the timeout to two seconds
      })
    }
  }

  function asyncErr() {
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0]
    o.src = u
    if (cb) {
      o.addEventListener(
        'load',
        function (e) {
          cb(null, e)
        },
        false
      )
    }
    if (err) {
      o.addEventListener(
        'error',
        function (e) {
          err(null, e)
        },
        false
      )
    }
    s.parentNode.insertBefore(o, s)
  }

  var asyncLoadWithFallBack = function (arr, success, reject) {
    var currReject = function () {
      reject()
      arr.shift()
      if (arr.length) async(arr[0], success, currReject)
    }

    async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack(
    [
      'https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js',
      'https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js',
      "/lib/webfontloader.min.js",
    ],
    asyncCb,
    asyncErr
  )
</script>

            <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" alt="loading">
            <div class="container container-unloaded">
                <main class="main post-page">
    <article class="article-entry">
        <blockquote>
<p>上一篇中我搭建了一个单master+三个从节点的Kubernetes集群，并直接使用nginx镜像进行了简单部署。这一篇来主要学习一下Kubernetes最主要的功能--容器编排。本篇将记录容器编排的重要概念、配置文件如何辨写开始，最后展示一个很简单的Hello-world。下一篇将深入实战，部署一个SpringCloud项目。</p>
<figure>
<img
src="/img/Kubernetes-集群环境搭建使用及问题记录（一）/components-of-kubernetes.png"
alt="image-20210810183438958" />
<figcaption aria-hidden="true">image-20210810183438958</figcaption>
</figure>
</blockquote>
<span id="more"></span>
<h2 id="为何以及如何进行容器编排">为何以及如何进行容器编排</h2>
<p>用过docker-compose的应该都知道，docker-compose通过已yml的格式来叙述，描述如何对不同镜像的容器进行管理，包括设置端口、标签等等，极大地简化了我们自定义Dockerfile再去创建、管理容器的过程。然而docker-compose的作用范围是有限的，它不能一次性在多个机器上部署容器，也不能进行根据实际情况负载均衡等等，所以Docker官方出了一个叫做Swarm的东西，虽然解决了上述问题但是由于提供的功能太少，很少被应用于生产中，所以才有了今天的Kubernetes。</p>
<p>类似地，Kubernetes也使用yml文件来进行容器编排工作，我们直接使用<code>kubectl</code>进行应用就可以了。其实前面我们部署网络插件<em>Flannel</em>的时候就已经用到这个东西了，那个<code>kube-flannel.yml</code>就是资源编排文件。</p>
<h2 id="怎么写资源编排文档">怎么写资源编排文档？</h2>
<h3 id="资源编排文件常用字段及其含义">资源编排文件常用字段及其含义</h3>
<p>下面我们先来直接看一个Demo：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span>   <span class="comment"># 以上为第一部分，为控制器部分</span></span><br><span class="line">  <span class="attr">template:</span>        <span class="comment"># 以下为第二部分，为被控制对象部分</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>
<p>首先这个yaml文档由两部分构成：<strong>控制器部分</strong>
和<strong>被控制对象部分</strong>。上述的关键字含义如下：</p>
<table>
<colgroup>
<col style="width: 17%" />
<col style="width: 82%" />
</colgroup>
<thead>
<tr class="header">
<th>名称</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>apiVersion</td>
<td>API版本</td>
</tr>
<tr class="even">
<td><strong>kind</strong></td>
<td>资源类型（比如常用的Deployment，使用kubectl
api-resources就可以查看）</td>
</tr>
<tr class="odd">
<td>metadata</td>
<td>资源元数据（一些比如名称、命名空间等属性）</td>
</tr>
<tr class="even">
<td>spec</td>
<td>资源规格</td>
</tr>
<tr class="odd">
<td>replicas</td>
<td>副本数量</td>
</tr>
<tr class="even">
<td>selector</td>
<td>标签选择器</td>
</tr>
<tr class="odd">
<td>template</td>
<td>Pod模板</td>
</tr>
<tr class="even">
<td>metadata</td>
<td>Pod元数据</td>
</tr>
<tr class="odd">
<td>template.spec</td>
<td>Pod规格</td>
</tr>
<tr class="even">
<td>containers</td>
<td>容器配置</td>
</tr>
</tbody>
</table>
<h2 id="如何开始写呢">如何开始写呢？</h2>
<h3 id="新建文档">新建文档</h3>
<p>从前一章节的关键字表可以看到，资源编排文档中有大量的关键字，记忆起来比较困难，所以我们有两种方式来编写：</p>
<ul>
<li>kubectl create来生成yaml文件并进行修改</li>
<li>若资源已经部署，则可以使用kubectl
get命令导出其yaml文件并对其进行修改</li>
</ul>
<p>第一种方式比如我们创建一个例子，先来看一下create命令的help：</p>
<figure>
<img
src="/img/Kubernetes-集群环境搭建使用及问题记录（二）/image-20210809175523694.png"
alt="image-20210809175523694" />
<figcaption aria-hidden="true">image-20210809175523694</figcaption>
</figure>
<p>我们创建一个测试：<code>kubectl create deployment web --image=nginx -o yaml --dry-run=client</code>，参数含义如下：</p>
<ul>
<li><code>deployment</code>代表开发环境，后面跟名称</li>
<li><code>--image</code>代表使用的镜像名称</li>
<li><code>-o yaml</code>代表输出yaml格式</li>
<li><code>--dry-run=client</code>代表不在集群中执行，只生成yaml文件，</li>
</ul>
<p>结果如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">strategy:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">web</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">resources:</span> &#123;&#125;</span><br><span class="line"><span class="attr">status:</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>第二种方式我们去找一个已经部署的pod，比如我已经部署了的nginx（这里没开那个虚拟机所以挂了）</p>
<p>：</p>
<figure>
<img
src="/img/Kubernetes-集群环境搭建使用及问题记录（二）/image-20210809180052697.png"
alt="image-20210809180052697" />
<figcaption aria-hidden="true">image-20210809180052697</figcaption>
</figure>
<p>我们直接导出：<code>kubectl get deployment nginx -o yaml</code>，结果如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">deployment.kubernetes.io/revision:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="string">&quot;2021-08-03T15:39:14Z&quot;</span></span><br><span class="line">  <span class="attr">generation:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">resourceVersion:</span> <span class="string">&quot;45961&quot;</span></span><br><span class="line">  <span class="attr">uid:</span> <span class="string">b0b01395-9e7f-4cd1-b0d7-0787780d2595</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">progressDeadlineSeconds:</span> <span class="number">600</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="string">...</span> <span class="string">...</span></span><br></pre></td></tr></table></figure>
<p>可以看到相对的就要复杂了很多。</p>
<h3 id="关键的一点-定义资源类型">关键的一点-定义资源类型</h3>
<p>上面表格中的kind我特意打了加粗，是因为这一个非常重要的概念，这个概念你搞不清楚，在部署应用的时候你会比较懵逼。我们先运行一下<code>kubectl api-resource</code>来看一下都有哪些类型：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">NAME                            SHORTNAMES  APIVERSION                       NAMESPACED  KIND</span><br><span class="line">bindings                                    v1                               true        Binding</span><br><span class="line">componentstatuses               cs          v1                               false       ComponentStatus</span><br><span class="line">configmaps                      cm          v1                               true        ConfigMap</span><br><span class="line">endpoints                       ep          v1                               true        Endpoints</span><br><span class="line">events                          ev          v1                               true        Event</span><br><span class="line">limitranges                     limits      v1                               true        LimitRange</span><br><span class="line">namespaces                      ns          v1                               false       Namespace</span><br><span class="line">nodes                           no          v1                               false       Node</span><br><span class="line">persistentvolumeclaims          pvc         v1                               true        PersistentVolumeClaim</span><br><span class="line">persistentvolumes               pv          v1                               false       PersistentVolume</span><br><span class="line">pods                            po          v1                               true        Pod</span><br><span class="line">podtemplates                                v1                               true        PodTemplate</span><br><span class="line">replicationcontrollers          rc          v1                               true        ReplicationController</span><br><span class="line">resourcequotas                  quota       v1                               true        ResourceQuota</span><br><span class="line">secrets                                     v1                               true        Secret</span><br><span class="line">serviceaccounts                 sa          v1                               true        ServiceAccount</span><br><span class="line">services                        svc         v1                               true        Service</span><br><span class="line">mutatingwebhookconfigurations               admissionregistration.k8s.io/v1  false       MutatingWebhookConfiguration</span><br><span class="line">validatingwebhookconfigurations             admissionregistration.k8s.io/v1  false       ValidatingWebhookConfiguration</span><br><span class="line">customresourcedefinitions       crd,crds    apiextensions.k8s.io/v1          false       CustomResourceDefinition</span><br><span class="line">apiservices                                 apiregistration.k8s.io/v1        false       APIService</span><br><span class="line">controllerrevisions                         apps/v1                          true        ControllerRevision</span><br><span class="line">daemonsets                      ds          apps/v1                          true        DaemonSet</span><br><span class="line">deployments                     deploy      apps/v1                          true        Deployment</span><br><span class="line">replicasets                     rs          apps/v1                          true        ReplicaSet</span><br><span class="line">statefulsets                    sts         apps/v1                          true        StatefulSet</span><br><span class="line">tokenreviews                                authentication.k8s.io/v1         false       TokenReview</span><br><span class="line">localsubjectaccessreviews                   authorization.k8s.io/v1          true        LocalSubjectAccessReview</span><br><span class="line">selfsubjectaccessreviews                    authorization.k8s.io/v1          false       SelfSubjectAccessReview</span><br><span class="line">selfsubjectrulesreviews                     authorization.k8s.io/v1          false       SelfSubjectRulesReview</span><br><span class="line">subjectaccessreviews                        authorization.k8s.io/v1          false       SubjectAccessReview</span><br><span class="line">horizontalpodautoscalers        hpa         autoscaling/v1                   true        HorizontalPodAutoscaler</span><br><span class="line">cronjobs                        cj          batch/v1                         true        CronJob</span><br><span class="line">jobs                                        batch/v1                         true        Job</span><br><span class="line">certificatesigningrequests      csr         certificates.k8s.io/v1           false       CertificateSigningRequest</span><br><span class="line">leases                                      coordination.k8s.io/v1           true        Lease</span><br><span class="line">endpointslices                              discovery.k8s.io/v1              true        EndpointSlice</span><br><span class="line">events                          ev          events.k8s.io/v1                 true        Event</span><br><span class="line">ingresses                       ing         extensions/v1beta1               true        Ingress</span><br><span class="line">flowschemas                                 flowcontrol.apiserver.k8s.io/v1befalse       FlowSchema</span><br><span class="line">prioritylevelconfigurations                 flowcontrol.apiserver.k8s.io/v1befalse       PriorityLevelConfiguration</span><br><span class="line">ingressclasses                              networking.k8s.io/v1             false       IngressClass</span><br><span class="line">ingresses                       ing         networking.k8s.io/v1             true        Ingress</span><br><span class="line">networkpolicies                 netpol      networking.k8s.io/v1             true        NetworkPolicy</span><br><span class="line">runtimeclasses                              node.k8s.io/v1                   false       RuntimeClass</span><br><span class="line">poddisruptionbudgets            pdb         policy/v1                        true        PodDisruptionBudget</span><br><span class="line">podsecuritypolicies             psp         policy/v1beta1                   false       PodSecurityPolicy</span><br><span class="line">clusterrolebindings                         rbac.authorization.k8s.io/v1     false       ClusterRoleBinding</span><br><span class="line">clusterroles                                rbac.authorization.k8s.io/v1     false       ClusterRole</span><br><span class="line">rolebindings                                rbac.authorization.k8s.io/v1     true        RoleBinding</span><br><span class="line">roles                                       rbac.authorization.k8s.io/v1     true        Role</span><br><span class="line">priorityclasses                 pc          scheduling.k8s.io/v1             false       PriorityClass</span><br><span class="line">csidrivers                                  storage.k8s.io/v1                false       CSIDriver</span><br><span class="line">csinodes                                    storage.k8s.io/v1                false       CSINode</span><br><span class="line">csistoragecapacities                        storage.k8s.io/v1beta1           true        CSIStorageCapacity</span><br><span class="line">storageclasses                  sc          storage.k8s.io/v1                false       StorageClass</span><br><span class="line">volumeattachments                           storage.k8s.io/v1                false       VolumeAttachment</span><br></pre></td></tr></table></figure>
<p>人都麻了，一堆类型，所以我们只看常用的东西，<strong>搞清楚这个问题：Kubernetes的有哪些类型的资源，如果你对哪一个不清楚想要了解的话可以使用<code>kubectl explain xxx</code>来查看。</strong></p>
<p>常用的几个比如：</p>
<ul>
<li>Deployment</li>
<li>service</li>
<li>pod</li>
<li>ReplicationController</li>
</ul>
<p>下面我将着重叙述上述的这四种类型。<strong>个人认为理解的必要性很大</strong></p>
<h4 id="kind-pod">kind: Pod</h4>
<p>我们看一下Pod，这是Kubernetes调度资源的最小单位，它是在机器上运行的一系列的容器的组合，由客户端创建并分发到集群中去创建、运行等等。一句话总结：</p>
<blockquote>
<p>Pod is a collection of containers that can run on a host. This
resource is created by clients and scheduled onto hosts.</p>
</blockquote>
<p>下面是定义Pod时的重要元素：</p>
<ul>
<li><p>apiVersion：声明Kubernetes的API版本，目前是v1</p></li>
<li><p>kind：声明API对象的类型，这里类型是Pod</p></li>
<li><p>metadata：设置Pod的元数据</p>
<ul>
<li>name：指定Pod的名称，Pod名称必须在Namespace内唯一</li>
</ul></li>
<li><p>spec：配置Pod的具体规格</p>
<ul>
<li>restartPolicy：设置Pod的重启策略</li>
<li>volumes：定义挂载在Pod中的目录，<strong>数组形式</strong>，每一项定义一个容器
<ul>
<li>name：挂载在Pod中的目录名称，比如data。<strong>注意pod中所有容器都可以访问到。</strong></li>
<li>hostPath：宿主机路径，比如/tmp</li>
</ul></li>
<li>containers：设置Pod中容器的规格，<strong>数组形式</strong>，每一项定义一个容器('-
'开头为一项)
<ul>
<li>name：指定容器的名称，在Pod的定义中唯一</li>
<li>image：设置容器镜像</li>
<li>command：设置容器的启动命令</li>
<li>volumeMounts: 配置挂载数据卷，数组形式，每一项定义一个容器
<ul>
<li>name：挂载名称，比如web_data</li>
<li>mountPath：/data，<strong>注意这里的路径是Pod中.spec.volumes中定义的volume</strong></li>
</ul></li>
<li>ports：设置容器端口，<strong>数组形式</strong>，每一项定义一个容器
<ul>
<li>name：设置端口名称，比如在Pod内唯一，当只配置一个端口的时候，为可选项，否则配置多个端口的时候为必选项</li>
<li>containerPort：<strong>必选项目</strong>，设置在容器内的端口，有效值范围为0-65536(不包括0和65536)</li>
<li>protocol：<strong>可选项</strong>，设置端口的网络层协议，TCP或UDP，默认TCP</li>
<li>hostIP：<strong>可选项</strong>，设置在宿主机上的IP。0.0.0.0代表任意可用的</li>
<li>hostPort：<strong>可选项</strong>，设置在宿主机的端口，有效值范围为0-65536(不包括0和65536)</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<h5 id="经典hello-world">经典Hello-World</h5>
<p>下一章会使用SpringCloud项目做一个深入的学习，下来我们先写一个pod资源类型的Hello
World来简单了解一下流程，在这个pod中包含了Pod基本信息、数据卷信息的使用展示。</p>
<p>我直接写yaml了，中间会插注释说明。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>       <span class="comment"># 声明Kubernetes的API版本</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span>            <span class="comment"># 声明资源类型为Pod</span></span><br><span class="line"><span class="attr">metadata:</span>            <span class="comment"># 开始设置Pod的元数据</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-demo</span>     <span class="comment"># 设置Pod的名称，该名称应在Namespace内是唯一的</span></span><br><span class="line"><span class="attr">spec:</span>                <span class="comment"># 设置Pod的具体规格</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Never</span>  <span class="comment"># 设置Pod的重启策略，这里无需重启，容器正常退出就结束</span></span><br><span class="line">  <span class="attr">volumes:</span>           <span class="comment"># 设置数据卷信息</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tmp-data</span></span><br><span class="line">    <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/tmp</span></span><br><span class="line">  <span class="attr">containers:</span>        <span class="comment"># 设置Pod的容器规格，呈数组格式(&#x27;- &#x27;开始)，每一项定义一个容器</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">write</span>      <span class="comment"># 指定容器的名称，在Pod中的定义唯一</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;ubuntu:18.04&quot;</span>  <span class="comment"># 设置容器的镜像</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tmp-data</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/buffer</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo \&quot;Hello World\&quot; &gt; /buffer/hello.txt&quot;</span>]  <span class="comment"># 设容器的启动命令，这里我们拷贝数据进行数据卷的验证</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">read</span>      <span class="comment"># 再创建一个容器来读取内容</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;ubuntu:18.04&quot;</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tmp-data</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/buffer</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;cat&quot;</span>, <span class="string">&quot;/buffer/hello.txt&quot;</span>]  <span class="comment"># 读取这个文件</span></span><br></pre></td></tr></table></figure>
<p>上面这个例子中我们定义了一个使用<code>Ubuntu:18.04</code>作为镜像的容器的Pod资源类型，其实上面这个定义的效果就相当于我们docker中<code>docker run --name hello-world ubuntu:18.04 /bin/echo Hello World</code>。</p>
<p>我们把这个资源创建到Kubernetes中，在pod起来后，使用log命令并指定容器来查看输出：</p>
<figure>
<img
src="/img/Kubernetes-集群环境搭建使用及问题记录（二）/image-20210812182431428.png"
alt="image-20210812182431428" />
<figcaption aria-hidden="true">image-20210812182431428</figcaption>
</figure>
<p>如果你发现pod报错或者一直维持在创建中的状态，那你可以使用命令<code>kubectl describe pod xxx</code>来查看，这个命令可以做到查询pod的状态以及生命周期事件。</p>
<h4 id="kind-republication-controller">kind: Republication
Controller</h4>
<blockquote>
<p><strong>2021/9/7 更新</strong></p>
<p>在Kubernetes v1.16之前，维护pod的只有Republication
Controller，但是在新版本中官方建议使用ReplicaSet来取代RC，二者本质相同，只不过RC只支持等式选择器，而ReplicaSet支持集合式选择器。</p>
<p>但是官方不建议用户直接使用ReplicaSet，而是使用Deployment，它可以看做是RC的升级版，支持滚动更新(ReplicaSet不支持)、版本记录、回滚、暂停更新等高级特性，所以你也可以大概了解下RC，把重点放在Deployment上。</p>
</blockquote>
<blockquote>
<p><strong>这一节的记录内容非常重要，可以帮助你理解Pod的生命周期、RC的作用、RC的功能。具体来说这一节我将主要叙述RC的如下功能：</strong></p>
<ul>
<li>定义方式？</li>
<li>如何关联RC和Pod？</li>
<li>如何弹性伸缩和自动伸缩？</li>
<li>如何实现应用手动升级？</li>
</ul>
</blockquote>
<p>Kubernetes中RC的主要要素包括以下内容：</p>
<ul>
<li>kind：声明API对象类型，这里就是Replication Controller</li>
<li>metadata：设置RC的元数据
<ul>
<li>name： 指定RC的名称，该名称必须在NameSpace中唯一。</li>
</ul></li>
<li>spec: 配置RC的具体规格
<ul>
<li>replicas：设置RC控制的Pod副本数目</li>
<li>selector：指定RC的Label Selector来匹配Pod的Label</li>
</ul></li>
<li>template：设置Pod模板，同Pod的定义一致</li>
</ul>
<p>Replication
Controller(RC)是一个很重要的概念，应用托管在k8s后，为了保证这个应用可以持续的运行，所以有RC，他可以确保任意时刻k8s中都存在指定数量的Pod副本数量(.spec.replicas)，并提供了弹性伸缩、滚动升级等特性。一个定义RC的配置文件如下所示：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicationController</span> </span><br><span class="line"><span class="attr">metadata:</span> </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-nginx</span> </span><br><span class="line"><span class="attr">spec:</span> </span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span> 	<span class="comment"># 设置Pod副本数目为2</span></span><br><span class="line">  <span class="attr">selector:</span> 	<span class="comment"># 用来匹配Pod的Label</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span> </span><br><span class="line">  <span class="attr">template:</span> 	<span class="comment"># Pod模板，相当于Pod定义</span></span><br><span class="line">    <span class="attr">metadata:</span> </span><br><span class="line">      <span class="attr">labels:</span> </span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span> 	<span class="comment"># 为Pod打Label</span></span><br><span class="line">    <span class="attr">spec:</span> </span><br><span class="line">      <span class="attr">containers:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span> </span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx</span> </span><br><span class="line">        <span class="attr">ports:</span> </span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span> </span><br></pre></td></tr></table></figure>
<p>同样，使用<code>kubectl create -f xxx.yaml</code>就可以生效了，你可以使用命令：</p>
<blockquote>
<p>kubectl get pod --selector app=nginx --label-columns app</p>
</blockquote>
<p>来查看这个RC创建的Pod。</p>
<p>因为RC中定义了副本数目，所以你删除已经创建的pod他就会新建一个pod来保证replicas的数目。只有你直接删除了rc资源<code>kubectl delete rc xxx</code>他才会删除对应的pod；而如果你想只删除rc而不删除它对应的pods的话，删除的时候需要带上参数<code>--cascade=false</code>。</p>
<p>当然，你也可以不通过上述写文件，然后create的方式来创建，好比nginx，你也可以直接<code>kubectl run my-nginx --image nginx --replicas 2 --labels app=nginx</code>。</p>
<h5
id="rc使用pod和直接定义pod有什么区别吗">RC使用Pod和直接定义Pod有什么区别吗？</h5>
<p>一般相对于直接定义一个Pod，更多的是定义一个RC，让RC来创建Pod，有点像工厂模式那味儿啊。上面那个RC的配置文件也可以看出，我们是通过<code>.spec.template</code>来设置Pod模板的，通过这种方式设置Pod有三个要注意的地方：</p>
<ul>
<li>不需要指定Pod名称，名称是自动生成且唯一的，你指定了也没用</li>
<li>Pod模板重启策略必须是Always，这是为了保证Pod的副本数目</li>
<li>Pod模板的Label不能为空，否则RC无法同Pod模板创建出来的Pod相关联</li>
</ul>
<h5
id="pod模板可以单独定义吗非得写rc里">Pod模板可以单独定义吗？非得写RC里？</h5>
<p>Pod模板是可以单独定义的，类型是<code>PodTemplate</code>，一个例子<code>podtemplate.yaml</code>如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">PodTemplate</span> </span><br><span class="line"><span class="attr">metadata:</span> </span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span> </span><br><span class="line"><span class="attr">template:</span> </span><br><span class="line">  <span class="attr">metadata:</span> </span><br><span class="line">    <span class="attr">labels:</span> </span><br><span class="line">      <span class="attr">name:</span> <span class="string">nginx</span> </span><br><span class="line">  <span class="attr">spec:</span> </span><br><span class="line">    <span class="attr">containers:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx</span> </span><br><span class="line">      <span class="attr">name:</span> <span class="string">nginx</span> </span><br><span class="line">      <span class="attr">ports:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span> </span><br></pre></td></tr></table></figure>
<p>然后我们部署到k8s中:</p>
<blockquote>
<p>kubectl create -f podtemplate.yaml</p>
</blockquote>
<p>然后你可以查看当前有那些模板：</p>
<blockquote>
<p>kubectl get podTemplate nginx</p>
</blockquote>
<p>然后你就可以在RC里面直接引用了：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicationController</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">templateRef:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span>  <span class="comment"># 使用templateRef来进行引用</span></span><br></pre></td></tr></table></figure>
<h5 id="rc和pod之间的关联---label">RC和Pod之间的关联 - Label</h5>
<p>这俩的关联主要就是通过Label标签来进行的，再看一眼上面那个例子：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicationController</span> </span><br><span class="line"><span class="attr">metadata:</span> </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-nginx</span> </span><br><span class="line"><span class="attr">spec:</span> </span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span> 	<span class="comment"># 用来匹配Pod的Label</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">myApp</span> </span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span> </span><br><span class="line">      <span class="attr">labels:</span> </span><br><span class="line">        <span class="attr">app:</span> <span class="string">myApp</span> 	<span class="comment"># 为Pod打Label</span></span><br><span class="line">        <span class="attr">version:</span> <span class="string">v1</span> <span class="comment"># 你也可以添加其他标签来准确标识</span></span><br><span class="line">        <span class="attr">release:</span> <span class="string">stable</span></span><br><span class="line">    <span class="attr">spec:</span> </span><br><span class="line">      <span class="attr">containers:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span> </span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx</span> </span><br><span class="line">        <span class="attr">ports:</span> </span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span> </span><br></pre></td></tr></table></figure>
<p>我们就是通过<code>.spec.selector</code>来匹配<code>.spec.template.metadata.labels</code>的。有一种比较好的、方便开发的方法：<strong>修改当前Pod的标签</strong></p>
<p>好比说上面资源部署后，创建了<code>myApp-abcde</code>这个pod，我们进行修改</p>
<blockquote>
<p>kubectl label pod myApp-abcde app=debug --overwrite</p>
</blockquote>
<p>这样RC就会创建一个新的Pod进行关联，相当于我们有了一个备份的应用可以进行调试了，调试结束后就可以<code>kubectl delete pod xx</code>删除这个pod了。</p>
<h5 id="rc如何实现手动弹性伸缩">RC如何实现手动弹性伸缩？</h5>
<p>即横向扩展，在Kubernetes中就是根据负载的高低动态来调整Pod的副本数目，主要是通过<code>kubectl scale</code>命令来完成的。</p>
<p>好比说你定义了一个RC，他的<code>.spec.replicas</code>值为1，即只有一个副本，那如果后面你想要扩容，你就可以直接手动进行扩容：</p>
<blockquote>
<p>kubectl scale replicationcontroller xxx --replicas=n</p>
</blockquote>
<p>上面这条命令扩容至<strong>n</strong>个这个RC管理的Pod。特别地，如果<strong>n=0</strong>，那意思就是删除所有这个RC管理的Pod。</p>
<h5 id="rc如何实现自动伸缩">RC如何实现自动伸缩？</h5>
<p>手动固然方便，但是人不可能时时刻刻观察这业务的负载，我们就需要更细颗粒度的伸缩控制，那就是自动伸缩了。Kubernetes中通过<code>Horizontal Pod AutoScaler</code>来实现Pod的自动伸缩，该资源主要通过监视和RC关联的Pod的整体资源使用情况，<strong>当匹配了设定的策略的时候，它就会通过RC来调整Pod的副本数目。</strong>示意图如下所示：</p>
<figure>
<img
src="/img/Kubernetes-集群环境搭建使用及问题记录（二）/image-20210813150034315.png"
alt="image-20210813150034315" />
<figcaption aria-hidden="true">image-20210813150034315</figcaption>
</figure>
<p>在k8s
v1.8以下主要使用Heapster来作为性能指标的采集来源，v1.11废弃，后续使用Metrics
Server进行指标的采集。具体的工作原理官方解释如下（附上我的渣渣翻译）：</p>
<blockquote>
<p>The Horizontal Pod Autoscaler is implemented as a control loop, with
a period controlled by the controller manager's
<code>--horizontal-pod-autoscaler-sync-period</code> flag (with a
default value of 15 seconds).</p>
<blockquote>
<p>Pod横向自动扩展是以控制循环(control
loop)来单位来进行的，这个循环的时间是由<code>--horizontal-pod-autoscaler-sync-period</code>参数控制的，默认为15s</p>
</blockquote>
<p>During each period, the controller manager queries the resource
utilization against the metrics specified in each
HorizontalPodAutoscaler definition. The controller manager obtains the
metrics from either the resource metrics API (for per-pod resource
metrics), or the custom metrics API (for all other metrics).</p>
<blockquote>
<p>在这每一个作用周期内，控制器(controller
manager)将按照每一个HorizontalPodAutoscaler的配置文件(就是yaml，Kind是horizontalpodautoscaler)定义的指标(比如CPU、内存等)来获取资源的利用率。这些指标的来源包括资源指标API(resouce
metrics API)和自定义的指标API。</p>
</blockquote>
<p>... ...</p>
<p>The autoscaler accesses corresponding scalable controllers (such as
replication controllers, deployments, and replica sets) by using the
scale sub-resource.</p>
<blockquote>
<p>自动扩展功能通过Scale（Scale是一个用于设置副本数量和查看健康情况的接口）来访问相关的可扩展控制器(比如replication
controller、deployments、replica sets)</p>
</blockquote>
</blockquote>
<p>首先我们创建一个RC，<strong>这里说明一下，我写的配置文件没有问题，但是不知道为什么实际实验的时候我出现了成功创建了Pod，但是一直处于ContainerCreating的状态，且describe无报错，docker那边也显示容器正在运行。有相同情况的大佬希望评论一下。</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicationController</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line">     <span class="attr">spec:</span></span><br><span class="line">       <span class="attr">containers:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">         <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">         <span class="attr">ports:</span></span><br><span class="line">         <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">           <span class="attr">protocol:</span> <span class="string">TCP</span></span><br></pre></td></tr></table></figure>
<p>然后我们使用子命令<code>autoscale</code>来为RC创建HPA：</p>
<blockquote>
<p>kubectl autoscale rc my-nginx --min=1 --max=5 --cpu-percent=50</p>
</blockquote>
<p>上面的命令含义为</p>
<ul>
<li>为名为my-nginx的rc创建HPA</li>
<li>该HPA策略为若CPU使用率大于50%就进行调整</li>
<li>该HPA的调整范围最小为1个，最多为5个副本</li>
</ul>
<p>创建好的HPA可以使用命令<code>kubectl get hpa</code>来查看。</p>
<h5 id="rc怎么实现应用的滚动升级">RC怎么实现应用的滚动升级？</h5>
<p>好比说上面那个配置文件叫<code>my-nginx-v1</code>，假如此刻有5个副本且我们打算把应用升级为<code>my-nginx-v2</code>，如何进行一次性的滚动升级呢？很简单：</p>
<blockquote>
<p>kubectl rolling-update my-nginx-v1 -f my-nginx-v2.yaml
--update-period=10s</p>
</blockquote>
<p>上面这条命令做了什么呢？</p>
<ul>
<li>首先根据定义的文件创建V2版本的RC</li>
<li>每隔10s(<code>--update-period</code>)，逐步增加V2版本的RC副本数并逐渐减少V1版本的副本数</li>
<li>全部替换完后自动删除V1版本的RC，并保留V2版本的RC</li>
</ul>
<p>当然这个过程需要一点点时间，如果你在这个期间发现搞错了也是可以回滚的：</p>
<blockquote>
<p>kubectl rolling-update my-nginx-v1 -f my-nginx-v2.yaml
--update-period=10s <strong>--rollback</strong></p>
</blockquote>
<h4 id="kind-deployment">Kind: Deployment</h4>
<p>在了解了上面的RC后，在看Deployment就知道是干什么的了。Deployment是Kubernetes提供的一中更加<strong>简单地</strong>更新RC和Pod的机制。</p>
<p>官方对Deploment的解释如下（附渣渣理解）：</p>
<blockquote>
<p>A <em>Deployment</em> provides declarative updates for Pods and
ReplicaSets.</p>
<p>You describe a <em>desired state</em> in a Deployment, and the
Deployment Controller changes the actual state to the desired state at a
controlled rate. You can define Deployments to create new ReplicaSets,
or to remove existing Deployments and adopt all their resources with new
Deployments.</p>
<blockquote>
<p>一个Deployment提供了一个方法--可以用来为pods和ReplicaSets进行更新升级</p>
<p>你只需要在<em>Deployment</em>中声明你想要的状态，然后就交给Deployment就行了，它会自动以受控的速率将现有的状态转变为期待的状态。你可以声明<em>Deployment</em>来创建新的ReplicaSets，或者删除现有的<em>Deployment</em>并通过新的<em>Deployment</em>收取其资源。</p>
</blockquote>
</blockquote>
<p>官方说明典型的使用Deployment场景如下：</p>
<ul>
<li>创建Deployment来上线ReplicaSets(which官方不建议用户手动创建or管理)</li>
<li>通过更新Deployment中的PodTemplateSpec字段来声明Pod的<strong>新状态</strong></li>
<li>可以使用Deployment进行回滚</li>
<li>可以扩大Deployment来承担更多负载</li>
<li>可以使用Deployment来判断上线过程是否出现停滞</li>
<li>可以使用Deployment来清理较旧的ReplicaSet</li>
</ul>
<h5 id="从一个deployment-demo开始">从一个Deployment Demo开始</h5>
<p>下面我们创建一个nginx的deployment：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-deployment-demo</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>
<p>然后直接部署到集群中：</p>
<blockquote>
<p>kubectl apply -f nginx-deployment-demo.yaml</p>
</blockquote>
<p>你也可以使用命令来完成：</p>
<blockquote>
<p>kubectl create deploy nginx-deployment --image=nginx --replicas=3</p>
</blockquote>
<p>创建成功后，我们可以查看deployment资源的状态以及创建的pod信息： <img
src="/img/Kubernetes-集群环境搭建使用及问题记录（二）/image-20210907202007096.png"
alt="image-20210907202007096" /></p>
<p>最终状态如下： <img
src="/img/Kubernetes-集群环境搭建使用及问题记录（二）/image-20210907202059726.png"
alt="image-20210907202059726" /></p>
<h5 id="deployment的扩容和缩容">Deployment的扩容和缩容</h5>
<p>虽然可以通过修改yaml文件并重新应用，但是相较麻烦，所以这里只记录使用命令如何进行扩容和缩容。</p>
<p>命令非常简单：</p>
<ul>
<li>扩容：<code>kubectl scale deploy nginx-deployment  --replicas=5</code>
-&gt; 将当前副本数扩展到5个</li>
<li>缩容：<code>kubectl scale deploy nginx-deployment --replicas=2</code>
-&gt;
将当前副本数缩小到2个。(注意缩小到0只是副本为0个而不是删除了deployment)</li>
</ul>
<h4 id="kind-service">kind: Service</h4>
<p>上面RC也说到了，Pod副本是由RC来控制的，是变化的资源，且在滚动更新、伸缩的时候也会带来一些问题，因为访问者需要能够发现这个副本且能感知到其发生的变化。</p>
<p>Services即服务，它用于是K8s中一个抽象的概念，具体来说，它定义了一个Pod的逻辑集合以及访问他们的策略，和RC类似，Service和Pod之间的关联也是通过Label来完成的，<strong>Service的目标是提供一种桥梁，来为访问者提供一个固定的访问地址，用来在访问时重定向到相应的后端。--
即代理的角色。</strong>Service的定义中重要元素和上面都类似，这里不赘述。</p>
<p>下面我们首先创建一个Deployment，镜像为nginx，包含两个副本： <img
src="/img/Kubernetes-集群环境搭建使用及问题记录（二）/image-20210907205706951-16319558682421.png"
alt="image-20210907205706951" /></p>
<p>这个时候你只能在node01上访问他自己的(10.10.12.32)上的nginx服务(80端口)，但是你不能从master亦或是node02上访问到，所以我们需要service来代理这些pod：</p>
<blockquote>
<p>kubectl create service clusterip nginx-deployment --tcp=8080:80</p>
</blockquote>
<p>这里注意，我们的deployment名称为<code>nginx-deployment</code>，所以我们的clusterip后面跟的名称要一致，然后我们来看一下详情：</p>
<figure>
<img
src="/img/Kubernetes-集群环境搭建使用及问题记录（二）/image-20210907210107159.png"
alt="image-20210907210107159" />
<figcaption aria-hidden="true">image-20210907210107159</figcaption>
</figure>
<p>可以看到服务的地址是<code>10.10.11.51</code>，代理的pod地址就是上面那两个，这时我们直接访问这个服务地址的8080即可访问到pod的80端口：</p>
<figure>
<img
src="/img/Kubernetes-集群环境搭建使用及问题记录（二）/image-20210907210433488.png"
alt="image-20210907210433488" />
<figcaption aria-hidden="true">image-20210907210433488</figcaption>
</figure>
<h2 id="结语">结语</h2>
<p><strong>K8s包含的内容还是不少的，关于K8s
Service的服务发现我会单独整理一篇。下一篇可能会就部署一个SpringCloud应用来讨论细节，学习如何将分布式应用部署到k8s中去。</strong></p>
<h2 id="出现的问题以及解决办法">出现的问题以及解决办法</h2>
<h3
id="response-from-daemon-cgroup-parent-for-systemd-cgroup-should-be-a-valid-slice-named-as-xxx.slice">response
from daemon: cgroup-parent for systemd cgroup should be a valid slice
named as "xxx.slice"</h3>
<p>这是因为你的docker和kubelet配置的cgroup政策不同，虽然我的kubernetes(v.1.21.3)最开始自己定义的是这样的：</p>
<figure>
<img
src="/img/Kubernetes-集群环境搭建使用及问题记录（二）/image-20210812140223916.png"
alt="image-20210812140223916" />
<figcaption aria-hidden="true">image-20210812140223916</figcaption>
</figure>
<p>但是Kubernetes官方建议docker使用systemd的方式，所以这里我们需要把docker和kubernetes的cgroupDriver都改为systemd方式：</p>
<ul>
<li><p>/var/lib/kubelet/config.yaml <img
src="/img/Kubernetes-集群环境搭建使用及问题记录（二）/image-20210812140307970.png"
alt="image-20210812140307970" /></p></li>
<li><p>/etc/docker/daemon.json <img
src="/img/Kubernetes-集群环境搭建使用及问题记录（二）/image-20210812140420930.png"
alt="image-20210812140420930" /></p></li>
</ul>
<blockquote>
<p>最后记得执行systemctl daemon-reload &amp;&amp; systemctl restart
docker &amp;&amp; systemctl restart kubelet来生效、重启</p>
</blockquote>
<p>这样就没有问题了。</p>
<h3
id="log命令出现error-a-container-name-must-be-specified-for-pod-pod-demo-choose-one-of-xxx-xxxx-...">log命令出现error:
a container name must be specified for pod pod-demo, choose one of: [xxx
xxxx ...]</h3>
<p>这是因为你的pod里配置了多个container，所以在使用log命令的时候需要指定要查看的容器具体是哪一个，比如你要查看A容器的日志，那就是<code>kubectl logs [pod name] -c [container name]</code>。或者使用--all-containers参数查看全部容器。</p>
<h2 id="参考学习">参考学习</h2>
<p>《Kubernetes实战》 - 吴龙辉 著</p>
<p>《Kubernetes权威指南：从Docker到Kubernetes实践全接触（第二版）》-
龚正等 著</p>
<p><a
target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/115903242">k8s中的所有api-resources类型简介
- 知乎</a></p>

    </article>
    <!-- license -->
        <div class="license-wrapper">
            <p>原文作者：<a href="https://lzwgiter.github.io">f10@t</a>
            <p>原文链接：<a href="https://lzwgiter.github.io/posts/a08eb123.html">https://lzwgiter.github.io/posts/a08eb123.html</a>
            <p>发表日期：<a href="https://lzwgiter.github.io/posts/a08eb123.html">August 9th 2021, 10:29:31 am</a>
            <p>更新日期：<a href="https://lzwgiter.github.io/posts/a08eb123.html">October 29th 2021, 3:55:50 pm</a>
            <p>版权声明：本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    <!-- paginator -->
    <ul class="post-paginator">
        <li class="next">
                <div class="nextSlogan">Next Post</div>
                <a href="/posts/ed901271.html" title="Kubernetes-集群环境搭建使用及问题记录（三）">
                    <div class="nextTitle">Kubernetes-集群环境搭建使用及问题记录（三）</div>
                </a>
        </li>
        <li class="previous">
                <div class="prevSlogan">Previous Post</div>
                <a href="/posts/eed4a979.html" title="Kubernetes 集群环境搭建使用及问题记录（一）">
                    <div class="prevTitle">Kubernetes 集群环境搭建使用及问题记录（一）</div>
                </a>
        </li>
    </ul>
    <!-- comment -->
        <div class="post-comment">
            <!-- 来必力 City 版安装代码 -->

            
            
            
            <!-- utteranc评论 -->

            <!-- partial('_partial/comment/changyan') -->
            <!--PC版-->

            
                <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <div id="comment"></div>
    <script>
        new Valine({
            el: '#comment',
            notify:false,
            verify:false,
            appId: "KADRlHg5xXyhKL0d6USDWfIB-gzGzoHsz",
            appKey: "Ppj8kIdro2yDqXOvqWkTRxuW",
            placeholder: "递咖啡就坐(　o=^•ェ•)o　┏━┓（填写邮箱地址可以收到邮件回复捏）",
            path:window.location.pathname,
            avatar:'mm'
        });
    </script>

            
        </div>
    <!-- timeliness note -->
    <!-- idea from: https://hexo.fluid-dev.com/posts/hexo-injector/#%E6%96%87%E7%AB%A0%E6%97%B6%E6%95%88%E6%80%A7%E6%8F%90%E7%A4%BA -->
    <!-- Mathjax -->
</main>

                <!-- profile -->
            </div>
            <footer class="footer footer-unloaded">
    <!-- social  -->
        <div class="social">
                            <a href="//github.com/lzwgiter" class="iconfont-archer github" target="_blank" title="github"></a>

        </div>
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- website approve for Chinese user -->
    <!-- 不蒜子  -->
        <div class="busuanzi-container">
                <span id="busuanzi_container_site_uv">做客的小伙伴数: <span id="busuanzi_value_site_uv"></span></span>
        </div>
</footer>

        </div>
        <!-- toc -->
            <div class="toc-wrapper toc-wrapper-loding" style=    top:50vh;
>
                <div class="toc-catalog">
                    <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
                </div>
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BD%95%E4%BB%A5%E5%8F%8A%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92"><span class="toc-number">1.</span> <span class="toc-text">为何以及如何进行容器编排</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E5%86%99%E8%B5%84%E6%BA%90%E7%BC%96%E6%8E%92%E6%96%87%E6%A1%A3"><span class="toc-number">2.</span> <span class="toc-text">怎么写资源编排文档？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E7%BC%96%E6%8E%92%E6%96%87%E4%BB%B6%E5%B8%B8%E7%94%A8%E5%AD%97%E6%AE%B5%E5%8F%8A%E5%85%B6%E5%90%AB%E4%B9%89"><span class="toc-number">2.1.</span> <span class="toc-text">资源编排文件常用字段及其含义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%BC%80%E5%A7%8B%E5%86%99%E5%91%A2"><span class="toc-number">3.</span> <span class="toc-text">如何开始写呢？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E6%96%87%E6%A1%A3"><span class="toc-number">3.1.</span> <span class="toc-text">新建文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E7%9A%84%E4%B8%80%E7%82%B9-%E5%AE%9A%E4%B9%89%E8%B5%84%E6%BA%90%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.2.</span> <span class="toc-text">关键的一点-定义资源类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#kind-pod"><span class="toc-number">3.2.1.</span> <span class="toc-text">kind: Pod</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%8F%E5%85%B8hello-world"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">经典Hello-World</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kind-republication-controller"><span class="toc-number">3.2.2.</span> <span class="toc-text">kind: Republication
Controller</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#rc%E4%BD%BF%E7%94%A8pod%E5%92%8C%E7%9B%B4%E6%8E%A5%E5%AE%9A%E4%B9%89pod%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%E5%90%97"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">RC使用Pod和直接定义Pod有什么区别吗？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pod%E6%A8%A1%E6%9D%BF%E5%8F%AF%E4%BB%A5%E5%8D%95%E7%8B%AC%E5%AE%9A%E4%B9%89%E5%90%97%E9%9D%9E%E5%BE%97%E5%86%99rc%E9%87%8C"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">Pod模板可以单独定义吗？非得写RC里？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#rc%E5%92%8Cpod%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E8%81%94---label"><span class="toc-number">3.2.2.3.</span> <span class="toc-text">RC和Pod之间的关联 - Label</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#rc%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%89%8B%E5%8A%A8%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9"><span class="toc-number">3.2.2.4.</span> <span class="toc-text">RC如何实现手动弹性伸缩？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#rc%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E4%BC%B8%E7%BC%A9"><span class="toc-number">3.2.2.5.</span> <span class="toc-text">RC如何实现自动伸缩？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#rc%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E5%BA%94%E7%94%A8%E7%9A%84%E6%BB%9A%E5%8A%A8%E5%8D%87%E7%BA%A7"><span class="toc-number">3.2.2.6.</span> <span class="toc-text">RC怎么实现应用的滚动升级？</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kind-deployment"><span class="toc-number">3.2.3.</span> <span class="toc-text">Kind: Deployment</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%8E%E4%B8%80%E4%B8%AAdeployment-demo%E5%BC%80%E5%A7%8B"><span class="toc-number">3.2.3.1.</span> <span class="toc-text">从一个Deployment Demo开始</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#deployment%E7%9A%84%E6%89%A9%E5%AE%B9%E5%92%8C%E7%BC%A9%E5%AE%B9"><span class="toc-number">3.2.3.2.</span> <span class="toc-text">Deployment的扩容和缩容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kind-service"><span class="toc-number">3.2.4.</span> <span class="toc-text">kind: Service</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-number">4.</span> <span class="toc-text">结语</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98%E4%BB%A5%E5%8F%8A%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"><span class="toc-number">5.</span> <span class="toc-text">出现的问题以及解决办法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#response-from-daemon-cgroup-parent-for-systemd-cgroup-should-be-a-valid-slice-named-as-xxx.slice"><span class="toc-number">5.1.</span> <span class="toc-text">response
from daemon: cgroup-parent for systemd cgroup should be a valid slice
named as &quot;xxx.slice&quot;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#log%E5%91%BD%E4%BB%A4%E5%87%BA%E7%8E%B0error-a-container-name-must-be-specified-for-pod-pod-demo-choose-one-of-xxx-xxxx-..."><span class="toc-number">5.2.</span> <span class="toc-text">log命令出现error:
a container name must be specified for pod pod-demo, choose one of: [xxx
xxxx ...]</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E5%AD%A6%E4%B9%A0"><span class="toc-number">6.</span> <span class="toc-text">参考学习</span></a></li></ol>
            </div>
        <!-- sidebar -->
        <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
        <div class="sidebar-panel-archives">
    <!-- 在 ejs 中将 archive 按照时间排序 -->
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    <div class="total-and-search">
        <div class="total-archive">
        Total : 99
        </div>
        <!-- search  -->
            <div class="site-search site-search-loading popup-trigger">
                <span class="iconfont-archer search-icon">&#xe627;</span>
            </div>
    </div>
    <div class="post-archive">
            <div class="archive-year"> 2024 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">08/05</span>
            <a class="archive-post-title" href="/posts/54e979b4.html">RabbitMQ学习</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/23</span>
            <a class="archive-post-title" href="/posts/963fb8d3.html">领域驱动设计学习（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/06</span>
            <a class="archive-post-title" href="/posts/21f893eb.html">学鲁菜之酱焖鲈鱼</a>
        </li>
                </ul>
            <div class="archive-year"> 2023 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">10/22</span>
            <a class="archive-post-title" href="/posts/33ea2108.html">Spring AOP再探</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/09</span>
            <a class="archive-post-title" href="/posts/c41813ec.html">重新审视微服务</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/04</span>
            <a class="archive-post-title" href="/posts/85bf5302.html">K8s攻防之OWASP-K8S-TOP10（下）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/16</span>
            <a class="archive-post-title" href="/posts/8aa36aba.html">K8s攻防之OWASP-K8S-TOP10（上）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/08</span>
            <a class="archive-post-title" href="/posts/c16d1cd9.html">Java内存马原理（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/08</span>
            <a class="archive-post-title" href="/posts/e2947908.html">Java Instrument机制及管窥IAST</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/03</span>
            <a class="archive-post-title" href="/posts/479daa6d.html">gRPC简介与使用</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/30</span>
            <a class="archive-post-title" href="/posts/b74b8800.html">fastjson反序列化漏洞学习（二）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/07</span>
            <a class="archive-post-title" href="/posts/73d00ee7.html">Netty框架学习</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/04</span>
            <a class="archive-post-title" href="/posts/d6b305b7.html">Java网络编程模型复习</a>
        </li>
                </ul>
            <div class="archive-year"> 2022 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">04/26</span>
            <a class="archive-post-title" href="/posts/203767b8.html">python-Numpy库使用</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/20</span>
            <a class="archive-post-title" href="/posts/f06096b.html">MATLAB - Wireless Communication Onramp</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/19</span>
            <a class="archive-post-title" href="/posts/3041f265.html">Matlab编程基础</a>
        </li>
                </ul>
            <div class="archive-year"> 2021 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">10/04</span>
            <a class="archive-post-title" href="/posts/169c63d0.html">Bloom Filter概念原理</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/25</span>
            <a class="archive-post-title" href="/posts/85e98ef0.html">zk-SNARKs简洁的非交互式零知识证明学习(一)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/22</span>
            <a class="archive-post-title" href="/posts/a8e0eb2d.html">Quarkus学习（一）概述以及编写REST服务</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/19</span>
            <a class="archive-post-title" href="/posts/e88577c0.html">Cloud Programming Simplified:A Berkeley View on Serverless Computing</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/18</span>
            <a class="archive-post-title" href="/posts/99665dc1.html">闲聊一下Java中的DI和CDI</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/12</span>
            <a class="archive-post-title" href="/posts/ed901271.html">Kubernetes-集群环境搭建使用及问题记录（三）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/09</span>
            <a class="archive-post-title" href="/posts/a08eb123.html">Kubernetes-集群环境搭建使用及问题记录（二）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/03</span>
            <a class="archive-post-title" href="/posts/eed4a979.html">Kubernetes 集群环境搭建使用及问题记录（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/24</span>
            <a class="archive-post-title" href="/posts/2f0b60dd.html">闲聊一下Go语言的函数方法和多态机制特点</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/14</span>
            <a class="archive-post-title" href="/posts/5893facf.html">express学习（一）-基于NodeJS的Web框架</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/10</span>
            <a class="archive-post-title" href="/posts/8a9b0b34.html">Beego学习-ORM</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/06</span>
            <a class="archive-post-title" href="/posts/84db08d3.html">Beego学习-路由设置</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/06</span>
            <a class="archive-post-title" href="/posts/a9031312.html">docker-compose及dockerfile总结</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/09</span>
            <a class="archive-post-title" href="/posts/77d22b2a.html">Spring安全技术-Spring Security使用及总结（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/28</span>
            <a class="archive-post-title" href="/posts/5e9eec21.html">DevOps技术-简单了解与入门</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/23</span>
            <a class="archive-post-title" href="/posts/27875254.html">Spring持久层技术-Sping Data JPA使用及总结（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/14</span>
            <a class="archive-post-title" href="/posts/bec529bf.html">以太坊智能合约开发环境搭建及智能合约的编写、部署、测试</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/11</span>
            <a class="archive-post-title" href="/posts/2ff8a9fd.html">以太坊基本概念与实验环境搭建</a>
        </li>
                </ul>
            <div class="archive-year"> 2020 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">06/17</span>
            <a class="archive-post-title" href="/posts/bcd864e2.html">DC-1靶机渗透</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/31</span>
            <a class="archive-post-title" href="/posts/c99165fd.html">fastjson反序列化漏洞学习（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/09</span>
            <a class="archive-post-title" href="/posts/a9e6a25b.html">Spring基础学习 - AOP机制</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/06</span>
            <a class="archive-post-title" href="/posts/b92dbb83.html">JavaEE基础 - Servlet</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/06</span>
            <a class="archive-post-title" href="/posts/44088610.html">Spring基础学习 - IOC机制</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/01</span>
            <a class="archive-post-title" href="/posts/662e1cfe.html">微服务入门-5W和微服务思想</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/22</span>
            <a class="archive-post-title" href="/posts/c75c5fc7.html">Java 反序列化漏洞与JNDI注入(下)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/14</span>
            <a class="archive-post-title" href="/posts/5dcfa8b5.html">Kerberos认证过程原理及攻击手段</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/26</span>
            <a class="archive-post-title" href="/posts/1ccc94ff.html">内存布局与栈溢出&堆溢出原理</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/21</span>
            <a class="archive-post-title" href="/posts/bc7cb7a1.html">入坑Pwn之刷题补坑</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/29</span>
            <a class="archive-post-title" href="/posts/760e25d9.html">内存取证原理学习及Volatility - 篇二</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/22</span>
            <a class="archive-post-title" href="/posts/b0024cb7.html">Struts框架管窥以及几个漏洞的分析</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/09</span>
            <a class="archive-post-title" href="/posts/8ce0a80d.html">Redis未授权访问漏洞及修补方法</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/08</span>
            <a class="archive-post-title" href="/posts/13fe3d9f.html">本地提权与漏洞提权</a>
        </li>
                </ul>
            <div class="archive-year"> 2019 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">12/21</span>
            <a class="archive-post-title" href="/posts/f8b67901.html">逆向工程课程小结</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/08</span>
            <a class="archive-post-title" href="/posts/4d8e0b70.html">内存取证原理学习及Volatility - 篇一</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/20</span>
            <a class="archive-post-title" href="/posts/82490df7.html">并发模型之单线程多路I/O复用---select</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/29</span>
            <a class="archive-post-title" href="/posts/a715340f.html">入坑Pwn之基本知识</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/10</span>
            <a class="archive-post-title" href="/posts/47dcecb9.html">Apache-Commons-Collections反序列化漏洞</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/03</span>
            <a class="archive-post-title" href="/posts/de476e86.html">Java 反序列化漏洞与JNDI注入(上)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/20</span>
            <a class="archive-post-title" href="/posts/7a9a17f3.html">记录一次对win2k3 Enterprise Edition的永恒之蓝利用</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/11</span>
            <a class="archive-post-title" href="/posts/6f24bb1d.html">kali-渗透测试-信息收集3</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/10</span>
            <a class="archive-post-title" href="/posts/18238b8b.html">kali-渗透测试-信息收集2</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">03/18</span>
            <a class="archive-post-title" href="/posts/812ada31.html">kali-渗透测试-信息收集1</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/11</span>
            <a class="archive-post-title" href="/posts/fffcd997.html">Metasploit渗透测试魔鬼训练营-客户端渗透攻击</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/10</span>
            <a class="archive-post-title" href="/posts/30b79e7d.html">Metasploit渗透测试魔鬼训练营-Windows服务漏洞MS08-067实战与分析总结</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/07</span>
            <a class="archive-post-title" href="/posts/79017d0.html">Metasploit渗透测试魔鬼训练营-web应用渗透</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/06</span>
            <a class="archive-post-title" href="/posts/6c9a4aca.html">Metasploit渗透测试魔鬼训练营-服务扫描与查点</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/04</span>
            <a class="archive-post-title" href="/posts/ed61533c.html">Metasploit渗透测试魔鬼训练营-信息收集</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/22</span>
            <a class="archive-post-title" href="/posts/ba8e1564.html">Metasploit渗透测试魔鬼训练营 第一天</a>
        </li>
                </ul>
            <div class="archive-year"> 2018 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">12/28</span>
            <a class="archive-post-title" href="/posts/dd591816.html">小明的博客--Typecho 反序列化漏洞</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/10</span>
            <a class="archive-post-title" href="/posts/41159e88.html">Bugku的一道注入---多次</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/06</span>
            <a class="archive-post-title" href="/posts/26bacf07.html">Bugku的一道注入--INSERT INTO注入</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/26</span>
            <a class="archive-post-title" href="/posts/e1cf93ae.html">ThinkPHP框架学习---路由</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/25</span>
            <a class="archive-post-title" href="/posts/dec252e7.html">ThinkPHP框架学习---config类和config助手函数</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/25</span>
            <a class="archive-post-title" href="/posts/8405173.html">ThinkPHP框架学习---框架目录及框架配置</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/19</span>
            <a class="archive-post-title" href="/posts/5d13a793.html">Nmap使用指南</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/12</span>
            <a class="archive-post-title" href="/posts/e6caa5f0.html">SQL注入小记(二)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/09</span>
            <a class="archive-post-title" href="/posts/78f948a4.html">PHP学习--超级全局变量</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/08</span>
            <a class="archive-post-title" href="/posts/777d53bb.html">PHP学习--变量</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/03</span>
            <a class="archive-post-title" href="/posts/f0bc436c.html">PHP框架MVC学习</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/30</span>
            <a class="archive-post-title" href="/posts/117580c0.html">CTF中的python脚本题小结（二）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/30</span>
            <a class="archive-post-title" href="/posts/21636c18.html">CTF中的python脚本题小结（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/20</span>
            <a class="archive-post-title" href="/posts/fc74b0ce.html">Hackergame 2018 wp</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/25</span>
            <a class="archive-post-title" href="/posts/8c800523.html">安恒九月题的misc和一道web</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/10</span>
            <a class="archive-post-title" href="/posts/49fb3e92.html">SQL注入小记(一)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/27</span>
            <a class="archive-post-title" href="/posts/21c35507.html">隐写术-LSB隐写</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/26</span>
            <a class="archive-post-title" href="/posts/59bc0c0.html">隐写术--NTFS流隐写</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/25</span>
            <a class="archive-post-title" href="/posts/c7cffe19.html">CTF常见隐写手段小结</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/22</span>
            <a class="archive-post-title" href="/posts/69896e9f.html">DOM 文档对象模型</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/21</span>
            <a class="archive-post-title" href="/posts/20cf0786.html">BOM-浏览器操作对象模型之history和screen对象</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/20</span>
            <a class="archive-post-title" href="/posts/f92f304f.html">BOM 浏览器操作对象模型之navigator、location对象</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/18</span>
            <a class="archive-post-title" href="/posts/79f16c6a.html">BOM-浏览器操作对象模型之window对象</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/16</span>
            <a class="archive-post-title" href="/posts/aa0a7b0a.html">Javascript基础之数据类型2</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/15</span>
            <a class="archive-post-title" href="/posts/33032ab0.html">Javascript基础之数据类型1</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/12</span>
            <a class="archive-post-title" href="/posts/b5fac929.html">CTF隐写术--关于ZIP</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/09</span>
            <a class="archive-post-title" href="/posts/98736a90.html">CSS样式基础4.4--选择器之伪类选择器</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/08</span>
            <a class="archive-post-title" href="/posts/17442633.html">Bugku的一道misc-----猫片</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/08</span>
            <a class="archive-post-title" href="/posts/d4db3e56.html">CSS基础4.3--选择器之属性选择器</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/05</span>
            <a class="archive-post-title" href="/posts/7b6c38ce.html">CSS基础4.2--选择器之组合选择器</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/03</span>
            <a class="archive-post-title" href="/posts/6027632.html">CSS基础4.1--选择器之CSS基础4.1-选择器之基本选择器</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/02</span>
            <a class="archive-post-title" href="/posts/370eaad5.html">CSS基础3.2--特性之CSS基础3.2--特性之继承性</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/01</span>
            <a class="archive-post-title" href="/posts/4655c16f.html">CSS基础3.1--特性之CSS基础3.1-特性之层叠性</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/01</span>
            <a class="archive-post-title" href="/posts/ae68c748.html">CSS基础2--CSS基础2-应用</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/01</span>
            <a class="archive-post-title" href="/posts/6b427aa1.html">CSS基础1--样式</a>
        </li>
            </ul>
    </div>
</div>

        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
            <span class="sidebar-tag-name" data-tags="区块链技术">
                <span class="iconfont-archer">&#xe606;</span>
                区块链技术
            </span>
            <span class="sidebar-tag-name" data-tags="开发技术">
                <span class="iconfont-archer">&#xe606;</span>
                开发技术
            </span>
            <span class="sidebar-tag-name" data-tags="Java">
                <span class="iconfont-archer">&#xe606;</span>
                Java
            </span>
            <span class="sidebar-tag-name" data-tags="渗透测试">
                <span class="iconfont-archer">&#xe606;</span>
                渗透测试
            </span>
            <span class="sidebar-tag-name" data-tags="漏洞分析">
                <span class="iconfont-archer">&#xe606;</span>
                漏洞分析
            </span>
            <span class="sidebar-tag-name" data-tags="web安全">
                <span class="iconfont-archer">&#xe606;</span>
                web安全
            </span>
            <span class="sidebar-tag-name" data-tags="前端">
                <span class="iconfont-archer">&#xe606;</span>
                前端
            </span>
            <span class="sidebar-tag-name" data-tags="Go语言">
                <span class="iconfont-archer">&#xe606;</span>
                Go语言
            </span>
            <span class="sidebar-tag-name" data-tags="Go Web">
                <span class="iconfont-archer">&#xe606;</span>
                Go Web
            </span>
            <span class="sidebar-tag-name" data-tags="论文阅读">
                <span class="iconfont-archer">&#xe606;</span>
                论文阅读
            </span>
            <span class="sidebar-tag-name" data-tags="CTF">
                <span class="iconfont-archer">&#xe606;</span>
                CTF
            </span>
            <span class="sidebar-tag-name" data-tags="SQL注入">
                <span class="iconfont-archer">&#xe606;</span>
                SQL注入
            </span>
            <span class="sidebar-tag-name" data-tags="CSS">
                <span class="iconfont-archer">&#xe606;</span>
                CSS
            </span>
            <span class="sidebar-tag-name" data-tags="python">
                <span class="iconfont-archer">&#xe606;</span>
                python
            </span>
            <span class="sidebar-tag-name" data-tags="隐写术">
                <span class="iconfont-archer">&#xe606;</span>
                隐写术
            </span>
            <span class="sidebar-tag-name" data-tags="云技术">
                <span class="iconfont-archer">&#xe606;</span>
                云技术
            </span>
            <span class="sidebar-tag-name" data-tags="DevOps">
                <span class="iconfont-archer">&#xe606;</span>
                DevOps
            </span>
            <span class="sidebar-tag-name" data-tags="开发与运维">
                <span class="iconfont-archer">&#xe606;</span>
                开发与运维
            </span>
            <span class="sidebar-tag-name" data-tags="DevSecOps">
                <span class="iconfont-archer">&#xe606;</span>
                DevSecOps
            </span>
            <span class="sidebar-tag-name" data-tags="网络编程">
                <span class="iconfont-archer">&#xe606;</span>
                网络编程
            </span>
            <span class="sidebar-tag-name" data-tags="Kubernete">
                <span class="iconfont-archer">&#xe606;</span>
                Kubernete
            </span>
            <span class="sidebar-tag-name" data-tags="云安全">
                <span class="iconfont-archer">&#xe606;</span>
                云安全
            </span>
            <span class="sidebar-tag-name" data-tags="分布式技术">
                <span class="iconfont-archer">&#xe606;</span>
                分布式技术
            </span>
            <span class="sidebar-tag-name" data-tags="MatLab">
                <span class="iconfont-archer">&#xe606;</span>
                MatLab
            </span>
            <span class="sidebar-tag-name" data-tags="PHP">
                <span class="iconfont-archer">&#xe606;</span>
                PHP
            </span>
            <span class="sidebar-tag-name" data-tags="Quarkus">
                <span class="iconfont-archer">&#xe606;</span>
                Quarkus
            </span>
            <span class="sidebar-tag-name" data-tags="Spring">
                <span class="iconfont-archer">&#xe606;</span>
                Spring
            </span>
            <span class="sidebar-tag-name" data-tags="docker">
                <span class="iconfont-archer">&#xe606;</span>
                docker
            </span>
            <span class="sidebar-tag-name" data-tags="NodeJS">
                <span class="iconfont-archer">&#xe606;</span>
                NodeJS
            </span>
            <span class="sidebar-tag-name" data-tags="express">
                <span class="iconfont-archer">&#xe606;</span>
                express
            </span>
            <span class="sidebar-tag-name" data-tags="微服务技术">
                <span class="iconfont-archer">&#xe606;</span>
                微服务技术
            </span>
            <span class="sidebar-tag-name" data-tags="密码学">
                <span class="iconfont-archer">&#xe606;</span>
                密码学
            </span>
            <span class="sidebar-tag-name" data-tags="以太坊">
                <span class="iconfont-archer">&#xe606;</span>
                以太坊
            </span>
            <span class="sidebar-tag-name" data-tags="智能合约">
                <span class="iconfont-archer">&#xe606;</span>
                智能合约
            </span>
            <span class="sidebar-tag-name" data-tags="pwn">
                <span class="iconfont-archer">&#xe606;</span>
                pwn
            </span>
            <span class="sidebar-tag-name" data-tags="电子取证">
                <span class="iconfont-archer">&#xe606;</span>
                电子取证
            </span>
            <span class="sidebar-tag-name" data-tags="日常">
                <span class="iconfont-archer">&#xe606;</span>
                日常
            </span>
            <span class="sidebar-tag-name" data-tags="C编程">
                <span class="iconfont-archer">&#xe606;</span>
                C编程
            </span>
            <span class="sidebar-tag-name" data-tags="课程总结">
                <span class="iconfont-archer">&#xe606;</span>
                课程总结
            </span>
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
        缺失模块，请参考主题文档进行安装配置：https://github.com/fi3ework/hexo-theme-archer#%E5%AE%89%E8%A3%85%E4%B8%BB%E9%A2%98
    </div> 
    <div class="sidebar-tags-list"></div>
</div>

        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
        <span class="sidebar-category-name" data-categories="区块链技术">
            <span class="iconfont-archer">&#xe60a;</span>
            区块链技术
        </span>
        <span class="sidebar-category-name" data-categories="开发技术">
            <span class="iconfont-archer">&#xe60a;</span>
            开发技术
        </span>
        <span class="sidebar-category-name" data-categories="漏洞分析">
            <span class="iconfont-archer">&#xe60a;</span>
            漏洞分析
        </span>
        <span class="sidebar-category-name" data-categories="论文阅读">
            <span class="iconfont-archer">&#xe60a;</span>
            论文阅读
        </span>
        <span class="sidebar-category-name" data-categories="CTF">
            <span class="iconfont-archer">&#xe60a;</span>
            CTF
        </span>
        <span class="sidebar-category-name" data-categories="渗透测试">
            <span class="iconfont-archer">&#xe60a;</span>
            渗透测试
        </span>
        <span class="sidebar-category-name" data-categories="DevSecOps">
            <span class="iconfont-archer">&#xe60a;</span>
            DevSecOps
        </span>
        <span class="sidebar-category-name" data-categories="云安全">
            <span class="iconfont-archer">&#xe60a;</span>
            云安全
        </span>
        <span class="sidebar-category-name" data-categories="MATLAB">
            <span class="iconfont-archer">&#xe60a;</span>
            MATLAB
        </span>
        <span class="sidebar-category-name" data-categories="密码学">
            <span class="iconfont-archer">&#xe60a;</span>
            密码学
        </span>
        <span class="sidebar-category-name" data-categories="电子取证">
            <span class="iconfont-archer">&#xe60a;</span>
            电子取证
        </span>
        <span class="sidebar-category-name" data-categories="课程总结">
            <span class="iconfont-archer">&#xe60a;</span>
            课程总结
        </span>
        <span class="sidebar-category-name" data-categories="杂谈">
            <span class="iconfont-archer">&#xe60a;</span>
            杂谈
        </span>
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>

    </div>
</div>

        <!-- site-meta -->
        <script>
    var siteMetaRoot = "/"
    if (siteMetaRoot === "undefined") {
        siteMetaRoot = '/'
    }
    var siteMeta = {
        url: "https://lzwgiter.github.io",
        root: siteMetaRoot,
        author: "f10@t"
    }
</script>

        <!-- import experimental options here -->
        <!-- Custom Font -->

        <!-- main func -->
        <script src="/scripts/main.js"></script>
        <!-- fancybox -->
        <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.umd.js" onload="window.Fancybox.bind('[data-fancybox]')" defer></script>
        <!-- algolia -->
            <div class="site-search site-search-loading">
    <div class="algolia-popup popup">
        <div class="algolia-search">
            <div class="algolia-search-input-icon">
                <i class="fa fa-search"></i>
            </div>
            <div class="algolia-search-input" id="algolia-search-input"></div>
            <div class="popup-btn-close">
                <i class="iconfont-archer">&#xe609;</i>
            </div>
        </div>

        <div class="algolia-results">
            <div id="algolia-stats" class="algolia-stats"></div>
            <div id="algolia-hits"></div>
            <div id="algolia-pagination" class="algolia-pagination"></div>
        </div>
    </div>
</div>

            <script src="/scripts/search.js" async></script>
        <!-- busuanzi -->
            <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
        <!-- async load share.js -->
            <script src="/scripts/share.js" async></script>
        <!-- mermaid -->
    </body>
</html>
