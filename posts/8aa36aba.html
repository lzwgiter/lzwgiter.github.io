<!DOCTYPE html>
<html lang="zh-CN">
    <!-- title -->
<!-- keywords -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="author" content="f10@t">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="f10@t">
        <meta name="keywords" content="lzwgiter,f10@t's blog">
    <meta name="description" content="blogs from f10@t">
    <meta name="description" content="之前入门学习了k8s集群环境的搭建和基本概念包括框架、网络模型，部署与动态扩展服务的方法：  Kubernetes 集群环境搭建使用及问题记录（一） Kubernetes-集群环境搭建使用及问题记录（二） Kubernetes-集群环境搭建使用及问题记录（三）  回归安全的课题上来，云安全本质上是传统安全在云原生环境下的重新思考。作为业内事实标准，k8s可以提供服务管理、扩容等诸">
<meta property="og:type" content="article">
<meta property="og:title" content="K8s攻防之OWASP-K8S-TOP10（上）">
<meta property="og:url" content="https://lzwgiter.github.io/posts/8aa36aba.html">
<meta property="og:site_name" content="f10@t&#39;s blog">
<meta property="og:description" content="之前入门学习了k8s集群环境的搭建和基本概念包括框架、网络模型，部署与动态扩展服务的方法：  Kubernetes 集群环境搭建使用及问题记录（一） Kubernetes-集群环境搭建使用及问题记录（二） Kubernetes-集群环境搭建使用及问题记录（三）  回归安全的课题上来，云安全本质上是传统安全在云原生环境下的重新思考。作为业内事实标准，k8s可以提供服务管理、扩容等诸">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lzwgiter.github.io/img/K8s%E6%94%BB%E9%98%B2%E4%B9%8BOWASP-K8S-TOP10%EF%BC%88%E4%B8%8A%EF%BC%89/image-20230917222234007.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/K8s%E6%94%BB%E9%98%B2%E4%B9%8BOWASP-K8S-TOP10%EF%BC%88%E4%B8%8A%EF%BC%89/image-20230918204405720.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/K8s%E6%94%BB%E9%98%B2%E4%B9%8BOWASP-K8S-TOP10%EF%BC%88%E4%B8%8A%EF%BC%89/image-20230918205420522.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/K8s%E6%94%BB%E9%98%B2%E4%B9%8BOWASP-K8S-TOP10%EF%BC%88%E4%B8%8A%EF%BC%89/image-20230918210321217.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/K8s%E6%94%BB%E9%98%B2%E4%B9%8BOWASP-K8S-TOP10%EF%BC%88%E4%B8%8A%EF%BC%89/image-20230920153859379.png">
<meta property="og:image" content="https://lzwgiter.github.io/img/K8s%E6%94%BB%E9%98%B2%E4%B9%8BOWASP-K8S-TOP10%EF%BC%88%E4%B8%8A%EF%BC%89/Kyverno-Policy-Structure.png">
<meta property="article:published_time" content="2023-09-16T07:25:21.000Z">
<meta property="article:modified_time" content="2024-07-24T02:41:57.303Z">
<meta property="article:author" content="f10@t">
<meta property="article:tag" content="Kubernete">
<meta property="article:tag" content="云安全">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lzwgiter.github.io/img/K8s%E6%94%BB%E9%98%B2%E4%B9%8BOWASP-K8S-TOP10%EF%BC%88%E4%B8%8A%EF%BC%89/image-20230917222234007.png">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="icon" href="/assets/hello.svg">
    <title>K8s攻防之OWASP-K8S-TOP10（上） · f10@t&#39;s blog</title>
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
    (function (w) {
        'use strict'
        // rel=preload support test
        if (!w.loadCSS) {
            w.loadCSS = function () {}
        }
        // define on the loadCSS obj
        var rp = (loadCSS.relpreload = {})
        // rel=preload feature support test
        // runs once and returns a function for compat purposes
        rp.support = (function () {
            var ret
            try {
                ret = w.document.createElement('link').relList.supports('preload')
            } catch (e) {
                ret = false
            }
            return function () {
                return ret
            }
        })()

        // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
        // then change that media back to its intended value on load
        rp.bindMediaToggle = function (link) {
            // remember existing media attr for ultimate state, or default to 'all'
            var finalMedia = link.media || 'all'

            function enableStylesheet() {
                link.media = finalMedia
            }

            // bind load handlers to enable media
            if (link.addEventListener) {
                link.addEventListener('load', enableStylesheet)
            } else if (link.attachEvent) {
                link.attachEvent('onload', enableStylesheet)
            }

            // Set rel and non-applicable media type to start an async request
            // note: timeout allows this to happen async to let rendering continue in IE
            setTimeout(function () {
                link.rel = 'stylesheet'
                link.media = 'only x'
            })
            // also enable media after 3 seconds,
            // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
            setTimeout(enableStylesheet, 3000)
        }

        // loop through link elements in DOM
        rp.poly = function () {
            // double check this to prevent external calls from running
            if (rp.support()) {
                return
            }
            var links = w.document.getElementsByTagName('link')
            for (var i = 0; i < links.length; i++) {
                var link = links[i]
                // qualify links to those with rel=preload and as=style attrs
                if (
                    link.rel === 'preload' &&
                    link.getAttribute('as') === 'style' &&
                    !link.getAttribute('data-loadcss')
                ) {
                    // prevent rerunning on link
                    link.setAttribute('data-loadcss', true)
                    // bind listeners to toggle media back
                    rp.bindMediaToggle(link)
                }
            }
        }

        // if unsupported, run the polyfill
        if (!rp.support()) {
            // run once at least
            rp.poly()

            // rerun poly on an interval until onload
            var run = w.setInterval(rp.poly, 500)
            if (w.addEventListener) {
                w.addEventListener('load', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            } else if (w.attachEvent) {
                w.attachEvent('onload', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            }
        }

        // commonjs
        if (typeof exports !== 'undefined') {
            exports.loadCSS = loadCSS
        } else {
            w.loadCSS = loadCSS
        }
    })(typeof global !== 'undefined' ? global : this)
</script>

    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .footer-fixed-btn,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(
            -45deg,
            #444 0,
            #444 80px,
            #333 80px,
            #333 160px
        );
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }
</style>

    <link id="stylesheet-fancybox" rel="preload" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link id="stylesheet-base" rel="preload" href="/css/style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link id="stylesheet-mobile" rel="preload" href="/css/mobile.css" as="style" onload="this.onload=null;this.rel='stylesheet';this.media='screen and (max-width: 960px)'">
    <link id="stylesheet-theme-dark" rel="preload" href="/css/dark.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" as="script">
    <link rel="preload" href="/scripts/main.js" as="script">
    <link rel="preload" href="/font/Oswald-Regular.ttf" as="font" crossorigin>
    <link rel="preload" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" as="font" crossorigin>
    <!-- algolia -->
        <script>
            var hits = JSON.parse('{"per_page":10}')
            var labels = JSON.parse('{"input_placeholder":"搜索文章相关内容","hits_empty":"${query}搜索结果为空: ","hits_stats":"找到结果${hits}条，用时${time} ms"}')

            var algolia = {
                applicationID: 'BTZ93R2DLS',
                apiKey: '672baf14074cdc7c5be7c85fe8b4d8bb',
                indexName: 'hexo_blogs',
                hits: hits,
                labels: labels
            }
        </script>
    <!-- 百度统计  -->
        <script>
            var _hmt = _hmt || [];
            (function () {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?9ef67111f9ae4eefa278780655f0c1e3";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();
        </script>
    <!-- 谷歌统计  -->
        <script>
            var cnzz_s_tag = document.createElement('script');
            cnzz_s_tag.type = 'text/javascript';
            cnzz_s_tag.async = true;
            cnzz_s_tag.charset = 'utf-8';
            cnzz_s_tag.src = 'https://w.cnzz.com/c.php?id=&async=1';
            var root_s = document.getElementsByTagName('script')[0];
            root_s.parentNode.insertBefore(cnzz_s_tag, root_s);
        </script>
    <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-8DFDYFMQP8"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-8DFDYFMQP8');
        </script>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="f10@t's blog" type="application/atom+xml">
</head>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ == undefined) {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js" />')
        }
    </script>
        <body class="post-body">
        <!-- header -->
        <header class="header header-mobile">
    <!-- top read progress line -->
    <div class="header-element">
        <div class="read-progress read-progress-feature"></div>
    </div>
    <!-- sidebar menu button -->
    <div class="header-element">
        <div class="header-sidebar-menu header-sidebar-menu-rounded">
            <i class="fas fa-bars"></i>
        </div>
    </div>
    <!-- header actions -->
    <div class="header-actions">
        <!-- theme mode switch button -->
        <span class="header-theme-btn header-element">
            <i class="fas fa-adjust"></i>
        </span>
        <!-- back to home page text -->
        <span class="home-link header-element">
            <a href="/">f10@t's blog</a>
        </span>
    </div>
    <!-- toggle banner -->
    <div class="banner">
        <div class="blog-title header-element">
            <a href="/">f10@t&#39;s blog</a>
        </div>
        <div class="post-title header-element">
            <a href="#" class="post-name">K8s攻防之OWASP-K8S-TOP10（上）</a>
        </div>
    </div>
</header>

        <!-- fixed footer -->
        <footer class="footer-fixed">
    <!-- donate button -->
    <div class="donate-popup donate-popup--hidden">
    <div class="donate-popup__title">Buy Me A Coffee</div>
    <div class="donate-popup__content">
        <div class="donate-popup__content-description">如果这篇文章帮到了你，请赏一杯咖啡给我喝吧嘿嘿☕️</div>
        <img
            class="donate-popup__content-qrCode"
            title="Wechat"
            alt="Wechat"
            src="/assets/donate-wechat.jpg"
        ></img>
        <img
            class="donate-popup__content-qrCode"
            title="Alipay"
            alt="Alipay"
            src="/assets/donate-alipay.jpg"
        ></img>
    </div>
</div>

    <div
        title="Donate to the author"
        class="footer-fixed-btn footer-fixed-btn--hidden footer-fixed-btn--rounded donate-btn"
    >
        <i class="fas fa-donate"></i>
    </div>

    <!-- back to top button -->
    <div class="footer-fixed-btn footer-fixed-btn--hidden footer-fixed-btn--rounded back-top">
        <i class="fas fa-chevron-up"></i>
    </div>
</footer>

        <!-- wrapper -->
        <div class="wrapper">
            <div class="site-intro" style="    height:50vh;
">
    <!-- 主页  -->
    <!-- 404页  -->
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(https://source.unsplash.com/random/1600x900?landscape)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
                K8s攻防之OWASP-K8S-TOP10（上）
            <!-- 404 -->
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            <!-- 404 -->
        </p>
        <!-- 文章页 meta -->
            <div class="post-intros">
                <!-- 文章页标签  -->
                    <div class="post-intro-tags" >
        <span class="post-category" data-categories="云安全">
            <i class="fas fa-folder post-category-icon"></i>
            <span class="post-category-text">
                云安全
            </span>
        </span>
        <a class="post-tag" href="javascript:void(0);" data-tags="Kubernete">Kubernete</a>
        <a class="post-tag" href="javascript:void(0);" data-tags="云安全">云安全</a>
</div>

                <!-- 文章字数统计 -->
                    <div class="post-intro-read">
                        <span>字数统计: <span class="post-count word-count">6.9k</span>阅读时长: <span class="post-count reading-time">30 min</span></span>
                    </div>
                <div class="post-intro-meta">
                    <!-- 撰写日期 -->
                    <span class="iconfont-archer post-intro-calander">&#xe676;</span>
                    <span class="post-intro-time">2023/09/16</span>
                    <!-- busuanzi -->
                        <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                            <span class="iconfont-archer post-intro-busuanzi">&#xe602;</span>
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    <!-- 文章分享 -->
                    <span class="share-wrapper">
                        <span class="iconfont-archer share-icon">&#xe71d;</span>
                        <span class="share-text">Share</span>
                        <ul class="share-list">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
    </div>
</div>

            <script>
  // get user agent
  function getBrowserVersions() {
    var u = window.navigator.userAgent
    return {
      userAgent: u,
      trident: u.indexOf('Trident') > -1, //IE内核
      presto: u.indexOf('Presto') > -1, //opera内核
      webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
      gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
      mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
      ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
      android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
      iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
      iPad: u.indexOf('iPad') > -1, //是否为iPad
      webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
      weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
      uc: u.indexOf('UCBrowser') > -1, //是否为android下的UC浏览器
    }
  }
  var browser = {
    versions: getBrowserVersions(),
  }
  console.log('userAgent: ' + browser.versions.userAgent)

  // callback
  function fontLoaded() {
    console.log('font loaded')
    if (document.getElementsByClassName('site-intro-meta')) {
      document
        .getElementsByClassName('intro-title')[0]
        .classList.add('intro-fade-in')
      document
        .getElementsByClassName('intro-subtitle')[0]
        .classList.add('intro-fade-in')
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in')
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb() {
    if (browser.versions.uc) {
      console.log('UCBrowser')
      fontLoaded()
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular'],
        },
        loading: function () {
          // 所有字体开始加载
          // console.log('font loading');
        },
        active: function () {
          // 所有字体已渲染
          fontLoaded()
        },
        inactive: function () {
          // 字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout')
          fontLoaded()
        },
        timeout: 5000, // Set the timeout to two seconds
      })
    }
  }

  function asyncErr() {
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0]
    o.src = u
    if (cb) {
      o.addEventListener(
        'load',
        function (e) {
          cb(null, e)
        },
        false
      )
    }
    if (err) {
      o.addEventListener(
        'error',
        function (e) {
          err(null, e)
        },
        false
      )
    }
    s.parentNode.insertBefore(o, s)
  }

  var asyncLoadWithFallBack = function (arr, success, reject) {
    var currReject = function () {
      reject()
      arr.shift()
      if (arr.length) async(arr[0], success, currReject)
    }

    async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack(
    [
      'https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js',
      'https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js',
      "/lib/webfontloader.min.js",
    ],
    asyncCb,
    asyncErr
  )
</script>

            <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" alt="loading">
            <div class="container container-unloaded">
                <main class="main post-page">
    <article class="article-entry">
        <blockquote>
<p>之前入门学习了k8s集群环境的搭建和基本概念包括框架、网络模型，部署与动态扩展服务的方法：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.f10at.cn/posts/eed4a979.html">Kubernetes
集群环境搭建使用及问题记录（一）</a></li>
<li><a
target="_blank" rel="noopener" href="https://www.f10at.cn/posts/a08eb123.html">Kubernetes-集群环境搭建使用及问题记录（二）</a></li>
<li><a
target="_blank" rel="noopener" href="https://www.f10at.cn/posts/ed901271.html">Kubernetes-集群环境搭建使用及问题记录（三）</a></li>
</ul>
<p>回归安全的课题上来，云安全本质上是传统安全在云原生环境下的重新思考。作为业内事实标准，k8s可以提供服务管理、扩容等诸多功能，是提供云原生能力的基石。</p>
<p>因此后面计划首先学习云安全分支下的k8s安全，并同时学习docker中的常见安全问题。这篇先学习<a
target="_blank" rel="noopener" href="https://owasp.org/www-project-kubernetes-top-ten/">OWASP
Kubernetes Top Ten</a>的前五个。</p>
<p><img src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230917222234007.png" style="zoom:60%;" /></p>
</blockquote>
<span id="more"></span>
<h1 id="k8s环境准备">K8S环境准备</h1>
<p>仍然使用之前博客中搭建好的环境，一共三台CentOS
7的虚拟机，其IP和角色分别如下：</p>
<ul>
<li>10.10.10.101（Master）</li>
<li>10.10.10.102（node-1）</li>
<li>10.10.10.103（node-2）</li>
</ul>
<blockquote>
<p>这里有一个小插曲，打开后发现我的kubelet服务没有起来，提示客户端证书过期了</p>
</blockquote>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230916152715777.png" /></p>
<p>用<code>kubeadm</code>检查一下，还真是</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230916153006771.png" /></p>
<p>解决方法：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">备份旧证书</span></span><br><span class="line">cd /etc/kubernetes/pki/</span><br><span class="line">mkdir 2023-09-16-pki-backup</span><br><span class="line">mv *.key *.crt sa.pub etcd/ 2023-09-16-pki-backup/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新生成证书</span></span><br><span class="line">kubeadm init phase certs all</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">备份历史配置文件</span></span><br><span class="line">cd /etc/kubernetes</span><br><span class="line">mkdir 2023-09-16-k8s-backup</span><br><span class="line">mv  *.conf 2023-09-16-k8s-backup/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新生成配置文件</span></span><br><span class="line">kubeadm init phase kubeconfig all</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新管理员配置文件以确保kubectl的正常使用</span></span><br><span class="line">cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br></pre></td></tr></table></figure>
<p>这时候查看<code>kubelet</code>状态就恢复了：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230916162300287.png" /></p>
<p>However，这时候从节点还是g的：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230916162543423.png" /></p>
<p>这是因为这两节点的<code>kubelet.conf</code>还没有更新，下面做更新操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">筛选Kube-scheduler的容器</span></span><br><span class="line">docker ps -a | grep kube-scheduler | awk ‘&#123;print $1&#125;’</span><br><span class="line">docker rm -f 上述容器</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">等待重启状态恢复到1/1</span></span><br><span class="line">kubectl get pods -n kube-system | grep scheduler</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">分别生成从节点的kebelet.conf文件（版本号、节点名称需要改成你自己的）并拷贝</span></span><br><span class="line">kubeadm init --kubernetes-version=v1.22.2 phase kubeconfig kubelet --node-name k8s-node01 --kubeconfig-dir ~/</span><br><span class="line">scp ~/kubelet.conf k8s-node01:/etc/kubernets/</span><br><span class="line"></span><br><span class="line">kubeadm init --kubernetes-version=v1.22.2 phase kubeconfig kubelet --node-name k8s-node01 --kubeconfig-dir ~/</span><br><span class="line">scp ~/kubelet.conf k8s-node02:/etc/kubernets/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启所有虚拟机</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>
<p>然后就恢复了：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230917143430965.png" /></p>
<blockquote>
<p>这个问题属于<strong>K8s证书过期</strong>的日常问题，这里我是手动解决的。查阅资料过程中发现也有其它自动化解决手段，什么自动证书轮转，这里暂时不继续探究。</p>
</blockquote>
<h1 id="kubernetes-goat环境搭建">Kubernetes goat环境搭建</h1>
<ol type="1">
<li><p>安装k8s包管理器-<a
target="_blank" rel="noopener" href="https://helm.sh/">Helm</a>，类似apt和yum，用于向K8s中安装云原生应用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用国内的helm charts源</span></span><br><span class="line">helm repo add appstore https://charts.grapps.cn</span><br></pre></td></tr></table></figure></li>
<li><p>克隆k8s-goat</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/madhuakula/kubernetes-goat.git</span><br><span class="line">cd kubernetes-goat</span><br><span class="line">bash setup-kubernetes-goat.sh</span><br></pre></td></tr></table></figure></li>
</ol>
<p>安装结果如下：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230917152553267.png" /></p>
<p>稍等一会儿后，可以看到当前活动的pods：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230917164629557.png" /></p>
<p>最后运行<code>access-kubernetes-goat.sh</code>脚本即可完成环境搭建：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230917164804225.png" /></p>
<blockquote>
<p>这里又出问题了，但是我自己环境的问题，这部分可以忽略。</p>
<p>执行后我并没有看到出现新的Pod，且端口不可访问，因为原脚本将输出重定向到了null。因此单独执行命令后发现如下问题，目前尚未解决，已发起issue提问：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230917221219482.png" /></p>
</blockquote>
<p>考虑到这里只是想要转发一个端口，因此我自己重新写了一下这个脚本，换为<code>expose</code>的方式：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Author: lzwigter&lt;float311@163.com&gt;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This program has been created as part of Kubernetes Goat, but using expose instead of using port-forward,</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Kubernetes Goat Access vulnerable infrastructure</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Checking kubectl setup</span></span><br><span class="line">kubectl version --short &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">if [ $? -eq 0 ];</span><br><span class="line">then</span><br><span class="line">    echo &quot;kubectl setup looks good.&quot;</span><br><span class="line">else</span><br><span class="line">    echo &quot;Please check kubectl setup.&quot;</span><br><span class="line">    exit;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo &#x27;Creating service expose for all the Kubernetes Goat resources to locally.&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Exposing Sensitive keys <span class="keyword">in</span> code bases Scenario</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">export</span> POD_NAME=$(kubectl get pods --namespace default -l <span class="string">&quot;app=build-code&quot;</span> -o jsonpath=<span class="string">&quot;&#123;.items[0].metadata.name&#125;&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl port-forward <span class="variable">$POD_NAME</span> --address 0.0.0.0 1230:3000 &gt; /dev/null 2&gt;&amp;1 &amp;</span></span><br><span class="line">kubectl expose deployment build-code-deployment --port 3000 --type=NodePort</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Exposing DIND (docker-in-docker) exploitation Scenario</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">export</span> POD_NAME=$(kubectl get pods --namespace default -l <span class="string">&quot;app=health-check&quot;</span> -o jsonpath=<span class="string">&quot;&#123;.items[0].metadata.name&#125;&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">kubectl port-forward <span class="variable">$POD_NAME</span> --address 0.0.0.0 1231:80 &gt; /dev/null 2&gt;&amp;1 &amp;</span></span><br><span class="line">kubectl expose deployment health-check-deployment --port 80  --type=NodePort</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Exposing SSRF <span class="keyword">in</span> K8S world Scenario</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">export</span> POD_NAME=$(kubectl get pods --namespace default -l <span class="string">&quot;app=internal-proxy&quot;</span> -o jsonpath=<span class="string">&quot;&#123;.items[0].metadata.name&#125;&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl port-forward <span class="variable">$POD_NAME</span> --address 0.0.0.0 1232:3000 &gt; /dev/null 2&gt;&amp;1 &amp;</span></span><br><span class="line">kubectl expose deployment internal-proxy-deployment --port 3000 --type=NodePort</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Exposing Container escape to access host system Scenario</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">export</span> POD_NAME=$(kubectl get pods --namespace default -l <span class="string">&quot;app=system-monitor&quot;</span> -o jsonpath=<span class="string">&quot;&#123;.items[0].metadata.name&#125;&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl port-forward <span class="variable">$POD_NAME</span> --address 0.0.0.0 1233:8080 &gt; /dev/null 2&gt;&amp;1 &amp;</span></span><br><span class="line">kubectl expose deployment system-monitor-deployment --port 8080 --type=NodePort</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Exposing Kubernetes Goat Home</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">export</span> POD_NAME=$(kubectl get pods --namespace default -l <span class="string">&quot;app=kubernetes-goat-home&quot;</span> -o jsonpath=<span class="string">&quot;&#123;.items[0].metadata.name&#125;&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl port-forward <span class="variable">$POD_NAME</span> --address 0.0.0.0 1234:80 &gt; /dev/null 2&gt;&amp;1 &amp;</span></span><br><span class="line">kubectl expose deployment kubernetes-goat-home-deployment --port 80 --type=NodePort</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Exposing Attacking private registry Scenario</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">export</span> POD_NAME=$(kubectl get pods --namespace default -l <span class="string">&quot;app=poor-registry&quot;</span> -o jsonpath=<span class="string">&quot;&#123;.items[0].metadata.name&#125;&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl port-forward <span class="variable">$POD_NAME</span> --address 0.0.0.0 1235:5000 &gt; /dev/null 2&gt;&amp;1 &amp;</span></span><br><span class="line">kubectl expose deployment poor-registry-deployment --port 5000 --type=NodePort</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Exposing DoS resources Scenario</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">export</span> POD_NAME=$(kubectl get pods --namespace big-monolith -l <span class="string">&quot;app=hunger-check&quot;</span> -o jsonpath=<span class="string">&quot;&#123;.items[0].metadata.name&#125;&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl --namespace big-monolith port-forward <span class="variable">$POD_NAME</span> --address 0.0.0.0 1236:8080 &gt; /dev/null 2&gt;&amp;1 &amp;</span></span><br><span class="line">kubectl expose deployment hunger-check-deployment -n big-monolith --port 8080 --type=NodePort</span><br><span class="line"></span><br><span class="line">echo &quot;Check kubectl get svc -o wide and  visit app kubernetes-goat-home-deployment&quot;</span><br></pre></td></tr></table></figure>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230917221826007.png" /></p>
<p>上面红框中的home服务为入口：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230917220721962.png" /></p>
<h1 id="owasp-kubernets-top-10">OWASP Kubernets Top 10</h1>
<h2 id="k01-insecure-workload-configurations">K01: Insecure Workload
Configurations</h2>
<h3 id="定义">定义</h3>
<p>OWASP中的定义说明如下：</p>
<blockquote>
<p>Kubernetes manifests contain many different configurations that can
affect the reliability, security, and scalability of a given workload.
These configurations should be audited and remediated continuously.</p>
</blockquote>
<p>其实类似于通常我们使用<code>yaml</code>文件格式来部署deployment、service等资源，因此若这些文件中存在不安全的配置则会导致安全问题，其实感觉比较像OWASP
Top 10中的<a
target="_blank" rel="noopener" href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/"><strong>A05:2021-Security
Misconfiguration</strong></a>。</p>
<p>具体来说OWASP给出了如下例子：</p>
<ul>
<li><p>应用不应运行在Root权限（Application processes should not run as
root）</p>
<p>原因在于，如果这个容器被攻陷了，那么攻击者就拥有了root权限，可以拥有如新建进程的权限。下面是一个错误的示例文件：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>  </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span>  </span><br><span class="line"><span class="attr">metadata:</span>  </span><br><span class="line">  <span class="attr">name:</span> <span class="string">root-user</span></span><br><span class="line"><span class="attr">spec:</span>  </span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="string">...</span></span><br><span class="line">  <span class="attr">securityContext:</span>  </span><br><span class="line">    <span class="comment">#root user:</span></span><br><span class="line">    <span class="attr">runAsUser:</span> <span class="number">0</span>	<span class="comment"># 这里将该Pod的用户权限设置为了root</span></span><br><span class="line">    <span class="comment">#non-root user:</span></span><br><span class="line">    <span class="attr">runAsUser:</span> <span class="number">5554</span></span><br></pre></td></tr></table></figure></li>
<li><p>应使用只读权限（Read-only filesystems should be used）</p>
<p>为了避免攻击者从失陷容器向主机写入文件，应该使用只读选项，如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>  </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span>  </span><br><span class="line"><span class="attr">metadata:</span>  </span><br><span class="line">  <span class="attr">name:</span> <span class="string">read-only-fs</span></span><br><span class="line"><span class="attr">spec:</span>  </span><br><span class="line">  <span class="attr">containers:</span>  </span><br><span class="line"></span><br><span class="line">  <span class="attr">securityContext:</span>  </span><br><span class="line">    <span class="comment">#read-only fs explicitly defined</span></span><br><span class="line">    <span class="attr">readOnlyRootFilesystem:</span> <span class="literal">true</span>	<span class="comment"># 打开只读</span></span><br></pre></td></tr></table></figure></li>
<li><p>禁止使用提权容器（Privileged containers should be
disallowed）</p>
<p>当容器用户为root且容器自身为提权容器会导致攻击者可以直接访问主机，若非root则会受到一定限制。因此要避免设置为提权容器。错误示例：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>  </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span>  </span><br><span class="line"><span class="attr">metadata:</span>  </span><br><span class="line">  <span class="attr">name:</span> <span class="string">privileged-pod</span></span><br><span class="line"><span class="attr">spec:</span>  </span><br><span class="line">  <span class="attr">containers:</span>  </span><br><span class="line">  <span class="string">...</span></span><br><span class="line">  <span class="attr">securityContext:</span>  </span><br><span class="line">    <span class="comment">#priviliged </span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment">#non-privileged </span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3
id="对应k8s-goat场景dind-docker-in-docker-exploitation">对应k8s-goat场景：DIND
(docker-in-docker) exploitation</h3>
<p>下图为官方的攻击场景示意图，初步判断该攻击是利用主机上的docker.sock进行的。</p>
<blockquote>
<p>该攻击方法从战术上属于<code>Initial Access</code>，技术上属于<code>Application Vulnerbility</code>。</p>
</blockquote>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/scenario-2-29ce411f882ff11438dfdd96b7fa45fd.png" /></p>
<p>下面正式分析，首先访问对应端口：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230918193325808.png" /></p>
<p>这个应用对应的是<code>health-check</code>，根据场景介绍，我们的目标是逃出这个容器并访问所在主机。上帝视角先看一下这个pod的情况：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230918193627852.png" /></p>
<p>位于我集群中第二个节点上。</p>
<h3 id="预备知识关于docker.sock">预备知识：关于docker.sock</h3>
<p><code>docker.sock</code>是一个socket文件，我们平常新建容器等用到的docker命令本质上是一个客户端，通过向docker
daemon发出请求以管理容器。如下图：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/architecture-1695038714046-4.svg" /></p>
<p>而docker daemon监听的方式也有两种：</p>
<ul>
<li>UNIX 域套接字</li>
<li>TCP 端口监听</li>
</ul>
<p>前者会在本地创建一个<code>/var/run/docker.socket</code>，仅用于本机上不同进程之间的网络通信。而后者则支持其他机器的操作。<strong>默认情况下，docker使用的是UNIX域套接字，我们可以使用docker
-H参数来进行指定</strong>，如：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230918200915674.png" /></p>
<p>这两条命令结果是一样的，因为默认就是走的本地的UNIX域套接字。当然也可以走TCP，这里访问一下我屋里orangepi上的docker：</p>
<p>首先使用<code>dockerd -H tcp://0.0.0.0:2375</code>打开一个在2375端口上tcp监听的docker
daemon</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230918202439022.png" /></p>
<p>可以看到输出也提示了这样的做法是不安全的，然后我们远程连接：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230918202542445.png" /></p>
<p>证明了我们拥有了管理远程机器docker容器的能力。</p>
<h3 id="利用">利用</h3>
<p>看一下页面，提供了一个ping的功能：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230918194156807.png" /></p>
<p>Web人说话了，命令注入白？</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230918194322450.png" /></p>
<p>还真是，还是root妈诶。那下面我们就得考虑怎么从这个容器出去了，站在上帝视角上，我们再看看这个pods的详情：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230918194715209.png" /></p>
<p>在详情中我们看到了该容器挂载了所在主机的<code>/var/run/docker.sock</code>。在前述预备知识下，这里就知道了要利用docker.sock的作用以及<code>docker -H</code>。</p>
<p>回到网页，我们先用<code>mount</code>命令查看挂载内容判断是否存在<code>docker.sock</code>。</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230918203512342.png" /></p>
<p>可以看到UNIX域套接字的socket，但是当前容器中没有安装docker客户端：</p>
<p><img src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230918204405720.png" style="zoom:60%;" /></p>
<p>Ok点题了，所以叫DIND，我们得给这个容器里下一个客户端了。官方提供了下载列表供我们直接使用：<code>https://download.docker.com/linux/static/stable/x86_64/</code>。因此分别执行命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载客户端</span></span><br><span class="line">; wget https://download.docker.com/linux/static/stable/x86_64/docker-24.0.6.tgz -O /home/docker.tgz</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压使用</span></span><br><span class="line">; tar -zvxf /home/docker.tgz -C /home/</span><br></pre></td></tr></table></figure>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230918205332118.png" /></p>
<p><img src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230918205420522.png" style="zoom:60%;" /></p>
<p>然后我们就可以使用那个挂载的socket了：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230918205650826.png" /></p>
<p>到这里结束，我们就获得了运行该容器的主机上的所有运行容器，完成了一定的<strong>信息收集</strong>。并可根据此进一步去访问其他容器资源。</p>
<h3 id="问题原因">问题原因</h3>
<p>从该deployment的配置文件中就可以看到，能出现这个问题本质原因就在于该容器是提权了的。此外也没有对主机文件访问做可读限制，导致了我们可以下载一个docker客户端，从而完成DIND攻击。</p>
<p><img src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230918210321217.png" style="zoom:50%;" /></p>
<h3 id="参考学习">参考学习</h3>
<ul>
<li><a
target="_blank" rel="noopener" href="https://madhuakula.com/kubernetes-goat/docs/scenarios/scenario-2/docker-in-docker-exploitation-in-kubernetes-containers/welcome">⎈
DIND (docker-in-docker) exploitation | Kubernetes Goat
(madhuakula.com)</a></li>
<li><a
target="_blank" rel="noopener" href="https://owasp.org/www-project-kubernetes-top-ten/2022/en/src/K01-insecure-workload-configurations">K01:
Insecure Workload Configurations | OWASP Foundation</a></li>
<li><a
target="_blank" rel="noopener" href="https://www.cnblogs.com/mrxccc/p/16504719.html">Docker系列-docker.sock探究
- 狮子挽歌丿 - 博客园 (cnblogs.com)</a></li>
</ul>
<h2 id="k02-supply-chain-vulnerabilities">K02: Supply Chain
Vulnerabilities</h2>
<h3 id="定义-1">定义</h3>
<p>这个之前有听过类似的名词：<strong>镜像投毒</strong>，这个攻击也是类似的。由于容器由大量的第三方组件组成，因此这些组件若有问题，那么这个容器就存在失陷的风险。</p>
<p>官方给了三个类型：</p>
<ul>
<li><p>镜像完整性（Image Integrity）：</p>
<blockquote>
<p>Software provenance has recently attracted significant attention in
the media due to events such as the <a
target="_blank" rel="noopener" href="https://www.businessinsider.com/solarwinds-hack-explained-government-agencies-cyber-security-2020-12">Solarwinds
breach</a> and a variety of <a
target="_blank" rel="noopener" href="https://therecord.media/malware-found-in-npm-package-with-millions-of-weekly-downloads/">tainted
third-party packages</a>. These supply chain risks can surface in
various states of the container build cycle as well as at runtime inside
of Kubernetes. When systems of record do not exist regarding the
contents of a container image it is possible that an unexpected
container may run in a cluster.</p>
</blockquote>
<p>即源镜像被污染了，比如上面提到的例子，npm包中被插入了恶意代码。</p></li>
<li><p>镜像组成（Image Composition）：</p>
<blockquote>
<p>A container image consists of layers, each of which can present
security implications. A properly constructed container image not only
reduces attack surface, but can also increase deployment efficiency.
Images with extraneous software can be leveraged to elevate privileges
or exploit known vulnerabilities.</p>
</blockquote>
<p>这里感觉更多说的镜像由多个不同的部分组成，比如os、软件等，组成越复杂，其攻击面、可利用的可能性越大。因此我们要尽量精简化，如使用最小化的OS，目的是降低攻击面。</p></li>
<li><p>已知软件漏洞（Known Software Vulnerabilities）：</p>
<blockquote>
<p>Due to their extensive use of third-party packages, many container
images are inherently dangerous to pull into a trusted environment and
run. For example, if a given layer in an image contains a version of
OpenSSL that is susceptible to a known exploit it may be propagated to
several workloads and unknowingly put an entire cluster at risk.</p>
</blockquote>
<p>即镜像中使用了有漏洞的第三方包，比如OpenSSL有问题等。已经有了一些扫描容器镜像的工具如<a
target="_blank" rel="noopener" href="https://github.com/coreos/clair">Clair</a> and <a
target="_blank" rel="noopener" href="https://github.com/aquasecurity/trivy">trivy</a></p></li>
</ul>
<h3
id="对应k8s-goat场景attacking-private-registry">对应k8s-goat场景：Attacking
private registry</h3>
<p>下图为官方的攻击场景示意图，初步判断该攻击是对该容器所依赖的上游镜像进行了篡改。</p>
<blockquote>
<p>该攻击方法从战术上属于<code>Initial Access</code>，技术上属于<code>Compromised image in registry</code>。</p>
</blockquote>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/scenario-7-fbcf2b81257e7185ddfa569b9089e34d-1695046803656-11.png" /></p>
<p>下面正式分析，首先访问对应端口：</p>
<figure>
<img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230918222854330.png"
alt="image-20230918222854330" />
<figcaption aria-hidden="true">image-20230918222854330</figcaption>
</figure>
<p>这个应用对应的是<code>poor-registry</code>，根据场景介绍，我们的目标是寻找一个<code>k8s-goat-</code>开头的flag。</p>
<h3 id="预备知识关于docker-registry">预备知识：关于docker registry</h3>
<p>docker
registry是用来存放docker镜像的地方，有公开的，也有私有的。公开的如<a
target="_blank" rel="noopener" href="https://hub.docker.com/">Docker
Hub</a>，私人的比如阿里云控制台可以管理的个人实例。还是那个图，最右侧就是docker
registry服务：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/architecture-1695038714046-4.svg" /></p>
<p>对于私有的镜像，我们也可以自己搭建一个私有的registry服务，通常运行在5000端口上。搭建完成后我们就可以通过<code>pull</code>、<code>push</code>等命令管理该registry上的私有镜像。</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230919103226887.png" /></p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230919103344035.png" /></p>
<p>此外，该服务提供了docekr服务端提供的RESTful风格的接口，使用方法官方文档：<a
target="_blank" rel="noopener" href="https://docs.docker.com/registry/spec/api/">HTTP API V2 | Docker
Docs</a>。</p>
<h3 id="利用-1">利用</h3>
<p>打开页面，我们访问<code>/v2</code>，返回200则说明是支持v2版本的API的：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230919104909189.png" /></p>
<p>我们可以利用API接口列出所有镜像：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230919104855799.png" /></p>
<p>我们分别读取这两个镜像的<code>manifest</code>文件以收集信息：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230919105703471.png" /></p>
<p>没什么特别的信息，查看另一个： <img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230919110020593.png" /></p>
<p>可以看到有<code>API_KEY</code>信息，即题目的flag。</p>
<h3 id="问题原因-1">问题原因</h3>
<p>由于该私有镜像源是开放的，因而我们可以列举已有镜像的信息，从而获得一些隐私信息，如配置过程中的KEY、软件版本等等。此外，我们也可以上传一个同名的镜像以实现供应链攻击。因此我们也要保护私有镜像源的安全性，防止供应链攻击。</p>
<h3 id="参考学习-1">参考学习</h3>
<ul>
<li><a
target="_blank" rel="noopener" href="https://madhuakula.com/kubernetes-goat/docs/scenarios/scenario-7/attacking-private-container-registry-in-kubernetes/welcome/">⎈
Attacking private registry | Kubernetes Goat (madhuakula.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/registry/spec/api/">HTTP API V2 |
Docker Docs</a></li>
<li><a
target="_blank" rel="noopener" href="https://owasp.org/www-project-kubernetes-top-ten/2022/en/src/K02-supply-chain-vulnerabilities">K02:
Supply Chain Vulnerabilities | OWASP Foundation</a></li>
</ul>
<h2 id="k03-overly-permissive-rbac">K03: Overly Permissive RBAC</h2>
<h3 id="定义-2">定义</h3>
<p>其实就是过度授权，老生常谈的问题只不过是新的场景——K8S中的RBAC（Role-Based
Access Control
）。K8S将资源（Pod、Service、Nodes等）和动作（get、create、delete等）绑定起来，并划分得到不同的角色身份，以此来控制权限。</p>
<blockquote>
<p>Configuring RBAC with least privilege enforcement is a challenge for
reasons we will explore below.</p>
</blockquote>
<p>那这件事困难吗？从OWASP给的解释来看，我认为困难点在于资源数量的庞大因而导致了配置的困难：</p>
<blockquote>
<p>RBAC is an extremely powerful security enforcement mechanism in
Kubernetes when appropriately configured but can quickly become a
massive risk to the cluster and increase the blast radius in the event
of a compromise.</p>
</blockquote>
<p>为了了解这部分内容，首先需要了解K8S中的RBAC。K8S的RBAC定义了四种对象：</p>
<ul>
<li>Role</li>
<li>ClusterRole</li>
<li>RoleBinding</li>
<li>ClusterRoleBinding</li>
</ul>
<p>其中，前两个<code>xxxRole</code>包含了<strong>“允许”</strong>执行的操作内容（可以理解为“操作白名单”）。区别从名字大概也能判断出来：</p>
<ul>
<li><code>Role</code>必须定义在一个<code>Namespace</code>中，而<code>ClusterRole</code>则在整个集群中通用，因而不属于任何<code>Namespace</code>。</li>
<li><code>ClusterRole</code>可以用于定义对Namespace资源（如Pods）、集群范围资源（如Node）、endpoint（如HTTP
API接口）的权限，并授予其他单个命名空间和跨命名空间的访问权限；而<code>Role</code>则只作用于单个<code>Namespace</code>。</li>
</ul>
<p>如下是官方给的<code>Role</code>和<code>ClusterRole</code>例子：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span>	<span class="comment"># 定义了一个可以访问Pods信息的Role角色</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-reader</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>] <span class="comment"># &quot;&quot; indicates the core API group</span></span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span>	<span class="comment"># 定义了一个可以访问`secrets`的ClusterRole角色</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="comment"># &quot;namespace&quot; omitted since ClusterRoles are not namespaced</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">secret-reader</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># at the HTTP level, the name of the resource for accessing Secret</span></span><br><span class="line">  <span class="comment"># objects is &quot;secrets&quot;</span></span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;secrets&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]</span><br></pre></td></tr></table></figure>
<p>有了两个身份后，我们还有<code>RoleBinding</code>和<code>ClusterRoleBinding</code>可以基于前述两个身份对象，绑定到一个或多个用户，这样他们就拥有了对应的权限。二者区别在于前者用于授权一个<code>Namespace</code>范畴的权限，而后者可以授权整个集群范围内的。</p>
<p>官方也给出了例子：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="comment"># This role binding allows &quot;jane&quot; to read pods in the &quot;default&quot; namespace.</span></span><br><span class="line"><span class="comment"># You need to already have a Role named &quot;pod-reader&quot; in that namespace.</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">read-pods</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="comment"># You can specify more than one &quot;subject&quot;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jane</span> <span class="comment"># &quot;name&quot; is case sensitive</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="comment"># &quot;roleRef&quot; specifies the binding to a Role / ClusterRole</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span> <span class="comment">#this must be Role or ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-reader</span> <span class="comment"># this must match the name of the Role or ClusterRole you wish to bind to</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line"># This cluster role binding allows anyone in the &quot;manager&quot; group to read secrets in any namespace.</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: read-secrets-global</span><br><span class="line">subjects:</span><br><span class="line">- kind: Group</span><br><span class="line">  name: manager # Name is case sensitive</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">roleRef:</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: secret-reader</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br></pre></td></tr></table></figure>
<p>回到问题本身。具体地，官方也给出了三个错误的案例：</p>
<ul>
<li><p>不必要的最高权限<code>cluster-admin</code>（Unnecessary use of
cluster-admin）</p>
<p>如下，将默认的最高权限用户<code>cluster-admin</code>的<code>ClusterRole</code>身份以<code>ClusterRoleBinding</code>的方式授权给了默认命名空间内的所有资源。假设一个default空间内的pod被攻陷了，那么将直接拥有集群最高的权限。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"> <span class="attr">name:</span> <span class="string">redacted-rbac</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">   <span class="attr">name:</span> <span class="string">default</span></span><br><span class="line">   <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line"> <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"> <span class="attr">name:</span> <span class="string">cluster-admin</span></span><br><span class="line"> <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure></li>
<li><p>不必要的<code>LIST</code>权限（Unnecessary use of LIST
permission）</p>
<p>官方在官网中给了一段场景示例，关键部分：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl create serviceaccount only-list-secrets-sa</span><br><span class="line">kubectl create role only-list-secrets-role --verb=list --resource=secrets</span><br><span class="line">kubectl create rolebinding only-list-secrets-default-ns \</span><br><span class="line">  --role=only-list-secrets-role --serviceaccount=default:only-list-secrets-sa</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建一个秘密</span></span><br><span class="line">kubectl create secret generic abc --from-literal=secretAuthToken=verySecure123</span><br></pre></td></tr></table></figure>
<p>首先创建了一个服务账户<code>only-list-secrets-sa</code>并创建了包含<code>LIST</code>权限的<code>only-list-secrets-role</code>，然后创建了名为<code>noly-olist-secrest-default-ns</code>的<code>rolebingding</code>将<code>only-list-secrets-role</code>授予了默认命名空间内的服务账户<code>only-list-secrets-sa</code>。</p>
<p>由于该服务账户没有<code>GET</code>权限，因此可以验证无法读取秘密：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230920121608994.png" /></p>
<p>然而由于<code>LIST</code>权限的存在，使得可以列出所有的信息：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230920121644503.png" /></p>
<p>由于创建<code>Role</code>时候增加了<code>list</code>权限，从而导致攻击者可以利用该权限列出对应命名空间内所有数据：</p>
<blockquote>
<p>Accounts with <code>LIST</code> permission cannot get a specific item
from the API, but will get all of them in full when they list.</p>
</blockquote></li>
<li><p>不必要的<code>WATCH</code>权限（Unnecessary use of WATCH
permission）</p>
<p>和<code>LIST</code>类似，<code>WATCH</code>也可以查看所有数据：</p>
<blockquote>
<p>kubectl create role only-watch-secrets-role --verb=watch
--resource=secrets</p>
</blockquote></li>
</ul>
<h3
id="对应k8s-goat场景rbac-least-privileges-misconfiguration">对应k8s-goat场景：RBAC
least privileges misconfiguration</h3>
<blockquote>
<p>该攻击方法从战术上属于<code>Credential Access</code>，技术上包含<code>List K8S secrets</code>和<code>Container service account</code>。</p>
</blockquote>
<p>下面正式分析，首先访问对应端口：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230920154727364.png" /></p>
<p>是一个网页版的shell，对应命名空间<code>big-monolith</code>下的应用<code>hunger-check</code>。根据场景介绍，我们的目标是获取<code>k8s_goat_flag</code>，其位于<code>k8svaultapikey</code>中。</p>
<h3 id="预备知识">预备知识</h3>
<p>对于k8s环境中存在的pod，我们怎么从pod内部使用到k8s的API呢？官方提供了四种方式。</p>
<ul>
<li><p>使用官方的k8s客户端：类似DIND，可以下载使用官方的k8s客户端。</p></li>
<li><p>直接访问RESTful API：</p>
<ul>
<li><p>环境变量中存在<code>KUBERNETES_SERVICE_HOST</code>和<code>KUBERNETES_SERVICE_PORT_HTTPS</code>。且k8s也在集群中部署了名为<code>kubernetes</code>的服务，提供<code>kubernetes.default.svc</code>到API服务器的域名解析服务。</p></li>
<li><p>官方推荐使用<code>ServiceAccount</code>来认证使用API，如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义ServiceAccount</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">build-robot</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用ServiceAccont定义pod</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">serviceAccountName:</span> <span class="string">build-robot</span></span><br></pre></td></tr></table></figure>
<p>若以这种方式，则k8s会在pod中创建：</p>
<ul>
<li><code>/var/run/secrets/kubernetes.io/serviceaccount/token</code>：认证token</li>
<li><code>/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</code>：证书</li>
<li><code>/var/run/secrets/kubernetes.io/serviceaccount/namespace</code>：使用API时默认的namespace</li>
</ul>
<p>这种情况下，pod内容器就可以使用配置文件定义好的<code>ServiceAccount</code>权限去访问<code>kubernetes.default.svc</code>了。</p></li>
</ul></li>
<li><p>使用kubectl proxy：使用该命令开启一个sidecar模式的pod，kubectl
proxy在pod内开启一个监听端口并负责与API服务器进行认证，因而该pod内的所有容器就可以通过该端口访问API服务了</p></li>
<li><p>直接传递认证token：和第二种有点类似，只不过我们是手动传递的token，一个简单脚本如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置API服务器的域名，域名解析会由kubernets服务执行</span></span><br><span class="line">APISERVER=https://kubernetes.default.svc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置ServiceAccount文件的路径</span></span><br><span class="line">SERVICEACCOUNT=/var/run/secrets/kubernetes.io/serviceaccount</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取Pod的namespace、token、证书</span></span><br><span class="line">NAMESPACE=$(cat $&#123;SERVICEACCOUNT&#125;/namespace)</span><br><span class="line">TOKEN=$(cat $&#123;SERVICEACCOUNT&#125;/token)</span><br><span class="line">CACERT=$&#123;SERVICEACCOUNT&#125;/ca.crt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">访问api</span></span><br><span class="line">curl --cacert $&#123;CACERT&#125; --header &quot;Authorization: Bearer $&#123;TOKEN&#125;&quot; -X GET $&#123;APISERVER&#125;/api</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="利用-2">利用</h3>
<p>那先找k8s
api的服务器地址嘛，不然怎么用API。从环境变量中可以看到：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230920154850178.png" /></p>
<p>好，可以用，但是我们怎么知道这个pod对应的服务账号呢？这里选用前述预备知识中<strong>直接传递认证token</strong>的方式。进入<code>/var/run/</code>目录可以看到一个<code>secrets</code>目录，其下就是token、证书和默认namespace了：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230920154914501.png" /></p>
<p>然后我们基于这三个内容以及前面环境变量中看到的地址来访问API：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230920155154243.png" /></p>
<p>可以看到访问成功，<code>curl --cacert $&#123;CACRT&#125; --header "Authorization: Bearer $&#123;TOKEN&#125;" -X GET $&#123;APISERVER&#125;/api/v1</code>查看有哪些资源：</p>
<p><img src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230920153859379.png" style="zoom:60%;" /></p>
<p>可以找到一个叫<code>secrets</code>的资源，尝试访问<code>curl --cacert $&#123;CACRT&#125; --header "Authorization: Bearer $&#123;TOKEN&#125;" -X GET $&#123;APISERVER&#125;/api/v1/secrets</code>：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230920155612132.png" /></p>
<p>不能直接访问，但发现该资源拥有list和watch权限，那么就想到了利用list或watch的方法来读取全部信息，这里使用list。<strong>在v1后加上命名空间的路径，即v1/namespace/${NAMESPACE}/secrets</strong>：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230920155724794.png" /></p>
<p><strong>可以看到，我们虽然没有权限访问secrets下的某个条目，但是我们可以利用LIST直接把所有信息都列举出来</strong>，最后找到题目所需关键字并解码：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230920160129910.png" /></p>
<blockquote>
<p>更多k8s RESTful API的使用：<a
target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/kubernetes-api/">Kubernetes
API | Kubernetes</a></p>
</blockquote>
<h3 id="问题原因-2">问题原因</h3>
<p>去看一下配置文件：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230920160901020.png" /></p>
<h3 id="参考学习-2">参考学习</h3>
<ul>
<li><a
target="_blank" rel="noopener" href="https://madhuakula.com/kubernetes-goat/docs/scenarios/scenario-16/rbac-least-privileges-misconfiguration-in-kubernetes-cluster/welcome">⎈
RBAC least privileges misconfiguration | Kubernetes Goat
(madhuakula.com)</a></li>
<li><a
target="_blank" rel="noopener" href="https://owasp.org/www-project-kubernetes-top-ten/2022/en/src/K03-overly-permissive-rbac">K03:
Overly Permissive RBAC | OWASP Foundation</a></li>
<li><a
target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">Using
RBAC Authorization | Kubernetes</a></li>
<li><a
target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/security/rbac-good-practices/">Role
Based Access Control Good Practices | Kubernetes</a></li>
<li><a
target="_blank" rel="noopener" href="https://kubernetes.io/docs/tasks/run-application/access-api-from-pod/">Accessing
the Kubernetes API from a Pod | Kubernetes</a></li>
<li><a
target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/kubernetes-api/">Kubernetes
API | Kubernetes</a></li>
</ul>
<h2 id="k04-lack-of-centralized-policy-enforcement">K04: Lack of
Centralized Policy Enforcement</h2>
<h3 id="定义-3">定义</h3>
<p>由于安全策略的管理位于一个中心实体，因而难以在资源数量（<strong>k8s集群、云服务器</strong>）过于庞大的情况下、分发和强制性执行安全策略。</p>
<p>针对上述问题，<strong>k8s策略强制实施机制（Kubernetes policy
enforcement）</strong>可以通过少量的配置就实现在多个集群、多个云的基础设施上实现：管理（governance）、实施（compliance）和安全配置（security
requireents）。</p>
<p>如下是一个来自<code>gatekeeper</code>的<strong>拒绝来自不可信的镜像源的镜像的配置文件：</strong>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Allowed repos</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">constraints.gatekeeper.sh/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">K8sAllowedRepos</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">allowed-repos</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">match:</span></span><br><span class="line">    <span class="attr">kinds:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">        <span class="attr">kinds:</span> [<span class="string">&quot;Pod&quot;</span>]</span><br><span class="line">    <span class="attr">namespaces:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;sbx&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;prd&quot;</span></span><br><span class="line">  <span class="attr">parameters:</span></span><br><span class="line">    <span class="attr">repos:</span>	<span class="comment"># 只允许来自如下两个镜像源的镜像</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;open-policy-agent&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ubuntu&quot;</span></span><br></pre></td></tr></table></figure></p>
<p>此外，这类配置资源方案（其他的如Kyverno、Kubewarden等）还可以确保<strong>已经发生错误配置的pod不会被集群继续调度产生。</strong>比如Deployment。</p>
<h3
id="对应k8s-goat场景securing-kubernetes-clusters-using-kyverno-policy-engine">对应k8s-goat场景：Securing
Kubernetes Clusters using Kyverno Policy Engine</h3>
<p>下图为官方的攻击场景示意图，初步判断该通过名为<code>Kyverno</code>的策略引擎抵挡了攻击者对<code>valut</code>命名空间内的pod的命令执行请求。</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/scenario-22-1d2c06a0672c48504caadc55568323d4.png" /></p>
<h3 id="预备知识-1">预备知识</h3>
<p>首先需要了解什么是k8s中的准入控制器——<em>dynamic admission
controller:</em></p>
<blockquote>
<p><em>An admission controller is a piece of code that intercepts
requests to the Kubernetes API server prior to persistence of the
object, but after the request is authenticated and authorized.</em>——<a
target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/">Admission
Controllers Reference | Kubernetes</a></p>
</blockquote>
<p>等于是一个拦截请求并对其进行认证的拦截器，可以拦截的请求动作包括：</p>
<ul>
<li>create、delete、modify或其他自定义的动词（如通过kube
proxy连接pod）</li>
</ul>
<p>但也包括一些不能够拦截的动作：</p>
<ul>
<li>get、watch、list</li>
</ul>
<p>其具体的动作包括：</p>
<ul>
<li>validating：<strong>并行</strong>调用所有的验证的webhook，只要有一个不通过就不通过</li>
<li>mutating：<strong>串行</strong>调用所有修改的webhook，挨个修改该请求</li>
<li>both：混合前两者</li>
</ul>
<blockquote>
<p>关于Kyverno（希腊语，意味<code>Govern</code>） —— Kyverno is a policy
engine designed for Kubernetes.</p>
<p>Github: <a target="_blank" rel="noopener" href="https://github.com/kyverno/kyverno">kyverno/kyverno:
Kubernetes Native Policy Management (github.com)</a></p>
</blockquote>
<p>而Kyverno可以作为k8s集群的<strong>动态准入控制器</strong>（<em>dynamic
admission controller</em>），可以通过Helm包管理器进行安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加chart源</span></span><br><span class="line">helm repo add kyverno https://kyverno.github.io/kyverno/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新并安装</span></span><br><span class="line">helm repo update</span><br><span class="line">helm install kyverno kyverno/kyverno -n kyverno --create-namespace</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果要卸载也很简单</span></span><br><span class="line">helm uninstall kyverno kyverno/kyverno -n kyverno</span><br></pre></td></tr></table></figure>
<p>安装结果：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230922201052379.png" /></p>
<p>安装结束后，就可以通过编写<code>yaml</code>的格式来定义策略了。官方有详尽的指南：<a
target="_blank" rel="noopener" href="https://kyverno.io/docs/kyverno-policies/">Policies and Rules |
Kyverno</a>。Kyverno可以定义集群范围的策略<code>ClusterPolicy</code>或指定命名空间内的策略<code>Policy</code>，而具体的结构可以用下面的一张图来概括：</p>
<p><img src="/img/K8s攻防之OWASP-K8S-TOP10（上）/Kyverno-Policy-Structure.png" style="zoom:60%;" /></p>
<h3 id="使用">使用</h3>
<p>这里主要学习如何编写Kyverno策略配置文件，禁止用户使用exec命令进入指定容器。</p>
<blockquote>
<p>kubectl apply -f
https://raw.githubusercontent.com/madhuakula/kubernetes-goat/master/scenarios/kyverno-namespace-exec-block/kyverno-block-pod-exec-by-namespace.yaml</p>
</blockquote>
<p>文件内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: kyverno.io/v1</span><br><span class="line">kind: ClusterPolicy</span><br><span class="line">metadata:</span><br><span class="line">  name: deny-exec-in-vault-namespace</span><br><span class="line">  annotations:</span><br><span class="line">    policies.kyverno.io/title: Block Pod Exec in Vault Namespace</span><br><span class="line">    policies.kyverno.io/category: Sample</span><br><span class="line">    policies.kyverno.io/minversion: 1.6.0</span><br><span class="line">    policies.kyverno.io/subject: Pod</span><br><span class="line">    policies.kyverno.io/description: &gt;-</span><br><span class="line">      The `exec` command may be used to gain shell access, or run other commands, in a Pod&#x27;s container. While this can be useful for troubleshooting purposes, it could represent an attack vector and is discouraged to use in the `vault` namespace. This policy blocks Pod exec commands to Pods in a Namespace called `vault`.</span><br><span class="line">spec:</span><br><span class="line">  validationFailureAction: Enforce</span><br><span class="line">  background: false</span><br><span class="line">  rules:</span><br><span class="line">  - name: deny-exec-ns-vault</span><br><span class="line">    match:	# 定义匹配规则</span><br><span class="line">      any:</span><br><span class="line">      - resources:</span><br><span class="line">          kinds:</span><br><span class="line">          - Pod/exec</span><br><span class="line">    preconditions:</span><br><span class="line">      all:</span><br><span class="line">      - key: &quot;&#123;&#123; request.operation || &#x27;BACKGROUND&#x27; &#125;&#125;&quot;</span><br><span class="line">        operator: Equals</span><br><span class="line">        value: CONNECT</span><br><span class="line">    validate:</span><br><span class="line">      message: 🚨 Pods in vault namespace should not be exec&#x27;d into. It has Kubernetes Goat 🐐 secrets 🔥</span><br><span class="line">      deny:	# 拒绝策略</span><br><span class="line">        conditions:</span><br><span class="line">          any:</span><br><span class="line">          - key: &quot;&#123;&#123; request.namespace &#125;&#125;&quot;</span><br><span class="line">            operator: Equals</span><br><span class="line">            value: vault</span><br></pre></td></tr></table></figure>
<p>此时我们访问就会拒绝了：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20230924141030991.png" /></p>
<blockquote>
<p>此外，Kyverno官方也提供了很多这样的策略例子供我们选择，<a
target="_blank" rel="noopener" href="https://kyverno.io/policies/">Policies | Kyverno</a></p>
</blockquote>
<h3 id="参考学习-3">参考学习</h3>
<ul>
<li><a
target="_blank" rel="noopener" href="https://madhuakula.com/kubernetes-goat/docs/scenarios/scenario-22/securing-kubernetes-clusters-using-kyverno-policy-engine/welcome">⎈
Securing Kubernetes Clusters using Kyverno Policy Engine | Kubernetes
Goat (madhuakula.com)</a></li>
<li><a
target="_blank" rel="noopener" href="https://owasp.org/www-project-kubernetes-top-ten/2022/en/src/K04-policy-enforcement">K04:
Policy Enforcement | OWASP Foundation</a></li>
<li><a target="_blank" rel="noopener" href="https://kyverno.io/policies/">Policies | Kyverno</a></li>
</ul>
<h2 id="k05-inadequate-logging-and-monitoring">K05: Inadequate Logging
and Monitoring</h2>
<h3 id="定义-4">定义</h3>
<p>这部分也是工具的学习。在k8s中，一些事件默认是不会出现在日志中或者被监控，包括：</p>
<ul>
<li>认证失败、敏感资源访问、手动删除或修改k8s资源</li>
<li>运行中负载的日志</li>
</ul>
<p>此外，没有开启日志记录、日志有没有被集中存储且是否可以实现防篡改、报警阈值设置是否合理。上述情况或问题都可能会导致攻击者的行径没有被记录下来，从而对溯源造成了困难。因此OWASP建议如下类型日志都应开启并合理配置：</p>
<ul>
<li>k8s审计日志：记录API调用</li>
<li>k8s事件：记录资源状态的更改和错误</li>
<li>应用&amp;容器日志：容器内部运行的应用程序自行记录应用程序的日志</li>
<li>操作系统日志：如<code>journalctl</code>命令</li>
<li>云提供商日志</li>
<li>网络日志</li>
</ul>
<h3
id="对应k8s-goat场景cilium-tetragon---ebpf-based-security-observability-and-runtime-enforcement">对应k8s-goat场景：Cilium
Tetragon - eBPF-based Security Observability and Runtime
Enforcement</h3>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/scenario-21-f6224cb07df8c572137cd371e26c1d42.png" /></p>
<h3 id="使用-1">使用</h3>
<blockquote>
<p>Tetragon是一个基于eBPF技术的运行时安全检测组件，具有如下特点：</p>
<ul>
<li>实时性：Tetragon is a runtime security enforcement and observability
tool. What this means is Tetragon applies policy and filtering directly
in eBPF in the kernel.</li>
<li>灵活性：Tetragon can hook into any function in the Linux kernel and
filter on its arguments, return value, associated metadata that Tetragon
collects about processes (e.g., executable names), files, and other
properties.</li>
<li>内核信息可读：Tetragon, through eBPF, has access to the Linux kernel
state.</li>
</ul>
</blockquote>
<p>安装依然直接使用helm安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加软件源</span></span><br><span class="line">helm repo add cilium https://helm.cilium.io</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新并安装</span></span><br><span class="line">helm repo update &amp;&amp; helm install tetragon cilium/tetragon -n kube-system</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查tetragon的pod状态</span></span><br><span class="line">kubectl rollout status -n kube-system ds/tetragon -w</span><br></pre></td></tr></table></figure>
<p>安装结果：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/image-20231002190521896.png" /></p>
<p>具体Tetragon的使用方法、原理这里不做赘述，官方文档：<a
target="_blank" rel="noopener" href="https://tetragon.cilium.io/docs/overview/">Overview | Tetragon
(cilium.io)</a>。下图为Tetragon架构示意图：</p>
<p><img
src="/img/K8s攻防之OWASP-K8S-TOP10（上）/smart_observability.png" /></p>
<h3 id="参考学习-4">参考学习</h3>
<ul>
<li><a
target="_blank" rel="noopener" href="https://madhuakula.com/kubernetes-goat/docs/scenarios/scenario-21/ebpf-runtime-security-monitoring-and-detection-in-kubernetes-cluster-using-cilium-tetragon/welcome">⎈
Cilium Tetragon - eBPF-based Security Observability and Runtime
Enforcement | Kubernetes Goat (madhuakula.com)</a></li>
<li><a
target="_blank" rel="noopener" href="https://owasp.org/www-project-kubernetes-top-ten/2022/en/src/K05-inadequate-logging">K05:
Inadequate Logging | OWASP Foundation</a></li>
<li><a target="_blank" rel="noopener" href="https://tetragon.cilium.io/docs/overview/">Overview |
Tetragon (cilium.io)</a></li>
</ul>

    </article>
    <!-- license -->
        <div class="license-wrapper">
            <p>原文作者：<a href="https://lzwgiter.github.io">f10@t</a>
            <p>原文链接：<a href="https://lzwgiter.github.io/posts/8aa36aba.html">https://lzwgiter.github.io/posts/8aa36aba.html</a>
            <p>发表日期：<a href="https://lzwgiter.github.io/posts/8aa36aba.html">September 16th 2023, 3:25:21 pm</a>
            <p>更新日期：<a href="https://lzwgiter.github.io/posts/8aa36aba.html">July 24th 2024, 10:41:57 am</a>
            <p>版权声明：本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    <!-- paginator -->
    <ul class="post-paginator">
        <li class="next">
                <div class="nextSlogan">Next Post</div>
                <a href="/posts/85bf5302.html" title="K8s攻防之OWASP-K8S-TOP10（下）">
                    <div class="nextTitle">K8s攻防之OWASP-K8S-TOP10（下）</div>
                </a>
        </li>
        <li class="previous">
                <div class="prevSlogan">Previous Post</div>
                <a href="/posts/c16d1cd9.html" title="Java内存马原理（一）">
                    <div class="prevTitle">Java内存马原理（一）</div>
                </a>
        </li>
    </ul>
    <!-- comment -->
        <div class="post-comment">
            <!-- 来必力 City 版安装代码 -->

            
            
            
            <!-- utteranc评论 -->

            <!-- partial('_partial/comment/changyan') -->
            <!--PC版-->

            
                <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <div id="comment"></div>
    <script>
        new Valine({
            el: '#comment',
            notify:false,
            verify:false,
            appId: "KADRlHg5xXyhKL0d6USDWfIB-gzGzoHsz",
            appKey: "Ppj8kIdro2yDqXOvqWkTRxuW",
            placeholder: "递茶就坐(　o=^•ェ•)o　┏━┓",
            path:window.location.pathname,
            avatar:'mm'
        });
    </script>

            
        </div>
    <!-- timeliness note -->
    <!-- idea from: https://hexo.fluid-dev.com/posts/hexo-injector/#%E6%96%87%E7%AB%A0%E6%97%B6%E6%95%88%E6%80%A7%E6%8F%90%E7%A4%BA -->
    <!-- Mathjax -->
</main>

                <!-- profile -->
            </div>
            <footer class="footer footer-unloaded">
    <!-- social  -->
        <div class="social">
                            <a href="//github.com/lzwgiter" class="iconfont-archer github" target="_blank" title="github"></a>

        </div>
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- website approve for Chinese user -->
    <!-- 不蒜子  -->
        <div class="busuanzi-container">
                <span id="busuanzi_container_site_uv">做客的小伙伴数: <span id="busuanzi_value_site_uv"></span></span>
        </div>
</footer>

        </div>
        <!-- toc -->
            <div class="toc-wrapper toc-wrapper-loding" style=    top:50vh;
>
                <div class="toc-catalog">
                    <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
                </div>
                <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#k8s%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.</span> <span class="toc-text">K8S环境准备</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#kubernetes-goat%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">2.</span> <span class="toc-text">Kubernetes goat环境搭建</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#owasp-kubernets-top-10"><span class="toc-number">3.</span> <span class="toc-text">OWASP Kubernets Top 10</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#k01-insecure-workload-configurations"><span class="toc-number">3.1.</span> <span class="toc-text">K01: Insecure Workload
Configurations</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89"><span class="toc-number">3.1.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E5%BA%94k8s-goat%E5%9C%BA%E6%99%AFdind-docker-in-docker-exploitation"><span class="toc-number">3.1.2.</span> <span class="toc-text">对应k8s-goat场景：DIND
(docker-in-docker) exploitation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86%E5%85%B3%E4%BA%8Edocker.sock"><span class="toc-number">3.1.3.</span> <span class="toc-text">预备知识：关于docker.sock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8"><span class="toc-number">3.1.4.</span> <span class="toc-text">利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%8E%9F%E5%9B%A0"><span class="toc-number">3.1.5.</span> <span class="toc-text">问题原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E5%AD%A6%E4%B9%A0"><span class="toc-number">3.1.6.</span> <span class="toc-text">参考学习</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#k02-supply-chain-vulnerabilities"><span class="toc-number">3.2.</span> <span class="toc-text">K02: Supply Chain
Vulnerabilities</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-1"><span class="toc-number">3.2.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E5%BA%94k8s-goat%E5%9C%BA%E6%99%AFattacking-private-registry"><span class="toc-number">3.2.2.</span> <span class="toc-text">对应k8s-goat场景：Attacking
private registry</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86%E5%85%B3%E4%BA%8Edocker-registry"><span class="toc-number">3.2.3.</span> <span class="toc-text">预备知识：关于docker registry</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-1"><span class="toc-number">3.2.4.</span> <span class="toc-text">利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%8E%9F%E5%9B%A0-1"><span class="toc-number">3.2.5.</span> <span class="toc-text">问题原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E5%AD%A6%E4%B9%A0-1"><span class="toc-number">3.2.6.</span> <span class="toc-text">参考学习</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#k03-overly-permissive-rbac"><span class="toc-number">3.3.</span> <span class="toc-text">K03: Overly Permissive RBAC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-2"><span class="toc-number">3.3.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E5%BA%94k8s-goat%E5%9C%BA%E6%99%AFrbac-least-privileges-misconfiguration"><span class="toc-number">3.3.2.</span> <span class="toc-text">对应k8s-goat场景：RBAC
least privileges misconfiguration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86"><span class="toc-number">3.3.3.</span> <span class="toc-text">预备知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-2"><span class="toc-number">3.3.4.</span> <span class="toc-text">利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%8E%9F%E5%9B%A0-2"><span class="toc-number">3.3.5.</span> <span class="toc-text">问题原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E5%AD%A6%E4%B9%A0-2"><span class="toc-number">3.3.6.</span> <span class="toc-text">参考学习</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#k04-lack-of-centralized-policy-enforcement"><span class="toc-number">3.4.</span> <span class="toc-text">K04: Lack of
Centralized Policy Enforcement</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-3"><span class="toc-number">3.4.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E5%BA%94k8s-goat%E5%9C%BA%E6%99%AFsecuring-kubernetes-clusters-using-kyverno-policy-engine"><span class="toc-number">3.4.2.</span> <span class="toc-text">对应k8s-goat场景：Securing
Kubernetes Clusters using Kyverno Policy Engine</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86-1"><span class="toc-number">3.4.3.</span> <span class="toc-text">预备知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">3.4.4.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E5%AD%A6%E4%B9%A0-3"><span class="toc-number">3.4.5.</span> <span class="toc-text">参考学习</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#k05-inadequate-logging-and-monitoring"><span class="toc-number">3.5.</span> <span class="toc-text">K05: Inadequate Logging
and Monitoring</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-4"><span class="toc-number">3.5.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E5%BA%94k8s-goat%E5%9C%BA%E6%99%AFcilium-tetragon---ebpf-based-security-observability-and-runtime-enforcement"><span class="toc-number">3.5.2.</span> <span class="toc-text">对应k8s-goat场景：Cilium
Tetragon - eBPF-based Security Observability and Runtime
Enforcement</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-1"><span class="toc-number">3.5.3.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E5%AD%A6%E4%B9%A0-4"><span class="toc-number">3.5.4.</span> <span class="toc-text">参考学习</span></a></li></ol></li></ol></li></ol>
            </div>
        <!-- sidebar -->
        <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
        <div class="sidebar-panel-archives">
    <!-- 在 ejs 中将 archive 按照时间排序 -->
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    <div class="total-and-search">
        <div class="total-archive">
        Total : 98
        </div>
        <!-- search  -->
            <div class="site-search site-search-loading popup-trigger">
                <span class="iconfont-archer search-icon">&#xe627;</span>
            </div>
    </div>
    <div class="post-archive">
            <div class="archive-year"> 2024 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">04/23</span>
            <a class="archive-post-title" href="/posts/963fb8d3.html">领域驱动设计学习（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/06</span>
            <a class="archive-post-title" href="/posts/21f893eb.html">学鲁菜之酱焖鲈鱼</a>
        </li>
                </ul>
            <div class="archive-year"> 2023 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">10/22</span>
            <a class="archive-post-title" href="/posts/33ea2108.html">Spring AOP再探</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/09</span>
            <a class="archive-post-title" href="/posts/c41813ec.html">重新审视微服务</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/04</span>
            <a class="archive-post-title" href="/posts/85bf5302.html">K8s攻防之OWASP-K8S-TOP10（下）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/16</span>
            <a class="archive-post-title" href="/posts/8aa36aba.html">K8s攻防之OWASP-K8S-TOP10（上）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/08</span>
            <a class="archive-post-title" href="/posts/c16d1cd9.html">Java内存马原理（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/08</span>
            <a class="archive-post-title" href="/posts/e2947908.html">Java Instrument机制及管窥IAST</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/03</span>
            <a class="archive-post-title" href="/posts/479daa6d.html">gRPC简介与使用</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/30</span>
            <a class="archive-post-title" href="/posts/b74b8800.html">fastjson反序列化漏洞学习（二）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/07</span>
            <a class="archive-post-title" href="/posts/73d00ee7.html">Netty框架学习</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/04</span>
            <a class="archive-post-title" href="/posts/d6b305b7.html">Java网络编程模型复习</a>
        </li>
                </ul>
            <div class="archive-year"> 2022 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">04/26</span>
            <a class="archive-post-title" href="/posts/203767b8.html">python-Numpy库使用</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/20</span>
            <a class="archive-post-title" href="/posts/f06096b.html">MATLAB - Wireless Communication Onramp</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/19</span>
            <a class="archive-post-title" href="/posts/3041f265.html">Matlab编程基础</a>
        </li>
                </ul>
            <div class="archive-year"> 2021 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">10/04</span>
            <a class="archive-post-title" href="/posts/169c63d0.html">Bloom Filter概念原理</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/25</span>
            <a class="archive-post-title" href="/posts/85e98ef0.html">zk-SNARKs简洁的非交互式零知识证明学习(一)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/22</span>
            <a class="archive-post-title" href="/posts/a8e0eb2d.html">Quarkus学习（一）概述以及编写REST服务</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/19</span>
            <a class="archive-post-title" href="/posts/e88577c0.html">Cloud Programming Simplified:A Berkeley View on Serverless Computing</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/18</span>
            <a class="archive-post-title" href="/posts/99665dc1.html">闲聊一下Java中的DI和CDI</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/12</span>
            <a class="archive-post-title" href="/posts/ed901271.html">Kubernetes-集群环境搭建使用及问题记录（三）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/09</span>
            <a class="archive-post-title" href="/posts/a08eb123.html">Kubernetes-集群环境搭建使用及问题记录（二）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/03</span>
            <a class="archive-post-title" href="/posts/eed4a979.html">Kubernetes 集群环境搭建使用及问题记录（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/24</span>
            <a class="archive-post-title" href="/posts/2f0b60dd.html">闲聊一下Go语言的函数方法和多态机制特点</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/14</span>
            <a class="archive-post-title" href="/posts/5893facf.html">express学习（一）-基于NodeJS的Web框架</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/10</span>
            <a class="archive-post-title" href="/posts/8a9b0b34.html">Beego学习-ORM</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/06</span>
            <a class="archive-post-title" href="/posts/84db08d3.html">Beego学习-路由设置</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/06</span>
            <a class="archive-post-title" href="/posts/a9031312.html">docker-compose及dockerfile总结</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/09</span>
            <a class="archive-post-title" href="/posts/77d22b2a.html">Spring安全技术-Spring Security使用及总结（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/28</span>
            <a class="archive-post-title" href="/posts/5e9eec21.html">DevOps技术-简单了解与入门</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/23</span>
            <a class="archive-post-title" href="/posts/27875254.html">Spring持久层技术-Sping Data JPA使用及总结（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/14</span>
            <a class="archive-post-title" href="/posts/bec529bf.html">以太坊智能合约开发环境搭建及智能合约的编写、部署、测试</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/11</span>
            <a class="archive-post-title" href="/posts/2ff8a9fd.html">以太坊基本概念与实验环境搭建</a>
        </li>
                </ul>
            <div class="archive-year"> 2020 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">06/17</span>
            <a class="archive-post-title" href="/posts/bcd864e2.html">DC-1靶机渗透</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/31</span>
            <a class="archive-post-title" href="/posts/c99165fd.html">fastjson反序列化漏洞学习（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/09</span>
            <a class="archive-post-title" href="/posts/a9e6a25b.html">Spring基础学习 - AOP机制</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/06</span>
            <a class="archive-post-title" href="/posts/b92dbb83.html">JavaEE基础 - Servlet</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/06</span>
            <a class="archive-post-title" href="/posts/44088610.html">Spring基础学习 - IOC机制</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/01</span>
            <a class="archive-post-title" href="/posts/662e1cfe.html">微服务入门-5W和微服务思想</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/22</span>
            <a class="archive-post-title" href="/posts/c75c5fc7.html">Java 反序列化漏洞与JNDI注入(下)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/14</span>
            <a class="archive-post-title" href="/posts/5dcfa8b5.html">Kerberos认证过程原理及攻击手段</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/26</span>
            <a class="archive-post-title" href="/posts/1ccc94ff.html">内存布局与栈溢出&堆溢出原理</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/21</span>
            <a class="archive-post-title" href="/posts/bc7cb7a1.html">入坑Pwn之刷题补坑</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/29</span>
            <a class="archive-post-title" href="/posts/760e25d9.html">内存取证原理学习及Volatility - 篇二</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/22</span>
            <a class="archive-post-title" href="/posts/b0024cb7.html">Struts框架管窥以及几个漏洞的分析</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/09</span>
            <a class="archive-post-title" href="/posts/8ce0a80d.html">Redis未授权访问漏洞及修补方法</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/08</span>
            <a class="archive-post-title" href="/posts/13fe3d9f.html">本地提权与漏洞提权</a>
        </li>
                </ul>
            <div class="archive-year"> 2019 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">12/21</span>
            <a class="archive-post-title" href="/posts/f8b67901.html">逆向工程课程小结</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/08</span>
            <a class="archive-post-title" href="/posts/4d8e0b70.html">内存取证原理学习及Volatility - 篇一</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/20</span>
            <a class="archive-post-title" href="/posts/82490df7.html">并发模型之单线程多路I/O复用---select</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/29</span>
            <a class="archive-post-title" href="/posts/a715340f.html">入坑Pwn之基本知识</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/10</span>
            <a class="archive-post-title" href="/posts/47dcecb9.html">Apache-Commons-Collections反序列化漏洞</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/03</span>
            <a class="archive-post-title" href="/posts/de476e86.html">Java 反序列化漏洞与JNDI注入(上)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/20</span>
            <a class="archive-post-title" href="/posts/7a9a17f3.html">记录一次对win2k3 Enterprise Edition的永恒之蓝利用</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/11</span>
            <a class="archive-post-title" href="/posts/6f24bb1d.html">kali-渗透测试-信息收集3</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/10</span>
            <a class="archive-post-title" href="/posts/18238b8b.html">kali-渗透测试-信息收集2</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">03/18</span>
            <a class="archive-post-title" href="/posts/812ada31.html">kali-渗透测试-信息收集1</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/11</span>
            <a class="archive-post-title" href="/posts/fffcd997.html">Metasploit渗透测试魔鬼训练营-客户端渗透攻击</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/10</span>
            <a class="archive-post-title" href="/posts/30b79e7d.html">Metasploit渗透测试魔鬼训练营-Windows服务漏洞MS08-067实战与分析总结</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/07</span>
            <a class="archive-post-title" href="/posts/79017d0.html">Metasploit渗透测试魔鬼训练营-web应用渗透</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/06</span>
            <a class="archive-post-title" href="/posts/6c9a4aca.html">Metasploit渗透测试魔鬼训练营-服务扫描与查点</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/04</span>
            <a class="archive-post-title" href="/posts/ed61533c.html">Metasploit渗透测试魔鬼训练营-信息收集</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/22</span>
            <a class="archive-post-title" href="/posts/ba8e1564.html">Metasploit渗透测试魔鬼训练营 第一天</a>
        </li>
                </ul>
            <div class="archive-year"> 2018 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">12/28</span>
            <a class="archive-post-title" href="/posts/dd591816.html">小明的博客--Typecho 反序列化漏洞</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/10</span>
            <a class="archive-post-title" href="/posts/41159e88.html">Bugku的一道注入---多次</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/06</span>
            <a class="archive-post-title" href="/posts/26bacf07.html">Bugku的一道注入--INSERT INTO注入</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/26</span>
            <a class="archive-post-title" href="/posts/e1cf93ae.html">ThinkPHP框架学习---路由</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/25</span>
            <a class="archive-post-title" href="/posts/dec252e7.html">ThinkPHP框架学习---config类和config助手函数</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/25</span>
            <a class="archive-post-title" href="/posts/8405173.html">ThinkPHP框架学习---框架目录及框架配置</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/19</span>
            <a class="archive-post-title" href="/posts/5d13a793.html">Nmap使用指南</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/12</span>
            <a class="archive-post-title" href="/posts/e6caa5f0.html">SQL注入小记(二)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/09</span>
            <a class="archive-post-title" href="/posts/78f948a4.html">PHP学习--超级全局变量</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/08</span>
            <a class="archive-post-title" href="/posts/777d53bb.html">PHP学习--变量</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/03</span>
            <a class="archive-post-title" href="/posts/f0bc436c.html">PHP框架MVC学习</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/30</span>
            <a class="archive-post-title" href="/posts/117580c0.html">CTF中的python脚本题小结（二）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/30</span>
            <a class="archive-post-title" href="/posts/21636c18.html">CTF中的python脚本题小结（一）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/20</span>
            <a class="archive-post-title" href="/posts/fc74b0ce.html">Hackergame 2018 wp</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/25</span>
            <a class="archive-post-title" href="/posts/8c800523.html">安恒九月题的misc和一道web</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/10</span>
            <a class="archive-post-title" href="/posts/49fb3e92.html">SQL注入小记(一)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/27</span>
            <a class="archive-post-title" href="/posts/21c35507.html">隐写术-LSB隐写</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/26</span>
            <a class="archive-post-title" href="/posts/59bc0c0.html">隐写术--NTFS流隐写</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/25</span>
            <a class="archive-post-title" href="/posts/c7cffe19.html">CTF常见隐写手段小结</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/22</span>
            <a class="archive-post-title" href="/posts/69896e9f.html">DOM 文档对象模型</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/21</span>
            <a class="archive-post-title" href="/posts/20cf0786.html">BOM-浏览器操作对象模型之history和screen对象</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/20</span>
            <a class="archive-post-title" href="/posts/f92f304f.html">BOM 浏览器操作对象模型之navigator、location对象</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/18</span>
            <a class="archive-post-title" href="/posts/79f16c6a.html">BOM-浏览器操作对象模型之window对象</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/16</span>
            <a class="archive-post-title" href="/posts/aa0a7b0a.html">Javascript基础之数据类型2</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/15</span>
            <a class="archive-post-title" href="/posts/33032ab0.html">Javascript基础之数据类型1</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/12</span>
            <a class="archive-post-title" href="/posts/b5fac929.html">CTF隐写术--关于ZIP</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/09</span>
            <a class="archive-post-title" href="/posts/98736a90.html">CSS样式基础4.4--选择器之伪类选择器</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/08</span>
            <a class="archive-post-title" href="/posts/17442633.html">Bugku的一道misc-----猫片</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/08</span>
            <a class="archive-post-title" href="/posts/d4db3e56.html">CSS基础4.3--选择器之属性选择器</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/05</span>
            <a class="archive-post-title" href="/posts/7b6c38ce.html">CSS基础4.2--选择器之组合选择器</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/03</span>
            <a class="archive-post-title" href="/posts/6027632.html">CSS基础4.1--选择器之CSS基础4.1-选择器之基本选择器</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/02</span>
            <a class="archive-post-title" href="/posts/370eaad5.html">CSS基础3.2--特性之CSS基础3.2--特性之继承性</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/01</span>
            <a class="archive-post-title" href="/posts/4655c16f.html">CSS基础3.1--特性之CSS基础3.1-特性之层叠性</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/01</span>
            <a class="archive-post-title" href="/posts/ae68c748.html">CSS基础2--CSS基础2-应用</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/01</span>
            <a class="archive-post-title" href="/posts/6b427aa1.html">CSS基础1--样式</a>
        </li>
            </ul>
    </div>
</div>

        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
            <span class="sidebar-tag-name" data-tags="区块链技术">
                <span class="iconfont-archer">&#xe606;</span>
                区块链技术
            </span>
            <span class="sidebar-tag-name" data-tags="开发技术">
                <span class="iconfont-archer">&#xe606;</span>
                开发技术
            </span>
            <span class="sidebar-tag-name" data-tags="Java">
                <span class="iconfont-archer">&#xe606;</span>
                Java
            </span>
            <span class="sidebar-tag-name" data-tags="渗透测试">
                <span class="iconfont-archer">&#xe606;</span>
                渗透测试
            </span>
            <span class="sidebar-tag-name" data-tags="漏洞分析">
                <span class="iconfont-archer">&#xe606;</span>
                漏洞分析
            </span>
            <span class="sidebar-tag-name" data-tags="web安全">
                <span class="iconfont-archer">&#xe606;</span>
                web安全
            </span>
            <span class="sidebar-tag-name" data-tags="前端">
                <span class="iconfont-archer">&#xe606;</span>
                前端
            </span>
            <span class="sidebar-tag-name" data-tags="Go语言">
                <span class="iconfont-archer">&#xe606;</span>
                Go语言
            </span>
            <span class="sidebar-tag-name" data-tags="Go Web">
                <span class="iconfont-archer">&#xe606;</span>
                Go Web
            </span>
            <span class="sidebar-tag-name" data-tags="论文阅读">
                <span class="iconfont-archer">&#xe606;</span>
                论文阅读
            </span>
            <span class="sidebar-tag-name" data-tags="CTF">
                <span class="iconfont-archer">&#xe606;</span>
                CTF
            </span>
            <span class="sidebar-tag-name" data-tags="SQL注入">
                <span class="iconfont-archer">&#xe606;</span>
                SQL注入
            </span>
            <span class="sidebar-tag-name" data-tags="CSS">
                <span class="iconfont-archer">&#xe606;</span>
                CSS
            </span>
            <span class="sidebar-tag-name" data-tags="python">
                <span class="iconfont-archer">&#xe606;</span>
                python
            </span>
            <span class="sidebar-tag-name" data-tags="隐写术">
                <span class="iconfont-archer">&#xe606;</span>
                隐写术
            </span>
            <span class="sidebar-tag-name" data-tags="云技术">
                <span class="iconfont-archer">&#xe606;</span>
                云技术
            </span>
            <span class="sidebar-tag-name" data-tags="DevOps">
                <span class="iconfont-archer">&#xe606;</span>
                DevOps
            </span>
            <span class="sidebar-tag-name" data-tags="开发与运维">
                <span class="iconfont-archer">&#xe606;</span>
                开发与运维
            </span>
            <span class="sidebar-tag-name" data-tags="DevSecOps">
                <span class="iconfont-archer">&#xe606;</span>
                DevSecOps
            </span>
            <span class="sidebar-tag-name" data-tags="网络编程">
                <span class="iconfont-archer">&#xe606;</span>
                网络编程
            </span>
            <span class="sidebar-tag-name" data-tags="Kubernete">
                <span class="iconfont-archer">&#xe606;</span>
                Kubernete
            </span>
            <span class="sidebar-tag-name" data-tags="云安全">
                <span class="iconfont-archer">&#xe606;</span>
                云安全
            </span>
            <span class="sidebar-tag-name" data-tags="分布式技术">
                <span class="iconfont-archer">&#xe606;</span>
                分布式技术
            </span>
            <span class="sidebar-tag-name" data-tags="MatLab">
                <span class="iconfont-archer">&#xe606;</span>
                MatLab
            </span>
            <span class="sidebar-tag-name" data-tags="PHP">
                <span class="iconfont-archer">&#xe606;</span>
                PHP
            </span>
            <span class="sidebar-tag-name" data-tags="Quarkus">
                <span class="iconfont-archer">&#xe606;</span>
                Quarkus
            </span>
            <span class="sidebar-tag-name" data-tags="Spring">
                <span class="iconfont-archer">&#xe606;</span>
                Spring
            </span>
            <span class="sidebar-tag-name" data-tags="docker">
                <span class="iconfont-archer">&#xe606;</span>
                docker
            </span>
            <span class="sidebar-tag-name" data-tags="NodeJS">
                <span class="iconfont-archer">&#xe606;</span>
                NodeJS
            </span>
            <span class="sidebar-tag-name" data-tags="express">
                <span class="iconfont-archer">&#xe606;</span>
                express
            </span>
            <span class="sidebar-tag-name" data-tags="微服务技术">
                <span class="iconfont-archer">&#xe606;</span>
                微服务技术
            </span>
            <span class="sidebar-tag-name" data-tags="密码学">
                <span class="iconfont-archer">&#xe606;</span>
                密码学
            </span>
            <span class="sidebar-tag-name" data-tags="以太坊">
                <span class="iconfont-archer">&#xe606;</span>
                以太坊
            </span>
            <span class="sidebar-tag-name" data-tags="智能合约">
                <span class="iconfont-archer">&#xe606;</span>
                智能合约
            </span>
            <span class="sidebar-tag-name" data-tags="pwn">
                <span class="iconfont-archer">&#xe606;</span>
                pwn
            </span>
            <span class="sidebar-tag-name" data-tags="电子取证">
                <span class="iconfont-archer">&#xe606;</span>
                电子取证
            </span>
            <span class="sidebar-tag-name" data-tags="日常">
                <span class="iconfont-archer">&#xe606;</span>
                日常
            </span>
            <span class="sidebar-tag-name" data-tags="C编程">
                <span class="iconfont-archer">&#xe606;</span>
                C编程
            </span>
            <span class="sidebar-tag-name" data-tags="课程总结">
                <span class="iconfont-archer">&#xe606;</span>
                课程总结
            </span>
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
        缺失模块，请参考主题文档进行安装配置：https://github.com/fi3ework/hexo-theme-archer#%E5%AE%89%E8%A3%85%E4%B8%BB%E9%A2%98
    </div> 
    <div class="sidebar-tags-list"></div>
</div>

        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
        <span class="sidebar-category-name" data-categories="区块链技术">
            <span class="iconfont-archer">&#xe60a;</span>
            区块链技术
        </span>
        <span class="sidebar-category-name" data-categories="开发技术">
            <span class="iconfont-archer">&#xe60a;</span>
            开发技术
        </span>
        <span class="sidebar-category-name" data-categories="漏洞分析">
            <span class="iconfont-archer">&#xe60a;</span>
            漏洞分析
        </span>
        <span class="sidebar-category-name" data-categories="论文阅读">
            <span class="iconfont-archer">&#xe60a;</span>
            论文阅读
        </span>
        <span class="sidebar-category-name" data-categories="CTF">
            <span class="iconfont-archer">&#xe60a;</span>
            CTF
        </span>
        <span class="sidebar-category-name" data-categories="渗透测试">
            <span class="iconfont-archer">&#xe60a;</span>
            渗透测试
        </span>
        <span class="sidebar-category-name" data-categories="DevSecOps">
            <span class="iconfont-archer">&#xe60a;</span>
            DevSecOps
        </span>
        <span class="sidebar-category-name" data-categories="云安全">
            <span class="iconfont-archer">&#xe60a;</span>
            云安全
        </span>
        <span class="sidebar-category-name" data-categories="MATLAB">
            <span class="iconfont-archer">&#xe60a;</span>
            MATLAB
        </span>
        <span class="sidebar-category-name" data-categories="密码学">
            <span class="iconfont-archer">&#xe60a;</span>
            密码学
        </span>
        <span class="sidebar-category-name" data-categories="电子取证">
            <span class="iconfont-archer">&#xe60a;</span>
            电子取证
        </span>
        <span class="sidebar-category-name" data-categories="课程总结">
            <span class="iconfont-archer">&#xe60a;</span>
            课程总结
        </span>
        <span class="sidebar-category-name" data-categories="杂谈">
            <span class="iconfont-archer">&#xe60a;</span>
            杂谈
        </span>
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>

    </div>
</div>

        <!-- site-meta -->
        <script>
    var siteMetaRoot = "/"
    if (siteMetaRoot === "undefined") {
        siteMetaRoot = '/'
    }
    var siteMeta = {
        url: "https://lzwgiter.github.io",
        root: siteMetaRoot,
        author: "f10@t"
    }
</script>

        <!-- import experimental options here -->
        <!-- Custom Font -->

        <!-- main func -->
        <script src="/scripts/main.js"></script>
        <!-- fancybox -->
        <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.umd.js" onload="window.Fancybox.bind('[data-fancybox]')" defer></script>
        <!-- algolia -->
            <div class="site-search site-search-loading">
    <div class="algolia-popup popup">
        <div class="algolia-search">
            <div class="algolia-search-input-icon">
                <i class="fa fa-search"></i>
            </div>
            <div class="algolia-search-input" id="algolia-search-input"></div>
            <div class="popup-btn-close">
                <i class="iconfont-archer">&#xe609;</i>
            </div>
        </div>

        <div class="algolia-results">
            <div id="algolia-stats" class="algolia-stats"></div>
            <div id="algolia-hits"></div>
            <div id="algolia-pagination" class="algolia-pagination"></div>
        </div>
    </div>
</div>

            <script src="/scripts/search.js" async></script>
        <!-- busuanzi -->
            <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
        <!-- async load share.js -->
            <script src="/scripts/share.js" async></script>
        <!-- mermaid -->
    </body>
</html>
